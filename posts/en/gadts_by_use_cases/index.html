<!doctype html><html lang=en><head><title>GADTs By Use Cases :: stefshine's playground — Gathered thoughts of a wannabe functional programmer</title><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1"><meta name=description content="This workshop will be presented at ScalaIO 2019, in Lyon (France), on Tuesday the 29th of October at 9am by Christophe Calvès and I.
Welcome. This session will introduce you to a very powerful tool in programming. Whereas most introduction start by presenting its theoretical foundations in a very formal way, we chose to present it via short examples and practical use cases.
This workshop is made of three parts. The last one presents three of the most valuable use cases."><meta name=keywords content="GADT,GADTs,Generalized Algebraic Data Types,ADT,Algebraic Data Types,Functional Programming,Interface,Free Monad,ScalaIO"><meta name=robots content="noodp"><link rel=canonical href=https://stankoua.github.io/posts/en/gadts_by_use_cases/><link rel=stylesheet href=https://stankoua.github.io/assets/style.css><link rel=stylesheet href=https://stankoua.github.io/assets/blue.css><link rel=apple-touch-icon-precomposed sizes=144x144 href=https://stankoua.github.io/img/apple-touch-icon-144-precomposed.png><link rel="shortcut icon" href=https://stankoua.github.io/img/favicon/blue.png><meta name=twitter:card content="summary"><meta name=twitter:title content="GADTs By Use Cases :: stefshine's playground — Gathered thoughts of a wannabe functional programmer"><meta name=twitter:description content="This workshop will be presented at ScalaIO 2019, in Lyon (France), on Tuesday the 29th of October at 9am by Christophe Calvès and I.
Welcome. This session will introduce you to a very powerful tool in programming. Whereas most introduction start by presenting its theoretical foundations in a very formal way, we chose to present it via short examples and practical use cases.
This workshop is made of three parts. The last one presents three of the most valuable use cases."><meta name=twitter:site content="https://stankoua.github.io/"><meta name=twitter:creator content><meta name=twitter:image content><meta property="og:locale" content="en"><meta property="og:type" content="article"><meta property="og:title" content="GADTs By Use Cases :: stefshine's playground — Gathered thoughts of a wannabe functional programmer"><meta property="og:description" content="This workshop will be presented at ScalaIO 2019, in Lyon (France), on Tuesday the 29th of October at 9am by Christophe Calvès and I.
Welcome. This session will introduce you to a very powerful tool in programming. Whereas most introduction start by presenting its theoretical foundations in a very formal way, we chose to present it via short examples and practical use cases.
This workshop is made of three parts. The last one presents three of the most valuable use cases."><meta property="og:url" content="https://stankoua.github.io/posts/en/gadts_by_use_cases/"><meta property="og:site_name" content="GADTs By Use Cases"><meta property="og:image" content><meta property="og:image:width" content="2048"><meta property="og:image:height" content="1024"><meta property="article:published_time" content="2019-10-26 05:00:00 +0200 +0200"></head><body><div class="container center"><header class=header><div class=header__inner><div class=header__logo><a href=/><div class=logo>Stefshine's playground</div></a></div><div class=menu-trigger>menu</div></div><nav class=menu><ul class="menu__inner menu__inner--desktop"><li><a href=/en/about>About Me</a></li><li><a href=/en/conference-work>Conferences</a></li><div class=spacer></div><ul class=language-selector><ul class=language-selector-current><li>English ▾</li></ul><ul class="language-selector__more hidden"><li><a href=https://stankoua.github.io/fr/>Français</a></li><li><a href=https://stankoua.github.io/>English</a></li></ul></ul></ul><ul class="menu__inner menu__inner--mobile"><li><a href=/en/about>About Me</a></li><li><a href=/en/conference-work>Conferences</a></li><hr><li><a href=https://stankoua.github.io/fr/>Français</a></li><li><a href=https://stankoua.github.io/>English</a></li></ul></nav></header><div class=content><div class=post><h1 class=post-title><a href=https://stankoua.github.io/posts/en/gadts_by_use_cases/>GADTs By Use Cases</a></h1><div class=post-meta><span class=post-date>2019-10-26</span></div><div class=table-of-contents><h1>Table of content</h1><nav id=TableOfContents><ul><li><a href=#acknowledgements>Acknowledgements</a></li><li><a href=#readme>README</a></li><li><a href=#stretching>Stretching</a><ul><li><a href=#values-and-types><em>Values</em> and <em>Types</em>?</a></li><li><a href=#how-many-types>How many types?</a></li><li><a href=#how-many-values>How many values?</a></li></ul></li><li><a href=#first-contact>First Contact</a><ul><li><a href=#use-case-evidence-of-some-property>Use Case: Evidence of some property</a></li><li><a href=#use-case-the-only-thing-i-know-is-it-exists>Use Case: The only thing I know is it exists</a></li><li><a href=#intermediary-conclusion>Intermediary Conclusion</a></li></ul></li><li><a href=#easy-useful-use-cases-relations-on-types>Easy Useful Use Cases: Relations on Types</a><ul><li><a href=#use-case-witnessing-type-equality>Use Case: Witnessing Type Equality</a></li><li><a href=#use-case-witnessing-sub-typing>Use Case: Witnessing Sub Typing</a></li><li><a href=#use-case-avoiding-annoying-scalac-error-messages-about-bounds-not-respected>Use Case: Avoiding annoying <em>scalac</em> error messages about bounds not respected</a></li><li><a href=#use-case-give-the-right-data-to-the-right-chart>Use Case: Give the right data to the right chart</a></li></ul></li><li><a href=#more-advanced-use-cases>More Advanced Use Cases</a><ul><li><a href=#use-case-effects>Use Case: Effects!</a></li><li><a href=#use-case-ensuring-types-are-supported-by-the-database>Use Case: Ensuring types are supported by the Database</a></li><li><a href=#use-case-simplifying-implicits>Use Case: Simplifying Implicits</a></li></ul></li><li><a href=#conclusion>Conclusion</a></li></ul></nav></div><div class=post-content><p><strong>This workshop will be presented at <a href=https://scala.io/>ScalaIO 2019</a>,
in <em>Lyon</em> (<em>France</em>), on <a href=https://schedule.scala.io/#/day/1><em>Tuesday the 29th of October</em> at 9am</a>
by <a href=https://chrilves.github.io/posts/gadts_by_use_cases/>Christophe Calvès</a> and <a href=/about>I</a>.</strong></p><p>Welcome. This session will introduce you to a very powerful tool in
programming. Whereas most introduction start by presenting its
theoretical foundations in a very formal way, we chose to present
it via short examples and practical use cases.</p><p>This workshop is made of three parts. The last one presents three
of the most valuable use cases. They are the real big powerful use cases.
But do not go there unprepared! This is the last part for a reason:
they rely massively on lessons you will learn in the previous parts.
Start by <a href=#first-contact>First Contact</a>, it will show
you, via the simplest examples, the core ideas. Its goal is to open your
mind to ways of using types and data you may have never imagined possible.
Then go to
<a href=#easy-useful-use-cases-relations-on-types>Easy Useful Use Cases: Relations on Types</a>,
for the first real-life challenge.
Then, you are ready for <a href=#more-advanced-use-cases>More Advanced Use Cases</a>.</p><p>Be sure to <strong>read <a href=#readme>README</a></strong>, it contains precious tips to ease your
journey.</p><h2 id=acknowledgements>Acknowledgements</h2><p>We would like to thank <a href=http://www.laure-juglaret.fr/>Laure Juglaret</a> for
having reviewed this presentation many times, for her precious remarks and
corrections.</p><h2 id=readme>README</h2><p>In this presentation we will assume that:</p><ul><li><code>null</code> <strong>does not exists!</strong></li><li><strong>runtime-reflection does not exist!</strong> (i.e. <code>isInstanceOf</code>, <code>getClass</code>, etc)</li></ul><p>This presentation considers that <em>these features do not exists at all</em>.</p><p><strong>Using these features will never lead to a valid answer</strong>.</p><p>This presentation expects you to have access to something where
you can easily write, compile and run <em>Scala</em> code. The best way to do so
is opening a <em>R.E.P.L.</em> session. If you have <em>Scala</em> installed on your system,
you can easily start one from the command-line by executing <code>scala</code>:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scala data-lang=scala>system<span style=color:#f92672>-</span>command<span style=color:#f92672>-</span>line<span style=color:#66d9ef>#</span> scala
<span style=color:#a6e22e>Welcome</span> to <span style=color:#a6e22e>Scala</span> <span style=color:#ae81ff>2.13</span><span style=color:#f92672>.</span><span style=color:#ae81ff>1</span> <span style=color:#f92672>(</span><span style=color:#a6e22e>OpenJDK</span> <span style=color:#ae81ff>64</span><span style=color:#f92672>-</span><span style=color:#a6e22e>Bit</span> <span style=color:#a6e22e>Server</span> <span style=color:#a6e22e>VM</span><span style=color:#f92672>,</span> <span style=color:#a6e22e>Java</span> <span style=color:#ae81ff>1.8</span><span style=color:#f92672>.</span><span style=color:#ae81ff>0</span>_222<span style=color:#f92672>).</span>
<span style=color:#a6e22e>Type</span> in expressions <span style=color:#66d9ef>for</span> evaluation<span style=color:#f92672>.</span> <span style=color:#a6e22e>Or</span> <span style=color:#66d9ef>try</span> <span style=color:#66d9ef>:</span><span style=color:#66d9ef>help.</span>

<span style=color:#66d9ef>scala&gt;</span>
</code></pre></div><p>Remember that the <em>R.E.P.L</em> command <code>:paste</code> allows to paste code
and <code>:reset</code> cleans the environment.</p><p>If you don&rsquo;t have <em>Scala</em> installed, <strong>you can use</strong> the <em>online-REPL</em>
<a href=https://scastie.scala-lang.org/>https://scastie.scala-lang.org/</a> .</p><h2 id=stretching>Stretching</h2><p>This section is a brief reminder of some definitions and properties
about values and types.</p><h3 id=values-and-types><em>Values</em> and <em>Types</em>?</h3><p><strong>Values</strong> are <em>actual piece of data your program manipulates</em>
like the integer <code>5</code>, the boolean <code>true</code>, the string <code>"Hello World!"</code>,
the function <code>(x: Double) => x / 7.5</code>, the list <code>List(1,2,3)</code>, etc.
It is convenient to classify values into groups. These groups are called
<strong>types</strong>. For example:</p><ul><li><code>Int</code> is the group of integer values, i.e. values like <code>1</code>, <code>-7</code>, <code>19</code>, etc.</li><li><code>Boolean</code> is the group containing exactly the values
<code>true</code> and <code>false</code> (no more, no less!).</li><li><code>String</code> is the group whose values are <code>"Hello World!"</code>, <code>""</code>, <code>"I ❤️ GADTs"</code>, etc.</li><li><code>Double => Double</code> is the group whose values are functions taking
any <code>Double</code> as argument and returning some <code>Double</code>.</li></ul><p>To indicate that the value <code>v</code> belongs to the type (i.e. group of values) <code>T</code>,
we write <code>v : T</code>. In <em>Scala</em>, testing if a value <code>v</code> belongs to a type <code>T</code>
is very simple: just type <code>v : T</code> in the <em>REPL</em>:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scala data-lang=scala>scala<span style=color:#f92672>&gt;</span> <span style=color:#ae81ff>5</span> <span style=color:#66d9ef>:</span> <span style=color:#66d9ef>Int</span>
res7<span style=color:#66d9ef>:</span> <span style=color:#66d9ef>Int</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>5</span>
</code></pre></div><p>If <em>Scala</em> accepts it, then <code>v</code> belongs to <code>T</code>. If <em>Scala</em> complains,
it most probably does not :</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scala data-lang=scala>scala<span style=color:#f92672>&gt;</span> <span style=color:#ae81ff>5</span> <span style=color:#66d9ef>:</span> <span style=color:#66d9ef>String</span>
       <span style=color:#f92672>^</span>
       error<span style=color:#66d9ef>:</span> <span style=color:#66d9ef>type</span> <span style=color:#66d9ef>mismatch</span><span style=color:#f92672>;</span>
        found   <span style=color:#66d9ef>:</span> <span style=color:#66d9ef>Int</span><span style=color:#f92672>(</span><span style=color:#960050;background-color:#1e0010>5</span><span style=color:#f92672>)</span>
        <span style=color:#66d9ef>required:</span> <span style=color:#66d9ef>String</span>
</code></pre></div><h3 id=how-many-types>How many types?</h3><p>Let&rsquo;s now create some types and some of their values (when possible!).</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scala data-lang=scala><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>OneType</span>
</code></pre></div><ul><li><p><strong>Question 1:</strong> How many types does the line <code>class OneType</code> defines?</p><p>As the name suggests, <code>class OneType</code> defines only one type which is named <code>OneType</code>.</p></li></ul><p>Let&rsquo;s now consider:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scala data-lang=scala><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>OneTypeForEvery</span><span style=color:#f92672>[</span><span style=color:#66d9ef>A</span><span style=color:#f92672>]</span>
</code></pre></div><ul><li><p><strong>Question 2:</strong> How many types does the line <code>class OneTypeForEvery[A]</code> defines?</p><p>As the name suggests, every concrete type <code>A</code> gives
rise to a distinct type <code>OneTypeForEvery[A]</code>.</p><p>For example, a list of integers is neither a list of booleans,
nor a list of strings, nor a list of functions, nor &mldr;
It means the types <code>List[Int]</code>, <code>List[Boolean]</code>,
<code>List[Int => Int]</code>, etc are all distinct types.</p><p>The line <code>class OneTypeForEvery[A]</code> defines a
<strong>distinct type for every concrete type</strong> <code>A</code>. There
is an infnity of concrete types <code>A</code>, so an infinity of distinct types
<code>OneTypeForEvery[A]</code>.</p></li><li><p><strong>Question 3:</strong> Give a value that belongs to both <code>OneTypeForEvery[Int]</code>
and <code>OneTypeForEvery[Boolean]</code>.</p><p><strong>Remember that <code>null</code> does not exist!</strong></p><p>This is actually impossible. Every concrete type <code>A</code> give rise a distinct type <code>OneTypeForEvery[A]</code>
that have no values in common with others types <code>OneTypeForEvery[B]</code> for <code>B ≠ A</code>.</p></li></ul><h3 id=how-many-values>How many values?</h3><p>Considering the following type:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scala data-lang=scala><span style=color:#66d9ef>final</span> <span style=color:#66d9ef>abstract</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>NoValueForThisType</span>
</code></pre></div><ul><li><p><strong>Question 1:</strong> Give a value belonging to the type <code>NoValueForThisType</code>?
How many values belong to <code>NoValueForThisType</code>?</p><ul><li>What is a <code>final</code> class? How does it differ from a normal non-final class?</li><li>What is an <code>abstract</code> class? How does it differ from a concrete class?</li></ul><p>The class <code>NoValueForThisType</code> is declared <code>abstract</code>. It is then forbidden to create
a direct instance of this class:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scala data-lang=scala>scala<span style=color:#f92672>&gt;</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>NoValueForThisType</span>
        <span style=color:#f92672>^</span>
        error<span style=color:#66d9ef>:</span> <span style=color:#66d9ef>class</span> <span style=color:#66d9ef>NoValueForThisType</span> <span style=color:#66d9ef>is</span> <span style=color:#66d9ef>abstract</span><span style=color:#f92672>;</span> cannot be instantiated
</code></pre></div><p>The only way to create an instance of an abstract class is creating a concrete sub-class.
But the keyword <code>final</code> forbids creating such sub-classes:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scala data-lang=scala>scala<span style=color:#f92672>&gt;</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>ConcreteSubClass</span> <span style=color:#66d9ef>extends</span> <span style=color:#a6e22e>NoValueForThisType</span>
                                        <span style=color:#f92672>^</span>
        error<span style=color:#66d9ef>:</span> <span style=color:#66d9ef>illegal</span> <span style=color:#66d9ef>inheritance</span> <span style=color:#66d9ef>from</span> <span style=color:#66d9ef>final</span> <span style=color:#66d9ef>class</span> <span style=color:#66d9ef>NoValueForThisType</span>
</code></pre></div><p>There is no way to create an instance of <code>NoValueForThisType</code>.</p></li></ul><p>Let&rsquo;s take another example:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scala data-lang=scala><span style=color:#66d9ef>sealed</span> <span style=color:#66d9ef>trait</span> <span style=color:#a6e22e>ExactlyOneValue</span>
<span style=color:#66d9ef>case</span> <span style=color:#66d9ef>object</span> <span style=color:#a6e22e>TheOnlyValue</span> <span style=color:#66d9ef>extends</span> <span style=color:#a6e22e>ExactlyOneValue</span>
</code></pre></div><ul><li><p><strong>Question 2:</strong> Give a value belonging to the type <code>ExactlyOneValue</code>?</p><p>By definition, <code>TheOnlyValue</code> is a value of type <code>ExactlyOneValue</code>.</p></li><li><p><strong>Question 3:</strong> How many values belong to <code>ExactlyOneValue</code>?</p><p>Just like above, <code>ExactlyOneValue</code>, being a <code>trait</code>, is <em>abstract</em>. Being <code>sealed</code>,
extending it outside of its defining file is forbidden.
So <code>TheOnlyValue</code> is the only value of type <code>ExactlyOneValue</code>.</p></li></ul><h2 id=first-contact>First Contact</h2><p>This part presents the core ideas. There are actually
only two ideas! What you will find here are stripped down
examples to illustrate each of these ideas.</p><h3 id=use-case-evidence-of-some-property>Use Case: Evidence of some property</h3><p>Let&rsquo;s define a simple <em>sealed trait</em>:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scala data-lang=scala><span style=color:#66d9ef>sealed</span> <span style=color:#66d9ef>trait</span> <span style=color:#a6e22e>ATrait</span><span style=color:#f92672>[</span><span style=color:#66d9ef>A</span><span style=color:#f92672>]</span>
<span style=color:#a6e22e>case</span> <span style=color:#66d9ef>object</span> <span style=color:#a6e22e>AValue</span> <span style=color:#66d9ef>extends</span> <span style=color:#a6e22e>ATrait</span><span style=color:#f92672>[</span><span style=color:#66d9ef>Char</span><span style=color:#f92672>]</span>
</code></pre></div><ul><li><p><strong>Question 1:</strong> Give a value of type <code>ATrait[Char]</code>.</p><p>By definition, <code>AValue</code> is a value of type <code>ATrait[Char]</code>.</p></li><li><p><strong>Question 2:</strong> Give a value of type <code>ATrait[Double]</code>.</p><p>There is no way to have an instance of type <code>ATrait[Double]</code>.
There is actually no way to have an instance of type <code>ATrait[B]</code> for <code>B ≠ Char</code>,
because the only possible value is <code>AValue</code> which is of type <code>ATrait[Char]</code>.</p></li><li><p><strong>Question 3:</strong> What can you conclude about a type <code>A</code> if you have a value
<code>ev</code> of type <code>ATrait[A]</code> (i.e. <code>ev: ATrait[A]</code>)?</p><p>The only possible value is <code>AValue</code>, so <code>ev == AValue</code>.
Furthermore <code>AValue</code> is of type <code>ATrait[Char]</code> so <code>A = Char</code>.</p></li><li><p><strong>Question 4:</strong> In the <em>REPL</em>, enter the following code:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scala data-lang=scala><span style=color:#66d9ef>def</span> f<span style=color:#f92672>[</span><span style=color:#66d9ef>A</span><span style=color:#f92672>](</span>x<span style=color:#66d9ef>:</span> <span style=color:#66d9ef>A</span><span style=color:#f92672>,</span> ev<span style=color:#66d9ef>:</span> <span style=color:#66d9ef>ATrait</span><span style=color:#f92672>[</span><span style=color:#66d9ef>A</span><span style=color:#f92672>])</span><span style=color:#66d9ef>:</span> <span style=color:#66d9ef>Char</span> <span style=color:#f92672>=</span>
  x
</code></pre></div></li><li><p><strong>Question 5:</strong> Now try pattern matching on <code>ev: ATrait[A]</code></p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scala data-lang=scala><span style=color:#66d9ef>def</span> f<span style=color:#f92672>[</span><span style=color:#66d9ef>A</span><span style=color:#f92672>](</span>x<span style=color:#66d9ef>:</span> <span style=color:#66d9ef>A</span><span style=color:#f92672>,</span> ev<span style=color:#66d9ef>:</span> <span style=color:#66d9ef>ATrait</span><span style=color:#f92672>[</span><span style=color:#66d9ef>A</span><span style=color:#f92672>])</span><span style=color:#66d9ef>:</span> <span style=color:#66d9ef>Char</span> <span style=color:#f92672>=</span>
  ev <span style=color:#66d9ef>match</span> <span style=color:#f92672>{</span>
    <span style=color:#66d9ef>case</span> <span style=color:#a6e22e>AValue</span> <span style=color:#66d9ef>=&gt;</span> x
  <span style=color:#f92672>}</span>
</code></pre></div><p>Is the pattern matching exhaustive?</p><p>The pattern matching is exhaustive because the only possible actual
value for <code>ev</code> is <code>AValue</code>. Furthermore <code>AValue</code> is of type <code>ATrait[Char]</code>
which means <code>ev : ATrait[Char]</code> because <code>ev == AValue</code>. So <code>A = Char</code> and <code>x : Char</code>.</p></li><li><p><strong>Question 6:</strong> Call <code>f</code> with <code>x = 'w' : Char</code>.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scala data-lang=scala>scala<span style=color:#f92672>&gt;</span> f<span style=color:#f92672>[</span><span style=color:#66d9ef>Char</span><span style=color:#f92672>](</span><span style=color:#e6db74>&#39;w&#39;</span><span style=color:#f92672>,</span> <span style=color:#a6e22e>AValue</span><span style=color:#f92672>)</span>
res0<span style=color:#66d9ef>:</span> <span style=color:#66d9ef>Char</span> <span style=color:#f92672>=</span> w
</code></pre></div></li><li><p><strong>Question 7:</strong> Call <code>f</code> with <code>x = 5.2 : Double</code>.</p><p>This is impossible because it would require to give a value
<code>ev : ATrait[Double]</code>, which does not exist!</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scala data-lang=scala>scala<span style=color:#f92672>&gt;</span> f<span style=color:#f92672>[</span><span style=color:#66d9ef>Double</span><span style=color:#f92672>](</span><span style=color:#ae81ff>5</span><span style=color:#f92672>,</span> <span style=color:#a6e22e>AValue</span><span style=color:#f92672>)</span>
                    <span style=color:#f92672>^</span>
          error<span style=color:#66d9ef>:</span> <span style=color:#66d9ef>type</span> <span style=color:#66d9ef>mismatch</span><span style=color:#f92672>;</span>
            found   <span style=color:#66d9ef>:</span> <span style=color:#66d9ef>AValue.type</span>
            required<span style=color:#66d9ef>:</span> <span style=color:#66d9ef>ATrait</span><span style=color:#f92672>[</span><span style=color:#66d9ef>Double</span><span style=color:#f92672>]</span>
</code></pre></div></li></ul><p>Using all the nice features of <em>Scala</em>, the production-ready version of the code above is:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scala data-lang=scala><span style=color:#66d9ef>sealed</span> <span style=color:#66d9ef>trait</span> <span style=color:#a6e22e>IsChar</span><span style=color:#f92672>[</span><span style=color:#66d9ef>A</span><span style=color:#f92672>]</span>
<span style=color:#a6e22e>object</span> <span style=color:#a6e22e>IsChar</span> <span style=color:#f92672>{</span>
  <span style=color:#66d9ef>implicit</span> <span style=color:#66d9ef>case</span> <span style=color:#66d9ef>object</span> <span style=color:#a6e22e>Evidence</span> <span style=color:#66d9ef>extends</span> <span style=color:#a6e22e>IsChar</span><span style=color:#f92672>[</span><span style=color:#66d9ef>Char</span><span style=color:#f92672>]</span>

  <span style=color:#66d9ef>def</span> apply<span style=color:#f92672>[</span><span style=color:#66d9ef>A</span><span style=color:#f92672>](</span><span style=color:#66d9ef>implicit</span> evidence<span style=color:#66d9ef>:</span> <span style=color:#66d9ef>IsChar</span><span style=color:#f92672>[</span><span style=color:#66d9ef>A</span><span style=color:#f92672>])</span><span style=color:#66d9ef>:</span> <span style=color:#66d9ef>IsChar</span><span style=color:#f92672>[</span><span style=color:#66d9ef>A</span><span style=color:#f92672>]</span> <span style=color:#66d9ef>=</span>
    evidence
<span style=color:#f92672>}</span>

<span style=color:#66d9ef>def</span> f<span style=color:#f92672>[</span><span style=color:#66d9ef>A:</span> <span style=color:#66d9ef>IsChar</span><span style=color:#f92672>](</span>x<span style=color:#66d9ef>:</span> <span style=color:#66d9ef>A</span><span style=color:#f92672>)</span><span style=color:#66d9ef>:</span> <span style=color:#66d9ef>Char</span> <span style=color:#f92672>=</span>
  <span style=color:#a6e22e>IsChar</span><span style=color:#f92672>[</span><span style=color:#66d9ef>A</span><span style=color:#f92672>]</span> <span style=color:#66d9ef>match</span> <span style=color:#f92672>{</span>
    <span style=color:#66d9ef>case</span> <span style=color:#a6e22e>IsChar</span><span style=color:#f92672>.</span><span style=color:#a6e22e>Evidence</span> <span style=color:#66d9ef>=&gt;</span> x
  <span style=color:#f92672>}</span>
</code></pre></div><h3 id=use-case-the-only-thing-i-know-is-it-exists>Use Case: The only thing I know is it exists</h3><p>What would you do if you wanted your codebase to log messages, but you want to be sure your
codebase do not rely on any implementation details of the logger, so that you can change its
implementation without risking breaking the codebase?</p><p>Take the following logger type <code>UnknownLogger</code>:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scala data-lang=scala><span style=color:#66d9ef>sealed</span> <span style=color:#66d9ef>trait</span> <span style=color:#a6e22e>UnknownLogger</span>
<span style=color:#66d9ef>final</span> <span style=color:#66d9ef>case</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>LogWith</span><span style=color:#f92672>[</span><span style=color:#66d9ef>X</span><span style=color:#f92672>](</span>logs <span style=color:#66d9ef>:</span> <span style=color:#66d9ef>X</span><span style=color:#f92672>,</span> appendMessage<span style=color:#66d9ef>:</span> <span style=color:#f92672>(</span><span style=color:#66d9ef>X</span><span style=color:#f92672>,</span> <span style=color:#66d9ef>String</span><span style=color:#f92672>)</span> <span style=color:#66d9ef>=&gt;</span> X<span style=color:#f92672>)</span> <span style=color:#66d9ef>extends</span> <span style=color:#a6e22e>UnknownLogger</span>
</code></pre></div><p>The first logger we will create stores the logs in a <code>String</code>:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scala data-lang=scala><span style=color:#66d9ef>val</span> loggerStr <span style=color:#66d9ef>:</span> <span style=color:#66d9ef>UnknownLogger</span> <span style=color:#f92672>=</span>
  <span style=color:#a6e22e>LogWith</span><span style=color:#f92672>[</span><span style=color:#66d9ef>String</span><span style=color:#f92672>](</span><span style=color:#e6db74>&#34;&#34;</span><span style=color:#f92672>,</span> <span style=color:#f92672>(</span>logs<span style=color:#66d9ef>:</span> <span style=color:#66d9ef>String</span><span style=color:#f92672>,</span> message<span style=color:#66d9ef>:</span> <span style=color:#66d9ef>String</span><span style=color:#f92672>)</span> <span style=color:#66d9ef>=&gt;</span> logs <span style=color:#f92672>++</span> message<span style=color:#f92672>)</span>
</code></pre></div><p>The second logger stores them in a <code>List[String]</code>:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scala data-lang=scala><span style=color:#66d9ef>val</span> loggerList <span style=color:#66d9ef>:</span> <span style=color:#66d9ef>UnknownLogger</span> <span style=color:#f92672>=</span>
  <span style=color:#a6e22e>LogWith</span><span style=color:#f92672>[</span><span style=color:#66d9ef>List</span><span style=color:#f92672>[</span><span style=color:#66d9ef>String</span><span style=color:#f92672>]](</span><span style=color:#a6e22e>Nil</span><span style=color:#f92672>,</span> <span style=color:#f92672>(</span>logs<span style=color:#66d9ef>:</span> <span style=color:#66d9ef>List</span><span style=color:#f92672>[</span><span style=color:#66d9ef>String</span><span style=color:#f92672>],</span> message<span style=color:#66d9ef>:</span> <span style=color:#66d9ef>String</span><span style=color:#f92672>)</span> <span style=color:#66d9ef>=&gt;</span> message <span style=color:#66d9ef>:</span><span style=color:#66d9ef>:</span> <span style=color:#66d9ef>logs</span><span style=color:#f92672>)</span>
</code></pre></div><p>The third logger directly prints the messages to the standard output:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scala data-lang=scala><span style=color:#66d9ef>val</span> loggerStdout <span style=color:#66d9ef>:</span> <span style=color:#66d9ef>UnknownLogger</span> <span style=color:#f92672>=</span>
  <span style=color:#a6e22e>LogWith</span><span style=color:#f92672>[</span><span style=color:#66d9ef>Unit</span><span style=color:#f92672>]((),</span> <span style=color:#f92672>(</span>logs<span style=color:#66d9ef>:</span> <span style=color:#66d9ef>Unit</span><span style=color:#f92672>,</span> message<span style=color:#66d9ef>:</span> <span style=color:#66d9ef>String</span><span style=color:#f92672>)</span> <span style=color:#66d9ef>=&gt;</span> println<span style=color:#f92672>(</span>message<span style=color:#f92672>))</span>
</code></pre></div><p>Note that these three loggers all have the same type (i.e. <code>UnknownLogger</code>) but they store
the logs using different types <code>X</code> (<code>String</code>, <code>List[String]</code> and <code>Unit</code>).</p><ul><li><p><strong>Question 1:</strong> Let <code>v</code> be a value of type <code>UnknownLogger</code>.
Clearly <code>v</code> has to be an instance of the class <code>LogWith[X]</code> for some type <code>X</code>.
What can you say about the type <code>X</code>? Can you figure out which type <code>X</code> actually is?</p><p><strong>Remember that we refuse to use runtime-reflection!</strong> (i.e. <code>isInstanceOf</code>, <code>getClass</code>, etc)</p><p>We know almost nothing about <code>X</code>. The only thing we know is there exists at least
one value (<code>v.logs</code>) of type <code>X</code>. Appart from that, <code>X</code> can be any type.</p><p>Not knowing which type is actually <code>X</code> is very useful to guarantee that the code that will
use <code>v : UnknownLogger</code> will never rely on the nature of <code>X</code>. If the code knew <code>X</code> was
<code>String</code> for example, it could perform some operations we want to forbid like reversing
the list, taking only the <em>nth</em> first characters, etc. By hiding the real type <code>X</code>, we force
our codebase to not depend on what <code>X</code> is but to use the provided <code>v.appendMessage</code>.
So changing the real implementation of the logger won&rsquo;t break any code.</p></li><li><p><strong>Question 2:</strong> Write the function <code>def log(message: String, v: UnknownLogger): UnknownLogger</code>
that uses <code>v.appendMessage</code> to append <code>message</code> to <code>v.logs</code>
and returns a new <code>UnknownLogger</code> containing the new logs.</p><p>Remember that in <em>Scala</em>, the pattern <code>case ac : AClass[t] =></code> (see below)
is allowed in <code>match/case</code> in replacement of the pattern <code>case AClass(v) =></code>:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scala data-lang=scala><span style=color:#66d9ef>final</span> <span style=color:#66d9ef>case</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>AClass</span><span style=color:#f92672>[</span><span style=color:#66d9ef>A</span><span style=color:#f92672>](</span>value <span style=color:#66d9ef>:</span> <span style=color:#66d9ef>A</span><span style=color:#f92672>)</span>

<span style=color:#66d9ef>def</span> f<span style=color:#f92672>[</span><span style=color:#66d9ef>A</span><span style=color:#f92672>](</span>v<span style=color:#66d9ef>:</span> <span style=color:#66d9ef>AClass</span><span style=color:#f92672>[</span><span style=color:#66d9ef>A</span><span style=color:#f92672>])</span><span style=color:#66d9ef>:</span> <span style=color:#66d9ef>A</span> <span style=color:#f92672>=</span>
  v <span style=color:#66d9ef>match</span> <span style=color:#f92672>{</span>
    <span style=color:#66d9ef>case</span> ac <span style=color:#66d9ef>:</span> <span style=color:#66d9ef>AClass</span><span style=color:#f92672>[</span><span style=color:#66d9ef>t</span><span style=color:#f92672>]</span> <span style=color:#66d9ef>=&gt;</span>
      <span style=color:#75715e>// The variable `t` is a type variable
</span><span style=color:#75715e></span>      <span style=color:#75715e>// The type `t` is equal to `A`
</span><span style=color:#75715e></span>      <span style=color:#66d9ef>val</span> r <span style=color:#66d9ef>:</span> <span style=color:#66d9ef>t</span> <span style=color:#f92672>=</span> ac<span style=color:#f92672>.</span>value
      r
  <span style=color:#f92672>}</span>
</code></pre></div><p>Its main benefit is introducing the type variable <code>t</code>.
Type variables work like normal pattern variables except that they represent types
instead of values. Having <code>t</code> enable us to help the compiler by giving explicit types
(like just above, saying <code>r</code> is of type <code>t</code>).</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scala data-lang=scala><span style=color:#66d9ef>def</span> log<span style=color:#f92672>(</span>message<span style=color:#66d9ef>:</span> <span style=color:#66d9ef>String</span><span style=color:#f92672>,</span> v<span style=color:#66d9ef>:</span> <span style=color:#66d9ef>UnknownLogger</span><span style=color:#f92672>)</span><span style=color:#66d9ef>:</span> <span style=color:#66d9ef>UnknownLogger</span> <span style=color:#f92672>=</span>
  v <span style=color:#66d9ef>match</span> <span style=color:#f92672>{</span>
    <span style=color:#66d9ef>case</span> vx <span style=color:#66d9ef>:</span> <span style=color:#66d9ef>LogWith</span><span style=color:#f92672>[</span><span style=color:#66d9ef>x</span><span style=color:#f92672>]</span> <span style=color:#66d9ef>=&gt;</span> <span style=color:#a6e22e>LogWith</span><span style=color:#f92672>[</span><span style=color:#66d9ef>x</span><span style=color:#f92672>](</span>vx<span style=color:#f92672>.</span>appendMessage<span style=color:#f92672>(</span>vx<span style=color:#f92672>.</span>logs<span style=color:#f92672>,</span> message<span style=color:#f92672>),</span> vx<span style=color:#f92672>.</span>appendMessage<span style=color:#f92672>)</span>
  <span style=color:#f92672>}</span>
</code></pre></div></li><li><p><strong>Question 3:</strong> Execute <code>log("Hello World", loggerStr)</code> and <code>log("Hello World", loggerList)</code>
and <code>log("Hello World", loggerStdout)</code></p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scala data-lang=scala>scala<span style=color:#f92672>&gt;</span> log<span style=color:#f92672>(</span><span style=color:#e6db74>&#34;Hello World&#34;</span><span style=color:#f92672>,</span> loggerStr<span style=color:#f92672>)</span>
res0<span style=color:#66d9ef>:</span> <span style=color:#66d9ef>UnknownLogger</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>LogWith</span><span style=color:#f92672>(</span><span style=color:#a6e22e>Hello</span> <span style=color:#a6e22e>World</span><span style=color:#f92672>,</span><span style=color:#a6e22e>$$Lambda$988</span><span style=color:#f92672>/</span><span style=color:#ae81ff>1455466014</span><span style=color:#66d9ef>@</span><span style=color:#ae81ff>421</span>ead7e<span style=color:#f92672>)</span>

scala<span style=color:#f92672>&gt;</span> log<span style=color:#f92672>(</span><span style=color:#e6db74>&#34;Hello World&#34;</span><span style=color:#f92672>,</span> loggerList<span style=color:#f92672>)</span>
res1<span style=color:#66d9ef>:</span> <span style=color:#66d9ef>UnknownLogger</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>LogWith</span><span style=color:#f92672>(</span><span style=color:#a6e22e>List</span><span style=color:#f92672>(</span><span style=color:#a6e22e>Hello</span> <span style=color:#a6e22e>World</span><span style=color:#f92672>),</span><span style=color:#a6e22e>$$Lambda$989</span><span style=color:#f92672>/</span><span style=color:#ae81ff>1705282731</span><span style=color:#66d9ef>@</span><span style=color:#ae81ff>655621</span>fd<span style=color:#f92672>)</span>

scala<span style=color:#f92672>&gt;</span> log<span style=color:#f92672>(</span><span style=color:#e6db74>&#34;Hello World&#34;</span><span style=color:#f92672>,</span> loggerStdout<span style=color:#f92672>)</span>
<span style=color:#a6e22e>Hello</span> <span style=color:#a6e22e>World</span>
res2<span style=color:#66d9ef>:</span> <span style=color:#66d9ef>UnknownLogger</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>LogWith</span><span style=color:#f92672>((),</span><span style=color:#a6e22e>$$Lambda$990</span><span style=color:#f92672>/</span><span style=color:#ae81ff>1835105031</span><span style=color:#66d9ef>@</span><span style=color:#ae81ff>340</span>c57e0<span style=color:#f92672>)</span>
</code></pre></div></li></ul><p>Once again, using all the nice features of <em>Scala</em>,
the production-ready version of the code above is:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scala data-lang=scala><span style=color:#66d9ef>sealed</span> <span style=color:#66d9ef>trait</span> <span style=color:#a6e22e>UnknownLogger</span> <span style=color:#f92672>{</span>
  <span style=color:#66d9ef>type</span> <span style=color:#66d9ef>LogsType</span>
  <span style=color:#66d9ef>val</span> logs <span style=color:#66d9ef>:</span> <span style=color:#66d9ef>LogsType</span>
  <span style=color:#66d9ef>def</span> appendMessage<span style=color:#f92672>(</span>presentLogs<span style=color:#66d9ef>:</span> <span style=color:#66d9ef>LogsType</span><span style=color:#f92672>,</span> message<span style=color:#66d9ef>:</span> <span style=color:#66d9ef>String</span><span style=color:#f92672>)</span><span style=color:#66d9ef>:</span> <span style=color:#66d9ef>LogsType</span>
<span style=color:#f92672>}</span>

<span style=color:#66d9ef>object</span> <span style=color:#a6e22e>UnknownLogger</span> <span style=color:#f92672>{</span>

  <span style=color:#66d9ef>final</span> <span style=color:#66d9ef>case</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>LogWith</span><span style=color:#f92672>[</span><span style=color:#66d9ef>X</span><span style=color:#f92672>](</span>logs <span style=color:#66d9ef>:</span> <span style=color:#66d9ef>X</span><span style=color:#f92672>,</span> appendMessage_ <span style=color:#66d9ef>:</span> <span style=color:#f92672>(</span><span style=color:#66d9ef>X</span><span style=color:#f92672>,</span> <span style=color:#66d9ef>String</span><span style=color:#f92672>)</span> <span style=color:#66d9ef>=&gt;</span> X<span style=color:#f92672>)</span> <span style=color:#66d9ef>extends</span> <span style=color:#a6e22e>UnknownLogger</span> <span style=color:#f92672>{</span>
    <span style=color:#66d9ef>type</span> <span style=color:#66d9ef>LogsType</span> <span style=color:#f92672>=</span> X
    <span style=color:#66d9ef>def</span> appendMessage<span style=color:#f92672>(</span>presentLogs<span style=color:#66d9ef>:</span> <span style=color:#66d9ef>LogsType</span><span style=color:#f92672>,</span> message<span style=color:#66d9ef>:</span> <span style=color:#66d9ef>String</span><span style=color:#f92672>)</span><span style=color:#66d9ef>:</span> <span style=color:#66d9ef>LogsType</span> <span style=color:#f92672>=</span>
      appendMessage_<span style=color:#f92672>(</span>presentLogs<span style=color:#f92672>,</span> message<span style=color:#f92672>)</span>
  <span style=color:#f92672>}</span>

  <span style=color:#66d9ef>def</span> apply<span style=color:#f92672>[</span><span style=color:#66d9ef>X</span><span style=color:#f92672>](</span>logs<span style=color:#66d9ef>:</span> <span style=color:#66d9ef>X</span><span style=color:#f92672>,</span> appendMessage<span style=color:#66d9ef>:</span> <span style=color:#f92672>(</span><span style=color:#66d9ef>X</span><span style=color:#f92672>,</span> <span style=color:#66d9ef>String</span><span style=color:#f92672>)</span> <span style=color:#66d9ef>=&gt;</span> X<span style=color:#f92672>)</span><span style=color:#66d9ef>:</span> <span style=color:#66d9ef>UnknownLogger</span> <span style=color:#f92672>=</span>
    <span style=color:#a6e22e>LogWith</span><span style=color:#f92672>[</span><span style=color:#66d9ef>X</span><span style=color:#f92672>](</span>logs<span style=color:#f92672>,</span> appendMessage<span style=color:#f92672>)</span>
<span style=color:#f92672>}</span>
</code></pre></div><h3 id=intermediary-conclusion>Intermediary Conclusion</h3><p><em>GADTs</em> are actually only this: simple <em>sealed trait</em> with some
<em>case object</em> (possibly none) and some <em>final case class</em> (possible none too!).
In the following parts we will explore some major use cases of <em>GADTs</em></p><h2 id=easy-useful-use-cases-relations-on-types>Easy Useful Use Cases: Relations on Types</h2><p>One easy, but very useful, benefit of <em>GADTs</em> is expressing relations about types such that:</p><ul><li>Is type <code>A</code> equal to type <code>B</code>?</li><li>Is type <code>A</code> a sub-type of <code>B</code>?</li></ul><p>Note that, by definition, a type <code>A</code> is a sub-type of itself (i.e. <code>A &lt;: A</code>),
very much like an integer <code>x</code> is also lesser-than-or-equal to itself <code>x ≤ x</code>.</p><h3 id=use-case-witnessing-type-equality>Use Case: Witnessing Type Equality</h3><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scala data-lang=scala><span style=color:#66d9ef>sealed</span> <span style=color:#66d9ef>trait</span> <span style=color:#a6e22e>EqT</span><span style=color:#f92672>[</span><span style=color:#66d9ef>A</span>,<span style=color:#66d9ef>B</span><span style=color:#f92672>]</span>
<span style=color:#a6e22e>final</span> <span style=color:#66d9ef>case</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>Evidence</span><span style=color:#f92672>[</span><span style=color:#66d9ef>X</span><span style=color:#f92672>]()</span> <span style=color:#66d9ef>extends</span> <span style=color:#a6e22e>EqT</span><span style=color:#f92672>[</span><span style=color:#66d9ef>X</span>,<span style=color:#66d9ef>X</span><span style=color:#f92672>]</span>
</code></pre></div><ul><li><p><strong>Question 1:</strong> Give a value of type <code>EqT[Int, Int]</code></p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scala data-lang=scala>scala<span style=color:#f92672>&gt;</span> <span style=color:#a6e22e>Evidence</span><span style=color:#f92672>[</span><span style=color:#66d9ef>Int</span><span style=color:#f92672>]()</span> <span style=color:#66d9ef>:</span> <span style=color:#66d9ef>EqT</span><span style=color:#f92672>[</span><span style=color:#66d9ef>Int</span>, <span style=color:#66d9ef>Int</span><span style=color:#f92672>]</span>
res0<span style=color:#66d9ef>:</span> <span style=color:#66d9ef>EqT</span><span style=color:#f92672>[</span><span style=color:#66d9ef>Int</span>,<span style=color:#66d9ef>Int</span><span style=color:#f92672>]</span> <span style=color:#66d9ef>=</span> <span style=color:#a6e22e>Evidence</span><span style=color:#f92672>()</span>
</code></pre></div></li><li><p><strong>Question 2:</strong> Give a value of type <code>EqT[String, Int]</code></p><p>The class <code>Evidence</code> is the only concrete sub-class of trait <code>EqT</code> and we cannot
create another one because <code>EqT</code> is <code>sealed</code>. So any value <code>v : EqT[A,B]</code> has to be
an instance of <code>Evidence[X]</code> for some type <code>X</code>, which is of type <code>EqT[X,X]</code>.
Thus there is no way to get a value of type <code>EqT[String, Int]</code>.</p></li><li><p><strong>Question 3:</strong> Given two (unknown) types <code>A</code> and <code>B</code>.
What can you conclude if I give you a value of type <code>EqT[A,B]</code>?</p><p>If I give you a value <code>v : EqT[A,B]</code>, then you know that <code>v</code> is an instance of
<code>Evidence[X]</code> for some (unknown) type <code>X</code> because the class <code>Evidence</code> is the only concrete
sub-class of the sealed trait <code>EqT</code>. Actually <code>Evidence[X]</code> is a sub-type of
<code>EqT[X,X]</code>. Thus <code>v : EqT[X,X]</code>. Types <code>EqT[A,B]</code> and <code>EqT[X,X]</code> have no value in
common if <code>A ≠ X</code> or <code>B ≠ X</code>, so <code>A = X</code> and <code>B = X</code>. Thus <code>A = B</code>.</p></li></ul><p>In production, it is convenient to write the following equivalent code:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scala data-lang=scala><span style=color:#66d9ef>sealed</span> <span style=color:#66d9ef>trait</span> <span style=color:#a6e22e>EqT</span><span style=color:#f92672>[</span><span style=color:#66d9ef>A</span>,<span style=color:#66d9ef>B</span><span style=color:#f92672>]</span>
<span style=color:#a6e22e>object</span> <span style=color:#a6e22e>EqT</span> <span style=color:#f92672>{</span>
  <span style=color:#66d9ef>final</span> <span style=color:#66d9ef>case</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>Evidence</span><span style=color:#f92672>[</span><span style=color:#66d9ef>X</span><span style=color:#f92672>]()</span> <span style=color:#66d9ef>extends</span> <span style=color:#a6e22e>EqT</span><span style=color:#f92672>[</span><span style=color:#66d9ef>X</span>,<span style=color:#66d9ef>X</span><span style=color:#f92672>]</span>

  <span style=color:#66d9ef>implicit</span> <span style=color:#66d9ef>def</span> evidence<span style=color:#f92672>[</span><span style=color:#66d9ef>X</span><span style=color:#f92672>]</span> <span style=color:#66d9ef>:</span> <span style=color:#66d9ef>EqT</span><span style=color:#f92672>[</span><span style=color:#66d9ef>X</span>,<span style=color:#66d9ef>X</span><span style=color:#f92672>]</span> <span style=color:#66d9ef>=</span> <span style=color:#a6e22e>Evidence</span><span style=color:#f92672>[</span><span style=color:#66d9ef>X</span><span style=color:#f92672>]()</span>

  <span style=color:#66d9ef>def</span> apply<span style=color:#f92672>[</span><span style=color:#66d9ef>A</span>,<span style=color:#66d9ef>B</span><span style=color:#f92672>](</span><span style=color:#66d9ef>implicit</span> ev<span style=color:#66d9ef>:</span> <span style=color:#66d9ef>EqT</span><span style=color:#f92672>[</span><span style=color:#66d9ef>A</span>,<span style=color:#66d9ef>B</span><span style=color:#f92672>])</span><span style=color:#66d9ef>:</span> <span style=color:#66d9ef>ev.</span><span style=color:#66d9ef>type</span> <span style=color:#f92672>=</span> ev
<span style=color:#f92672>}</span>
</code></pre></div><h4 id=switching-between-equal-types>Switching between equal types</h4><p>If <code>A</code> and <code>B</code> are actually the same type, then <code>List[A]</code> is also the
same type as <code>List[B]</code>, <code>Option[A]</code> is also the same type as <code>Option[B]</code>,
etc. More generally, for any <code>F[_]</code>, <code>F[A]</code> is also the same type as <code>F[B]</code>.</p><ul><li><p><strong>Question 4:</strong> Write the function <code>def coerce[F[_],A,B](eqT: EqT[A,B])(fa: F[A]): F[B]</code>.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scala data-lang=scala><span style=color:#66d9ef>def</span> coerce<span style=color:#f92672>[</span><span style=color:#66d9ef>F</span><span style=color:#f92672>[</span><span style=color:#66d9ef>_</span><span style=color:#f92672>]</span>,<span style=color:#66d9ef>A</span>,<span style=color:#66d9ef>B</span><span style=color:#f92672>](</span>eqT<span style=color:#66d9ef>:</span> <span style=color:#66d9ef>EqT</span><span style=color:#f92672>[</span><span style=color:#66d9ef>A</span>,<span style=color:#66d9ef>B</span><span style=color:#f92672>])(</span>fa<span style=color:#66d9ef>:</span> <span style=color:#66d9ef>F</span><span style=color:#f92672>[</span><span style=color:#66d9ef>A</span><span style=color:#f92672>])</span><span style=color:#66d9ef>:</span> <span style=color:#66d9ef>F</span><span style=color:#f92672>[</span><span style=color:#66d9ef>B</span><span style=color:#f92672>]</span> <span style=color:#66d9ef>=</span>
  eqT <span style=color:#66d9ef>match</span> <span style=color:#f92672>{</span>
    <span style=color:#66d9ef>case</span> <span style=color:#66d9ef>_</span> <span style=color:#66d9ef>:</span> <span style=color:#66d9ef>Evidence</span><span style=color:#f92672>[</span><span style=color:#66d9ef>x</span><span style=color:#f92672>]</span> <span style=color:#66d9ef>=&gt;</span> fa
  <span style=color:#f92672>}</span>
</code></pre></div></li></ul><p>The <em>Scala</em> standard library already defines a class, named <code>=:=[A,B]</code>
(yes, its name is really <code>=:=</code>), representing type equality.
You&rsquo;re strongly encouraged to have a quick look
<a href=https://www.scala-lang.org/api/current/scala/$eq$colon$eq.html>at its documentation (click here)</a>.
Thankfully, <em>Scala</em> enables to write <code>A =:= B</code> instead of <code>=:=[A,B]</code>.</p><p>Given two types <code>A</code> and <code>B</code>, having an instance (i.e. object)
of <code>A =:= B</code> means that <code>A</code> and <code>B</code> are actually the same type,
just like with <code>EqT[A,B]</code>.
Remember that <code>A =:= B</code> is just syntactic sugar for <code>=:=[A,B]</code>.</p><p>Instances of <code>A =:= B</code> can be created by the function
<a href="https://www.scala-lang.org/api/current/scala/$less$colon$less$.html#refl%5BA%5D:A=:=A"><code>(&lt;:&lt;).refl[X]: X =:= X</code>
(click for docs)</a>.
The &ldquo;symbol&rdquo; <code>&lt;:&lt;</code> is indeed a valid name for an object.</p><ul><li><p><strong>Question 5:</strong> Using the function <code>coerce</code> above,
write the function <code>def toScalaEq[A,B](eqT: EqT[A,B]): A =:= B</code>.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scala data-lang=scala><span style=color:#66d9ef>def</span> toScalaEq<span style=color:#f92672>[</span><span style=color:#66d9ef>A</span>,<span style=color:#66d9ef>B</span><span style=color:#f92672>](</span>eqT<span style=color:#66d9ef>:</span> <span style=color:#66d9ef>EqT</span><span style=color:#f92672>[</span><span style=color:#66d9ef>A</span>,<span style=color:#66d9ef>B</span><span style=color:#f92672>])</span><span style=color:#66d9ef>:</span> <span style=color:#66d9ef>A</span> <span style=color:#f92672>=</span><span style=color:#66d9ef>:</span><span style=color:#f92672>=</span> B <span style=color:#66d9ef>=</span> <span style=color:#f92672>{</span>
  <span style=color:#75715e>/* Find a definition for:
</span><span style=color:#75715e>        - the type constructor `F`
</span><span style=color:#75715e>        - the value `fa : F[A]`
</span><span style=color:#75715e>  */</span>
  <span style=color:#66d9ef>type</span> <span style=color:#66d9ef>F</span><span style=color:#f92672>[</span><span style=color:#66d9ef>X</span><span style=color:#f92672>]</span> <span style=color:#66d9ef>=</span> <span style=color:#f92672>???</span>
  <span style=color:#66d9ef>val</span> fa <span style=color:#66d9ef>:</span> <span style=color:#66d9ef>F</span><span style=color:#f92672>[</span><span style=color:#66d9ef>A</span><span style=color:#f92672>]</span> <span style=color:#66d9ef>=</span> <span style=color:#f92672>???</span>

  <span style=color:#75715e>/* Such that this call: */</span>
  coerce<span style=color:#f92672>[</span><span style=color:#66d9ef>F</span>,<span style=color:#66d9ef>A</span>,<span style=color:#66d9ef>B</span><span style=color:#f92672>](</span>eqT<span style=color:#f92672>)(</span>fa<span style=color:#f92672>)</span> <span style=color:#75715e>// is of type `F[B]`
</span><span style=color:#75715e></span><span style=color:#f92672>}</span>
</code></pre></div><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scala data-lang=scala><span style=color:#66d9ef>def</span> toScalaEq<span style=color:#f92672>[</span><span style=color:#66d9ef>A</span>,<span style=color:#66d9ef>B</span><span style=color:#f92672>](</span>eqT<span style=color:#66d9ef>:</span> <span style=color:#66d9ef>EqT</span><span style=color:#f92672>[</span><span style=color:#66d9ef>A</span>,<span style=color:#66d9ef>B</span><span style=color:#f92672>])</span><span style=color:#66d9ef>:</span> <span style=color:#66d9ef>A</span> <span style=color:#f92672>=</span><span style=color:#66d9ef>:</span><span style=color:#f92672>=</span> B <span style=color:#66d9ef>=</span> <span style=color:#f92672>{</span>
  <span style=color:#66d9ef>type</span> <span style=color:#66d9ef>F</span><span style=color:#f92672>[</span><span style=color:#66d9ef>X</span><span style=color:#f92672>]</span> <span style=color:#66d9ef>=</span> A <span style=color:#f92672>=:=</span> X
  <span style=color:#66d9ef>val</span> fa<span style=color:#66d9ef>:</span> <span style=color:#66d9ef>F</span><span style=color:#f92672>[</span><span style=color:#66d9ef>A</span><span style=color:#f92672>]</span> <span style=color:#66d9ef>=</span> <span style=color:#f92672>(&lt;:&lt;).</span>refl<span style=color:#f92672>[</span><span style=color:#66d9ef>A</span><span style=color:#f92672>]</span>
  coerce<span style=color:#f92672>[</span><span style=color:#66d9ef>F</span>,<span style=color:#66d9ef>A</span>,<span style=color:#66d9ef>B</span><span style=color:#f92672>](</span>eqT<span style=color:#f92672>)(</span>fa<span style=color:#f92672>)</span>
<span style=color:#f92672>}</span>
</code></pre></div></li><li><p><strong>Question 6:</strong> Using the <em>method</em> <code>substituteCo[F[_]](ff: F[A]): F[B]</code> of
objects of class <code>A =:= B</code>, whose
<a href=https://www.scala-lang.org/api/current/scala/$eq$colon$eq.html#substituteCo%5BF%5B_%5D%5D(ff:F%5BFrom%5D):F%5BTo%5D>documentation is here</a>,
write the function <code>def fromScalaEq[A,B](scala: A =:= B): EqT[A,B]</code>.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scala data-lang=scala><span style=color:#66d9ef>def</span> fromScalaEq<span style=color:#f92672>[</span><span style=color:#66d9ef>A</span>,<span style=color:#66d9ef>B</span><span style=color:#f92672>](</span>scala<span style=color:#66d9ef>:</span> <span style=color:#66d9ef>A</span> <span style=color:#f92672>=</span><span style=color:#66d9ef>:</span><span style=color:#f92672>=</span> B<span style=color:#f92672>)</span><span style=color:#66d9ef>:</span> <span style=color:#66d9ef>EqT</span><span style=color:#f92672>[</span><span style=color:#66d9ef>A</span>,<span style=color:#66d9ef>B</span><span style=color:#f92672>]</span> <span style=color:#66d9ef>=</span> <span style=color:#f92672>{</span>
  <span style=color:#75715e>/* Find a definition for:
</span><span style=color:#75715e>        - the type constructor `F`
</span><span style=color:#75715e>        - the value `fa : F[A]`
</span><span style=color:#75715e>  */</span>
  <span style=color:#66d9ef>type</span> <span style=color:#66d9ef>F</span><span style=color:#f92672>[</span><span style=color:#66d9ef>X</span><span style=color:#f92672>]</span> <span style=color:#66d9ef>=</span> <span style=color:#f92672>???</span>
  <span style=color:#66d9ef>val</span> fa <span style=color:#66d9ef>:</span> <span style=color:#66d9ef>F</span><span style=color:#f92672>[</span><span style=color:#66d9ef>A</span><span style=color:#f92672>]</span> <span style=color:#66d9ef>=</span> <span style=color:#f92672>???</span>

  <span style=color:#75715e>/* Such that this call: */</span>
  scala<span style=color:#f92672>.</span>substituteCo<span style=color:#f92672>[</span><span style=color:#66d9ef>F</span><span style=color:#f92672>](</span>fa<span style=color:#f92672>)</span> <span style=color:#75715e>// is of type `F[B]`
</span><span style=color:#75715e></span><span style=color:#f92672>}</span>
</code></pre></div><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scala data-lang=scala><span style=color:#66d9ef>def</span> fromScalaEq<span style=color:#f92672>[</span><span style=color:#66d9ef>A</span>,<span style=color:#66d9ef>B</span><span style=color:#f92672>](</span>scala<span style=color:#66d9ef>:</span> <span style=color:#66d9ef>A</span> <span style=color:#f92672>=</span><span style=color:#66d9ef>:</span><span style=color:#f92672>=</span> B<span style=color:#f92672>)</span><span style=color:#66d9ef>:</span> <span style=color:#66d9ef>EqT</span><span style=color:#f92672>[</span><span style=color:#66d9ef>A</span>,<span style=color:#66d9ef>B</span><span style=color:#f92672>]</span> <span style=color:#66d9ef>=</span> <span style=color:#f92672>{</span>
  <span style=color:#66d9ef>type</span> <span style=color:#66d9ef>F</span><span style=color:#f92672>[</span><span style=color:#66d9ef>X</span><span style=color:#f92672>]</span> <span style=color:#66d9ef>=</span> <span style=color:#a6e22e>EqT</span><span style=color:#f92672>[</span><span style=color:#66d9ef>A</span>,<span style=color:#66d9ef>X</span><span style=color:#f92672>]</span>
  <span style=color:#66d9ef>val</span> fa<span style=color:#66d9ef>:</span> <span style=color:#66d9ef>F</span><span style=color:#f92672>[</span><span style=color:#66d9ef>A</span><span style=color:#f92672>]</span> <span style=color:#66d9ef>=</span> <span style=color:#a6e22e>Evidence</span><span style=color:#f92672>[</span><span style=color:#66d9ef>A</span><span style=color:#f92672>]()</span>
  scala<span style=color:#f92672>.</span>substituteCo<span style=color:#f92672>[</span><span style=color:#66d9ef>F</span><span style=color:#f92672>](</span>fa<span style=color:#f92672>)</span>
<span style=color:#f92672>}</span>
</code></pre></div></li></ul><h3 id=use-case-witnessing-sub-typing>Use Case: Witnessing Sub Typing</h3><p>In this section, we want to create types <code>SubTypeOf[A,B]</code> whose values prove
that the type <code>A</code> is a sub-type of <code>B</code> (i.e. <code>A &lt;: B</code>).
A similar <em>but different</em> class already exists in the <em>Scala</em> library.
It is named <code>&lt;:&lt;[A,B]</code>, which is often written <code>A &lt;:&lt; B</code>. Its
<a href=https://www.scala-lang.org/api/current/scala/$less$colon$less.html>documentation is here</a>.
Because this section is about implementing a variant of this class,
please <strong>do not use</strong> <code>&lt;:&lt;[A,B]</code> to implement <code>SubTypeOf</code>.</p><ul><li><p><strong>Question 1:</strong> Using only <em>upper bounds</em> (i.e. <code>A &lt;: B</code>) or <em>lower bounds</em> (i.e. <code>A >: B</code>)
and <strong>no</strong> <em>variance annotation</em> (i.e. <code>[+A]</code> and <code>[-A]</code>),
create the trait <code>SubTypeOf[A,B]</code> (and all that is necessary) such that:</p><blockquote><p>There exists a value of type <code>SubType[A,B]</code> <strong>if and only if</strong>
<code>A</code> is a sub-type of <code>B</code> (i.e. <code>A &lt;: B</code>).</p></blockquote><p>Remember that, by definition, a type <code>A</code> is a sub-type of itself (i.e. <code>A &lt;: A</code>).</p><p>Remember that you should not use the <code>class &lt;:&lt;[A,B]</code>.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scala data-lang=scala><span style=color:#66d9ef>sealed</span> <span style=color:#66d9ef>trait</span> <span style=color:#a6e22e>SubTypeOf</span><span style=color:#f92672>[</span><span style=color:#66d9ef>A</span>,<span style=color:#66d9ef>B</span><span style=color:#f92672>]</span>
<span style=color:#a6e22e>final</span> <span style=color:#66d9ef>case</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>SubTypeEvidence</span><span style=color:#f92672>[</span><span style=color:#66d9ef>A</span> <span style=color:#66d9ef>&lt;:</span> <span style=color:#66d9ef>B</span>, <span style=color:#66d9ef>B</span><span style=color:#f92672>]()</span> <span style=color:#66d9ef>extends</span> <span style=color:#a6e22e>SubTypeOf</span><span style=color:#f92672>[</span><span style=color:#66d9ef>A</span>,<span style=color:#66d9ef>B</span><span style=color:#f92672>]</span>
</code></pre></div><p>In production, it is convenient to write the following equivalent code:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scala data-lang=scala><span style=color:#66d9ef>sealed</span> <span style=color:#66d9ef>trait</span> <span style=color:#a6e22e>SubTypeOf</span><span style=color:#f92672>[</span><span style=color:#66d9ef>A</span>,<span style=color:#66d9ef>B</span><span style=color:#f92672>]</span>
<span style=color:#a6e22e>object</span> <span style=color:#a6e22e>SubTypeOf</span> <span style=color:#f92672>{</span>
  <span style=color:#66d9ef>final</span> <span style=color:#66d9ef>case</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>Evidence</span><span style=color:#f92672>[</span><span style=color:#66d9ef>A</span> <span style=color:#66d9ef>&lt;:</span> <span style=color:#66d9ef>B</span>, <span style=color:#66d9ef>B</span><span style=color:#f92672>]()</span> <span style=color:#66d9ef>extends</span> <span style=color:#a6e22e>SubTypeOf</span><span style=color:#f92672>[</span><span style=color:#66d9ef>A</span>,<span style=color:#66d9ef>B</span><span style=color:#f92672>]</span>

  <span style=color:#66d9ef>implicit</span> <span style=color:#66d9ef>def</span> evidence<span style=color:#f92672>[</span><span style=color:#66d9ef>A</span> <span style=color:#66d9ef>&lt;:</span> <span style=color:#66d9ef>B</span>, <span style=color:#66d9ef>B</span><span style=color:#f92672>]</span><span style=color:#66d9ef>:</span> <span style=color:#66d9ef>SubTypeOf</span><span style=color:#f92672>[</span><span style=color:#66d9ef>A</span>,<span style=color:#66d9ef>B</span><span style=color:#f92672>]</span> <span style=color:#66d9ef>=</span> <span style=color:#a6e22e>Evidence</span><span style=color:#f92672>[</span><span style=color:#66d9ef>A</span>,<span style=color:#66d9ef>B</span><span style=color:#f92672>]()</span>

  <span style=color:#66d9ef>def</span> apply<span style=color:#f92672>[</span><span style=color:#66d9ef>A</span>,<span style=color:#66d9ef>B</span><span style=color:#f92672>](</span><span style=color:#66d9ef>implicit</span> ev<span style=color:#66d9ef>:</span> <span style=color:#66d9ef>SubTypeOf</span><span style=color:#f92672>[</span><span style=color:#66d9ef>A</span>,<span style=color:#66d9ef>B</span><span style=color:#f92672>])</span><span style=color:#66d9ef>:</span> <span style=color:#66d9ef>ev.</span><span style=color:#66d9ef>type</span> <span style=color:#f92672>=</span> ev
<span style=color:#f92672>}</span>
</code></pre></div></li></ul><h3 id=use-case-avoiding-annoying-scalac-error-messages-about-bounds-not-respected>Use Case: Avoiding annoying <em>scalac</em> error messages about bounds not respected</h3><p>In this example, we want to model the diet of some animals.
We start by defining the <code>Food</code> type and some of its subtypes:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scala data-lang=scala><span style=color:#66d9ef>trait</span> <span style=color:#a6e22e>Food</span>
<span style=color:#66d9ef>class</span> <span style=color:#a6e22e>Vegetable</span> <span style=color:#66d9ef>extends</span> <span style=color:#a6e22e>Food</span>
<span style=color:#66d9ef>class</span> <span style=color:#a6e22e>Fruit</span> <span style=color:#66d9ef>extends</span> <span style=color:#a6e22e>Food</span>
</code></pre></div><p>and then the class representing animals eating food of type <code>A</code>
(i.e. <code>Vegetable</code>, <code>Fruit</code>, etc):</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scala data-lang=scala><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>AnimalEating</span><span style=color:#f92672>[</span><span style=color:#66d9ef>A</span> <span style=color:#66d9ef>&lt;:</span> <span style=color:#66d9ef>Food</span><span style=color:#f92672>]</span>

<span style=color:#a6e22e>val</span> elephant <span style=color:#66d9ef>:</span> <span style=color:#66d9ef>AnimalEating</span><span style=color:#f92672>[</span><span style=color:#66d9ef>Vegetable</span><span style=color:#f92672>]</span> <span style=color:#66d9ef>=</span>
  <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>AnimalEating</span><span style=color:#f92672>[</span><span style=color:#66d9ef>Vegetable</span><span style=color:#f92672>]</span>
</code></pre></div><p>Let&rsquo;s define a function like there are so many in
<em>Functional Programming</em>, and apply it to <code>elephant</code>:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scala data-lang=scala><span style=color:#66d9ef>def</span> dummy<span style=color:#f92672>[</span><span style=color:#66d9ef>F</span><span style=color:#f92672>[</span><span style=color:#66d9ef>_</span><span style=color:#f92672>]</span>,<span style=color:#66d9ef>A</span><span style=color:#f92672>](</span>fa<span style=color:#66d9ef>:</span> <span style=color:#66d9ef>F</span><span style=color:#f92672>[</span><span style=color:#66d9ef>A</span><span style=color:#f92672>])</span><span style=color:#66d9ef>:</span> <span style=color:#66d9ef>String</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;Ok!&#34;</span>
</code></pre></div><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scala data-lang=scala>scala<span style=color:#f92672>&gt;</span> dummy<span style=color:#f92672>[</span><span style=color:#66d9ef>List</span>, <span style=color:#66d9ef>Int</span><span style=color:#f92672>](</span><span style=color:#a6e22e>List</span><span style=color:#f92672>(</span><span style=color:#ae81ff>1</span><span style=color:#f92672>,</span><span style=color:#ae81ff>2</span><span style=color:#f92672>,</span><span style=color:#ae81ff>3</span><span style=color:#f92672>))</span>
res0<span style=color:#66d9ef>:</span> <span style=color:#66d9ef>String</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>Ok</span><span style=color:#f92672>!</span>

scala<span style=color:#f92672>&gt;</span> dummy<span style=color:#f92672>[</span><span style=color:#66d9ef>Option</span>, <span style=color:#66d9ef>Boolean</span><span style=color:#f92672>](</span><span style=color:#a6e22e>Some</span><span style=color:#f92672>(</span><span style=color:#66d9ef>true</span><span style=color:#f92672>))</span>
res1<span style=color:#66d9ef>:</span> <span style=color:#66d9ef>String</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>Ok</span><span style=color:#f92672>!</span>

scala<span style=color:#f92672>&gt;</span> dummy<span style=color:#f92672>[</span><span style=color:#66d9ef>AnimalEating</span>, <span style=color:#66d9ef>Vegetable</span><span style=color:#f92672>](</span>elephant<span style=color:#f92672>)</span>
            <span style=color:#f92672>^</span>
       error<span style=color:#66d9ef>:</span> <span style=color:#66d9ef>kinds</span> <span style=color:#66d9ef>of</span> <span style=color:#66d9ef>the</span> <span style=color:#66d9ef>type</span> <span style=color:#66d9ef>arguments</span> <span style=color:#f92672>(</span><span style=color:#66d9ef>AnimalEating</span><span style=color:#f92672>,</span><span style=color:#66d9ef>Vegetable</span><span style=color:#f92672>)</span>
       <span style=color:#66d9ef>do</span> not conform to the expected kinds of the <span style=color:#66d9ef>type</span> <span style=color:#66d9ef>parameters</span> <span style=color:#f92672>(</span><span style=color:#66d9ef>type</span> <span style=color:#66d9ef>F</span><span style=color:#f92672>,</span><span style=color:#66d9ef>type</span> <span style=color:#66d9ef>A</span><span style=color:#f92672>).</span>

       <span style=color:#a6e22e>AnimalEating</span>&#39;s <span style=color:#66d9ef>type</span> <span style=color:#66d9ef>parameters</span> <span style=color:#66d9ef>do</span> <span style=color:#66d9ef>not</span> <span style=color:#66d9ef>match</span> <span style=color:#66d9ef>type</span> <span style=color:#66d9ef>F</span><span style=color:#960050;background-color:#1e0010>&#39;</span><span style=color:#66d9ef>s</span> <span style=color:#66d9ef>expected</span> <span style=color:#66d9ef>parameters:</span>
       <span style=color:#66d9ef>type</span> <span style=color:#66d9ef>A</span><span style=color:#960050;background-color:#1e0010>&#39;</span><span style=color:#66d9ef>s</span> <span style=color:#66d9ef>bounds</span> <span style=color:#66d9ef>&lt;:</span> <span style=color:#66d9ef>Food</span> <span style=color:#66d9ef>are</span> <span style=color:#66d9ef>stricter</span> <span style=color:#66d9ef>than</span>
       <span style=color:#66d9ef>type</span> <span style=color:#66d9ef>_</span><span style=color:#960050;background-color:#1e0010>&#39;</span><span style=color:#66d9ef>s</span> <span style=color:#66d9ef>declared</span> <span style=color:#66d9ef>bounds</span> <span style=color:#66d9ef>&gt;:</span> <span style=color:#66d9ef>Nothing</span> <span style=color:#66d9ef>&lt;:</span> <span style=color:#66d9ef>Any</span>
</code></pre></div><ul><li><p><strong>Question 1:</strong> Why does <em>scalac</em> complains?</p><p>The function <code>dummy</code> requires its argument <code>F</code>, which is a type constructor
like <code>List</code>, <code>Option</code>, <code>Future</code>, etc, to accept any type
as argument so that we can write <code>F[A]</code> for any type <code>A</code>. On the contrary,
<code>AnimalEating</code> requires its argument to be a sub-type of <code>Food</code>.
Thus <code>AnimalEating</code> can not be used as <code>dummy</code>&rsquo;s argument <code>F</code>.</p></li></ul><p>The problem is that, when we defined <code>class AnimalEating[A &lt;: Food]</code>,
we gave the restriction that <code>A &lt;: Food</code>. So <em>Scala</em>, like <em>Java</em>,
forbids us to give <code>AnimalEating</code> anything but a sub-type of <code>Food</code>
(including <code>Food</code> itself):</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scala data-lang=scala>scala<span style=color:#f92672>&gt;</span> <span style=color:#66d9ef>type</span> <span style=color:#66d9ef>T1</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>AnimalEating</span><span style=color:#f92672>[</span><span style=color:#66d9ef>Int</span><span style=color:#f92672>]</span>
                 <span style=color:#f92672>^</span>
       error<span style=color:#66d9ef>:</span> <span style=color:#66d9ef>type</span> <span style=color:#66d9ef>arguments</span> <span style=color:#f92672>[</span><span style=color:#66d9ef>Int</span><span style=color:#f92672>]</span> <span style=color:#66d9ef>do</span> not conform
       to <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>AnimalEating</span>&#39;s <span style=color:#66d9ef>type</span> <span style=color:#66d9ef>parameter</span> <span style=color:#66d9ef>bounds</span> <span style=color:#f92672>[</span><span style=color:#66d9ef>A</span> <span style=color:#66d9ef>&lt;:</span> <span style=color:#66d9ef>Food</span><span style=color:#f92672>]</span>

scala<span style=color:#f92672>&gt;</span> <span style=color:#66d9ef>type</span> <span style=color:#66d9ef>T2</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>AnimalEating</span><span style=color:#f92672>[</span><span style=color:#66d9ef>Food</span><span style=color:#f92672>]</span>
defined <span style=color:#66d9ef>type</span> <span style=color:#66d9ef>alias</span> <span style=color:#66d9ef>T2</span>
</code></pre></div><p>We face a dilemma: to use the function <code>dummy</code>, that we really want
to use because it&rsquo;s a very nice function, we need to remove the
constraint <code>A &lt;: Food</code> from the definition <code>class AnimalEating[A &lt;: Food]</code>.
But we still want to say that animals eat food, not integers,
boolean or strings!</p><ul><li><p><strong>Question 2:</strong> How can you adapt the definition of <code>AnimalEating</code> so that:</p><ul><li><p>We can call <code>dummy</code> on <code>elephant</code>! We want:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scala data-lang=scala>scala<span style=color:#f92672>&gt;</span> dummy<span style=color:#f92672>[</span><span style=color:#66d9ef>AnimalEating</span>, <span style=color:#66d9ef>Vegetable</span><span style=color:#f92672>](</span>elephant<span style=color:#f92672>)</span>
res0<span style=color:#66d9ef>:</span> <span style=color:#66d9ef>String</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>Ok</span><span style=color:#f92672>!</span>
</code></pre></div></li><li><p><em>If</em> <code>A</code> is <strong>not a sub-type</strong> of <code>Food</code> (including <code>Food</code> itself),
<em>then</em> it is <strong>impossible</strong> to create an instance of <code>AnimalEating[A]</code>.</p></li><li><p>The class <code>AnimalEating</code> <strong>must</strong> remain an open class
(i.e. neither sealed nor final)! It should be possible for anyone, anywhen,
to create, freely, sub-classes of <code>AnimalEating</code>. Obviously those
sub-classes must satisfy the constraints above.</p><p>In <em>Scala</em>, <code>Nothing</code> is a type having no value.
Can you create a value of type <code>(Nothing, Int)</code>? Why?</p><p>If, to create an instance of <code>AnimalEating[A]</code>, we force <strong>every</strong>
creation method to take an extra paramerer of type <code>SubTypeOf[A, Food]</code>,
then it will only be possible to create an instance of <code>AnimalEating[A]</code>
when <code>A</code> is a sub-type of <code>Food</code>:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scala data-lang=scala><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>AnimalEating</span><span style=color:#f92672>[</span><span style=color:#66d9ef>A</span><span style=color:#f92672>](</span>ev <span style=color:#66d9ef>:</span> <span style=color:#66d9ef>SubTypeOf</span><span style=color:#f92672>[</span><span style=color:#66d9ef>A</span>, <span style=color:#66d9ef>Food</span><span style=color:#f92672>])</span>

<span style=color:#66d9ef>val</span> elephant <span style=color:#66d9ef>:</span> <span style=color:#66d9ef>AnimalEating</span><span style=color:#f92672>[</span><span style=color:#66d9ef>Vegetable</span><span style=color:#f92672>]</span> <span style=color:#66d9ef>=</span>
  <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>AnimalEating</span><span style=color:#f92672>[</span><span style=color:#66d9ef>Vegetable</span><span style=color:#f92672>](</span><span style=color:#a6e22e>SubTypeEvidence</span><span style=color:#f92672>[</span><span style=color:#66d9ef>Vegetable</span>, <span style=color:#66d9ef>Food</span><span style=color:#f92672>])</span>
</code></pre></div><p>To create a value of type <code>AnimalEating[A]</code>, we need to call
<code>AnimalEating</code>&rsquo;s constructor. And to call this constructor,
we need to provide <code>ev : SubTypeOf[A, Food]</code>.</p><p>Now we can apply the <code>dummy</code> function on <code>elephant</code>:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scala data-lang=scala>scala<span style=color:#f92672>&gt;</span> dummy<span style=color:#f92672>[</span><span style=color:#66d9ef>AnimalEating</span>, <span style=color:#66d9ef>Vegetable</span><span style=color:#f92672>](</span>elephant<span style=color:#f92672>)</span>
res0<span style=color:#66d9ef>:</span> <span style=color:#66d9ef>String</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>Ok</span><span style=color:#f92672>!</span>
</code></pre></div><p>In practice, using implicits, we let the compiler
fill the parameter <code>ev : SubTypeOf[A, Food]</code> itself.</p><p>Note that you can now express the type <code>AnimalEating[Int]</code>
but you won&rsquo;t be able to create a value of this type.</p></li></ul></li></ul><h3 id=use-case-give-the-right-data-to-the-right-chart>Use Case: Give the right data to the right chart</h3><p>This use case is about enforcing at compile-time that only values
of the right type can be given to a function. In this example, we
consider the design of a chart library. For simplicity&rsquo;s sake, we will
assume that our library only supports two kinds of charts:
<a href="https://www.google.com/search?q=pie+chart&tbm=isch">Pie charts</a>
and
<a href="https://www.google.com/search?q=xy+charts&tbm=isch">XY charts</a>.
This is written in <em>Scala</em> via the enumeration:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scala data-lang=scala><span style=color:#66d9ef>sealed</span> <span style=color:#66d9ef>trait</span> <span style=color:#a6e22e>ChartType</span>
<span style=color:#66d9ef>case</span> <span style=color:#66d9ef>object</span> <span style=color:#a6e22e>PieChart</span> <span style=color:#66d9ef>extends</span> <span style=color:#a6e22e>ChartType</span>
<span style=color:#66d9ef>case</span> <span style=color:#66d9ef>object</span> <span style=color:#a6e22e>XYChart</span> <span style=color:#66d9ef>extends</span> <span style=color:#a6e22e>ChartType</span>
</code></pre></div><p>Obviously <em>Pie</em> and <em>XY</em> charts rely on different kinds of data.
Once again for simplicity&rsquo;s sake, we will assume that our two
kinds of data are:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scala data-lang=scala><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>PieData</span>
<span style=color:#66d9ef>class</span> <span style=color:#a6e22e>XYData</span>
</code></pre></div><p>A <em>pie</em> chart (<code>PieChart</code>) plots <strong>only</strong> <code>PieData</code>,
whereas an <em>XY</em> chart (<code>XYChart</code>) plots <strong>only</strong> <code>XYData</code>.
Here is our drawing function <code>draw</code>:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scala data-lang=scala><span style=color:#66d9ef>def</span> draw<span style=color:#f92672>[</span><span style=color:#66d9ef>A</span><span style=color:#f92672>](</span>chartType<span style=color:#66d9ef>:</span> <span style=color:#66d9ef>ChartType</span><span style=color:#f92672>)(</span>data<span style=color:#66d9ef>:</span> <span style=color:#66d9ef>A</span><span style=color:#f92672>)</span><span style=color:#66d9ef>:</span> <span style=color:#66d9ef>Unit</span> <span style=color:#f92672>=</span>
  chartType <span style=color:#66d9ef>match</span> <span style=color:#f92672>{</span>
    <span style=color:#66d9ef>case</span> <span style=color:#a6e22e>PieChart</span> <span style=color:#66d9ef>=&gt;</span>
      <span style=color:#66d9ef>val</span> pieData <span style=color:#66d9ef>=</span> data<span style=color:#f92672>.</span>asInstanceOf<span style=color:#f92672>[</span><span style=color:#66d9ef>PieData</span><span style=color:#f92672>]</span>
      <span style=color:#75715e>// Do some stuff to draw pieData
</span><span style=color:#75715e></span>      <span style=color:#f92672>()</span>
    <span style=color:#66d9ef>case</span> <span style=color:#a6e22e>XYChart</span> <span style=color:#66d9ef>=&gt;</span>
      <span style=color:#66d9ef>val</span> xyData <span style=color:#66d9ef>=</span> data<span style=color:#f92672>.</span>asInstanceOf<span style=color:#f92672>[</span><span style=color:#66d9ef>XYData</span><span style=color:#f92672>]</span>
      <span style=color:#75715e>// Do some stuff to draw xyData
</span><span style=color:#75715e></span>      <span style=color:#f92672>()</span>
  <span style=color:#f92672>}</span>
</code></pre></div><p>It assumes that the user will only call <code>draw</code> on the right data.
When <code>chartType</code> is <code>PieChart</code>, the function assumes, via
<code>data.asInstanceOf[PieData]</code> that <code>data</code> is actually of type <code>PieData</code>.
And when <code>chartType</code> is <code>XYChart</code>, it assumes that <code>data</code> is actually
of type <code>XYData</code>.</p><p>The problem is that these assumptions rely on the hypothesis that
users and developers will always make sure they are calling <code>draw</code> on
the right data type. But nothing stops someone to call <code>draw</code> on a
<code>PieChart</code> with <code>XYData</code> (or the opposite), crashing the system miserably at runtime!</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scala data-lang=scala>scala<span style=color:#f92672>&gt;</span> draw<span style=color:#f92672>(</span><span style=color:#a6e22e>PieChart</span><span style=color:#f92672>)(</span><span style=color:#66d9ef>new</span> <span style=color:#a6e22e>XYData</span><span style=color:#f92672>)</span>
java<span style=color:#f92672>.</span>lang<span style=color:#f92672>.</span><span style=color:#a6e22e>ClassCastException</span><span style=color:#66d9ef>:</span> <span style=color:#66d9ef>XYData</span> <span style=color:#66d9ef>cannot</span> <span style=color:#66d9ef>be</span> <span style=color:#66d9ef>cast</span> <span style=color:#66d9ef>to</span> <span style=color:#66d9ef>PieData</span>
  at <span style=color:#f92672>.</span>draw<span style=color:#f92672>(&lt;</span>pastie<span style=color:#66d9ef>&gt;:</span><span style=color:#ae81ff>11</span><span style=color:#f92672>)</span>
  <span style=color:#f92672>...</span> <span style=color:#ae81ff>28</span> elided
</code></pre></div><p>As developers, we know mistakes do happen! We want a way to prevent
theses annoying bugs to happen in production! We want to enforce at
compile-time that only these two scenarii are possible:</p><ul><li>When <code>draw</code> is called with <code>chartType == PieChart</code>:
the argument <code>data</code> can only be of type <code>PieData</code></li><li>When <code>draw</code> is called with <code>chartType == XYChart</code>:
the argument <code>data</code> can only be of type <code>XYData</code>.</li></ul><p>Remember that these two constraints have to be enforced at compile-time!</p><ul><li><p><strong>Question 1:</strong> Adapt the definition of <code>ChartType</code>, <code>PieChart</code>, <code>XYChart</code> and <code>draw</code> such that:</p><ul><li><p>Any scenario other than the two above will make the compilation fail
on a type error.</p></li><li><p><code>ChartType</code> must still be a <code>sealed trait</code>.
It is now allowed to have <em>type parameters</em> (i.e. <em>generics</em>).</p></li><li><p><code>PieChart</code> and <code>XYChar</code> must still be two <code>case object</code>.
They should still extends <code>ChartType</code>.</p></li><li><p><code>ChartType</code>, <code>PieChart</code> and <code>XYChar</code> declarations must have <em>no body</em> at all
(i.e. there should be no brackets <code>{ ... }</code> in their declaration).</p></li></ul><p>The code looks like this:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scala data-lang=scala><span style=color:#66d9ef>sealed</span> <span style=color:#66d9ef>trait</span> <span style=color:#a6e22e>ChartType</span><span style=color:#f92672>[</span><span style=color:#66d9ef>/*PUT</span> <span style=color:#66d9ef>SOME</span> <span style=color:#66d9ef>GENERICS</span> <span style=color:#66d9ef>HERE*/</span><span style=color:#f92672>]</span>
<span style=color:#a6e22e>case</span> <span style=color:#66d9ef>object</span> <span style=color:#a6e22e>PieChart</span> <span style=color:#66d9ef>extends</span> <span style=color:#a6e22e>ChartType</span><span style=color:#f92672>[</span><span style=color:#66d9ef>/*There</span> <span style=color:#66d9ef>is</span> <span style=color:#66d9ef>something</span> <span style=color:#66d9ef>to</span> <span style=color:#66d9ef>write</span> <span style=color:#66d9ef>here*/</span><span style=color:#f92672>]</span>
<span style=color:#66d9ef>case</span> <span style=color:#66d9ef>object</span> <span style=color:#a6e22e>XYChart</span> <span style=color:#66d9ef>extends</span> <span style=color:#a6e22e>ChartType</span><span style=color:#f92672>[</span><span style=color:#66d9ef>/*There</span> <span style=color:#66d9ef>is</span> <span style=color:#66d9ef>something</span> <span style=color:#66d9ef>to</span> <span style=color:#66d9ef>write</span> <span style=color:#66d9ef>here</span> <span style=color:#66d9ef>too*/</span><span style=color:#f92672>]</span>

<span style=color:#66d9ef>def</span> draw<span style=color:#f92672>[</span><span style=color:#66d9ef>A</span><span style=color:#f92672>](</span>chartType<span style=color:#66d9ef>:</span> <span style=color:#66d9ef>ChartType</span><span style=color:#f92672>[</span><span style=color:#66d9ef>/*Write</span> <span style=color:#66d9ef>something</span> <span style=color:#66d9ef>here*/</span><span style=color:#f92672>])(</span>data<span style=color:#66d9ef>:</span> <span style=color:#66d9ef>A</span><span style=color:#f92672>)</span><span style=color:#66d9ef>:</span> <span style=color:#66d9ef>Unit</span> <span style=color:#f92672>=</span>
 chartType <span style=color:#66d9ef>match</span> <span style=color:#f92672>{</span>
    <span style=color:#66d9ef>case</span> <span style=color:#a6e22e>PieChart</span> <span style=color:#66d9ef>=&gt;</span>
      <span style=color:#66d9ef>val</span> pieData <span style=color:#66d9ef>:</span> <span style=color:#66d9ef>PieData</span> <span style=color:#f92672>=</span> data
      <span style=color:#f92672>()</span>
    <span style=color:#66d9ef>case</span> <span style=color:#a6e22e>XYChart</span> <span style=color:#66d9ef>=&gt;</span>
      <span style=color:#66d9ef>val</span> xyData<span style=color:#66d9ef>:</span> <span style=color:#66d9ef>XYData</span> <span style=color:#f92672>=</span> data
      <span style=color:#f92672>()</span>
    <span style=color:#f92672>}</span>
</code></pre></div><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scala data-lang=scala><span style=color:#66d9ef>sealed</span> <span style=color:#66d9ef>trait</span> <span style=color:#a6e22e>ChartType</span><span style=color:#f92672>[</span><span style=color:#66d9ef>A</span><span style=color:#f92672>]</span>
<span style=color:#a6e22e>case</span> <span style=color:#66d9ef>object</span> <span style=color:#a6e22e>PieChart</span> <span style=color:#66d9ef>extends</span> <span style=color:#a6e22e>ChartType</span><span style=color:#f92672>[</span><span style=color:#66d9ef>PieData</span><span style=color:#f92672>]</span>
<span style=color:#66d9ef>case</span> <span style=color:#66d9ef>object</span> <span style=color:#a6e22e>XYChart</span> <span style=color:#66d9ef>extends</span> <span style=color:#a6e22e>ChartType</span><span style=color:#f92672>[</span><span style=color:#66d9ef>XYData</span><span style=color:#f92672>]</span>

<span style=color:#66d9ef>def</span> draw<span style=color:#f92672>[</span><span style=color:#66d9ef>A</span><span style=color:#f92672>](</span>chartType<span style=color:#66d9ef>:</span> <span style=color:#66d9ef>ChartType</span><span style=color:#f92672>[</span><span style=color:#66d9ef>A</span><span style=color:#f92672>])(</span>data<span style=color:#66d9ef>:</span> <span style=color:#66d9ef>A</span><span style=color:#f92672>)</span><span style=color:#66d9ef>:</span> <span style=color:#66d9ef>Unit</span> <span style=color:#f92672>=</span>
 chartType <span style=color:#66d9ef>match</span> <span style=color:#f92672>{</span>
    <span style=color:#66d9ef>case</span> <span style=color:#a6e22e>PieChart</span> <span style=color:#66d9ef>=&gt;</span>
      <span style=color:#66d9ef>val</span> pieData <span style=color:#66d9ef>:</span> <span style=color:#66d9ef>PieData</span> <span style=color:#f92672>=</span> data
      <span style=color:#f92672>()</span>
    <span style=color:#66d9ef>case</span> <span style=color:#a6e22e>XYChart</span> <span style=color:#66d9ef>=&gt;</span>
      <span style=color:#66d9ef>val</span> xyData<span style=color:#66d9ef>:</span> <span style=color:#66d9ef>XYData</span> <span style=color:#f92672>=</span> data
      <span style=color:#f92672>()</span>
    <span style=color:#f92672>}</span>
</code></pre></div></li></ul><p>You can now sleep well knowing your production will not
crash because of some bad inputs here 😉</p><h2 id=more-advanced-use-cases>More Advanced Use Cases</h2><p>Now that you have seen what <em>GADTs</em> are about and how to use
them in real-life, you are ready for the big use cases below.
There are three of them. Each one illustrates one different way
to use the power of <em>GADTs</em>.
The <a href=#use-case-effects>first one</a> is about expressing effects,
which is widely used in every popular <em>IO</em> monads or algebraic effects.
Do not worry if you do not know what they are, the section will clarifies it.
The <a href=#use-case-ensuring-types-are-supported-by-the-database>second one</a>
is about enforcing properties. This point is illustrated
by the real-life use-case of enabling functional programming techniques
support constructions that only work for a limited set of types
(in the example, types supported by our fictional database).
The <a href=#use-case-simplifying-implicits>third one</a> is about simplifying
the creation of implicits.</p><h3 id=use-case-effects>Use Case: Effects!</h3><p>What we call an effect is sometimes just an interface declaring some functions with
no implementation. For example we can define the trait below. Note that <em>none</em> of its functions
has an implementation.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scala data-lang=scala><span style=color:#66d9ef>trait</span> <span style=color:#a6e22e>ExampleEffectSig</span> <span style=color:#f92672>{</span>
  <span style=color:#66d9ef>def</span> echo<span style=color:#f92672>[</span><span style=color:#66d9ef>A</span><span style=color:#f92672>](</span>value<span style=color:#66d9ef>:</span> <span style=color:#66d9ef>A</span><span style=color:#f92672>)</span><span style=color:#66d9ef>:</span> <span style=color:#66d9ef>A</span>
  <span style=color:#66d9ef>def</span> randomInt <span style=color:#66d9ef>:</span> <span style=color:#66d9ef>Int</span>
  <span style=color:#66d9ef>def</span> ignore<span style=color:#f92672>[</span><span style=color:#66d9ef>A</span><span style=color:#f92672>](</span>value<span style=color:#66d9ef>:</span> <span style=color:#66d9ef>A</span><span style=color:#f92672>)</span><span style=color:#66d9ef>:</span> <span style=color:#66d9ef>Unit</span>
<span style=color:#f92672>}</span>
</code></pre></div><p>Implementations of these interfaces are given elsewhere and there can be many of them! This
is useful to switch between implementations easily:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scala data-lang=scala><span style=color:#66d9ef>object</span> <span style=color:#a6e22e>ExampleEffectImpl</span> <span style=color:#66d9ef>extends</span> <span style=color:#a6e22e>ExampleEffectSig</span> <span style=color:#f92672>{</span>
  <span style=color:#66d9ef>def</span> echo<span style=color:#f92672>[</span><span style=color:#66d9ef>A</span><span style=color:#f92672>](</span>value<span style=color:#66d9ef>:</span> <span style=color:#66d9ef>A</span><span style=color:#f92672>)</span><span style=color:#66d9ef>:</span> <span style=color:#66d9ef>A</span> <span style=color:#f92672>=</span> value
  <span style=color:#66d9ef>def</span> randomInt <span style=color:#66d9ef>:</span> <span style=color:#66d9ef>Int</span> <span style=color:#f92672>=</span> scala<span style=color:#f92672>.</span>util<span style=color:#f92672>.</span><span style=color:#a6e22e>Random</span><span style=color:#f92672>.</span>nextInt<span style=color:#f92672>()</span>
  <span style=color:#66d9ef>def</span> ignore<span style=color:#f92672>[</span><span style=color:#66d9ef>A</span><span style=color:#f92672>](</span>value<span style=color:#66d9ef>:</span> <span style=color:#66d9ef>A</span><span style=color:#f92672>)</span><span style=color:#66d9ef>:</span> <span style=color:#66d9ef>Unit</span> <span style=color:#f92672>=</span> <span style=color:#f92672>()</span>
<span style=color:#f92672>}</span>
</code></pre></div><p>Another equivalent way to define <code>ExampleEffectSig</code> is via a <code>sealed trait</code>
with some <code>final case class</code> (possibly none!) and/or some<code>case object</code> (possibly none too!):</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scala data-lang=scala><span style=color:#66d9ef>sealed</span> <span style=color:#66d9ef>trait</span> <span style=color:#a6e22e>ExampleEffect</span><span style=color:#f92672>[</span><span style=color:#66d9ef>A</span><span style=color:#f92672>]</span>
<span style=color:#a6e22e>final</span> <span style=color:#66d9ef>case</span> <span style=color:#66d9ef>class</span>  <span style=color:#a6e22e>Echo</span><span style=color:#f92672>[</span><span style=color:#66d9ef>A</span><span style=color:#f92672>](</span>value<span style=color:#66d9ef>:</span> <span style=color:#66d9ef>A</span><span style=color:#f92672>)</span> <span style=color:#66d9ef>extends</span> <span style=color:#a6e22e>ExampleEffect</span><span style=color:#f92672>[</span><span style=color:#66d9ef>A</span><span style=color:#f92672>]</span>
<span style=color:#66d9ef>final</span> <span style=color:#66d9ef>case</span> <span style=color:#66d9ef>object</span> <span style=color:#a6e22e>RandomInt</span> <span style=color:#66d9ef>extends</span> <span style=color:#a6e22e>ExampleEffect</span><span style=color:#f92672>[</span><span style=color:#66d9ef>Int</span><span style=color:#f92672>]</span>
<span style=color:#66d9ef>final</span> <span style=color:#66d9ef>case</span> <span style=color:#66d9ef>class</span>  <span style=color:#a6e22e>Ignore</span><span style=color:#f92672>[</span><span style=color:#66d9ef>A</span><span style=color:#f92672>](</span>value<span style=color:#66d9ef>:</span> <span style=color:#66d9ef>A</span><span style=color:#f92672>)</span> <span style=color:#66d9ef>extends</span> <span style=color:#a6e22e>ExampleEffect</span><span style=color:#f92672>[</span><span style=color:#66d9ef>Unit</span><span style=color:#f92672>]</span>
</code></pre></div><p>Once again this is a declaration with no implementation! Once again implementations
can be written elsewhere and there can also be many of them:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scala data-lang=scala><span style=color:#66d9ef>def</span> runExampleEffect<span style=color:#f92672>[</span><span style=color:#66d9ef>A</span><span style=color:#f92672>](</span>effect<span style=color:#66d9ef>:</span> <span style=color:#66d9ef>ExampleEffect</span><span style=color:#f92672>[</span><span style=color:#66d9ef>A</span><span style=color:#f92672>])</span><span style=color:#66d9ef>:</span> <span style=color:#66d9ef>A</span> <span style=color:#f92672>=</span>
  effect <span style=color:#66d9ef>match</span> <span style=color:#f92672>{</span>
    <span style=color:#66d9ef>case</span> <span style=color:#a6e22e>Echo</span><span style=color:#f92672>(</span>value<span style=color:#f92672>)</span> <span style=color:#66d9ef>=&gt;</span> value
    <span style=color:#66d9ef>case</span> <span style=color:#a6e22e>RandomInt</span>   <span style=color:#66d9ef>=&gt;</span> scala<span style=color:#f92672>.</span>util<span style=color:#f92672>.</span><span style=color:#a6e22e>Random</span><span style=color:#f92672>.</span>nextInt<span style=color:#f92672>()</span>
    <span style=color:#66d9ef>case</span> <span style=color:#a6e22e>Ignore</span><span style=color:#f92672>(</span><span style=color:#66d9ef>_</span><span style=color:#f92672>)</span>   <span style=color:#66d9ef>=&gt;</span> <span style=color:#f92672>()</span>
  <span style=color:#f92672>}</span>
</code></pre></div><p>Let&rsquo;s consider a more realistic effect and one possible implementation:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scala data-lang=scala><span style=color:#66d9ef>trait</span> <span style=color:#a6e22e>EffectSig</span> <span style=color:#f92672>{</span>
  <span style=color:#66d9ef>def</span> currentTimeMillis<span style=color:#66d9ef>:</span> <span style=color:#66d9ef>Long</span>
  <span style=color:#66d9ef>def</span> printLn<span style=color:#f92672>(</span>msg<span style=color:#66d9ef>:</span> <span style=color:#66d9ef>String</span><span style=color:#f92672>)</span><span style=color:#66d9ef>:</span> <span style=color:#66d9ef>Unit</span>
  <span style=color:#66d9ef>def</span> mesure<span style=color:#f92672>[</span><span style=color:#66d9ef>X</span>,<span style=color:#66d9ef>A</span><span style=color:#f92672>](</span>fun<span style=color:#66d9ef>:</span> <span style=color:#66d9ef>X</span> <span style=color:#f92672>=&gt;</span> A<span style=color:#f92672>,</span> arg<span style=color:#66d9ef>:</span> <span style=color:#66d9ef>X</span><span style=color:#f92672>)</span><span style=color:#66d9ef>:</span> <span style=color:#66d9ef>A</span>
<span style=color:#f92672>}</span>

<span style=color:#66d9ef>object</span> <span style=color:#a6e22e>EffectImpl</span> <span style=color:#66d9ef>extends</span> <span style=color:#a6e22e>EffectSig</span> <span style=color:#f92672>{</span>
  <span style=color:#66d9ef>def</span> currentTimeMillis<span style=color:#66d9ef>:</span> <span style=color:#66d9ef>Long</span> <span style=color:#f92672>=</span>
    <span style=color:#a6e22e>System</span><span style=color:#f92672>.</span>currentTimeMillis<span style=color:#f92672>()</span>

  <span style=color:#66d9ef>def</span> printLn<span style=color:#f92672>(</span>msg<span style=color:#66d9ef>:</span> <span style=color:#66d9ef>String</span><span style=color:#f92672>)</span><span style=color:#66d9ef>:</span> <span style=color:#66d9ef>Unit</span> <span style=color:#f92672>=</span>
    println<span style=color:#f92672>(</span>msg<span style=color:#f92672>)</span>

  <span style=color:#66d9ef>def</span> mesure<span style=color:#f92672>[</span><span style=color:#66d9ef>X</span>,<span style=color:#66d9ef>A</span><span style=color:#f92672>](</span>fun<span style=color:#66d9ef>:</span> <span style=color:#66d9ef>X</span> <span style=color:#f92672>=&gt;</span> A<span style=color:#f92672>,</span> arg<span style=color:#66d9ef>:</span> <span style=color:#66d9ef>X</span><span style=color:#f92672>)</span><span style=color:#66d9ef>:</span> <span style=color:#66d9ef>A</span> <span style=color:#f92672>=</span> <span style=color:#f92672>{</span>
    <span style=color:#66d9ef>val</span> t0 <span style=color:#66d9ef>=</span> <span style=color:#a6e22e>System</span><span style=color:#f92672>.</span>currentTimeMillis<span style=color:#f92672>()</span>
    <span style=color:#66d9ef>val</span> r  <span style=color:#66d9ef>=</span> fun<span style=color:#f92672>(</span>arg<span style=color:#f92672>)</span>
    <span style=color:#66d9ef>val</span> t1 <span style=color:#66d9ef>=</span> <span style=color:#a6e22e>System</span><span style=color:#f92672>.</span>currentTimeMillis<span style=color:#f92672>()</span>
    println<span style=color:#f92672>(</span><span style=color:#e6db74>s&#34;Took </span><span style=color:#e6db74>${</span>t1 <span style=color:#f92672>-</span> t0<span style=color:#e6db74>}</span><span style=color:#e6db74> milli-seconds&#34;</span><span style=color:#f92672>)</span>
    r
  <span style=color:#f92672>}</span>
<span style=color:#f92672>}</span>
</code></pre></div><ul><li><p><strong>Question 1:</strong> <code>ExampleEffect</code> is the equivalent of <code>ExampleEffectSig</code>,
but using a <code>sealed trait</code> with some <code>final case class</code> and <code>case object</code>.
Write the equivalent of <code>EffectSig</code> in the same way. Call this trait <code>Effect</code>.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scala data-lang=scala><span style=color:#66d9ef>sealed</span> <span style=color:#66d9ef>trait</span> <span style=color:#a6e22e>Effect</span><span style=color:#f92672>[</span><span style=color:#66d9ef>A</span><span style=color:#f92672>]</span>
<span style=color:#a6e22e>final</span> <span style=color:#66d9ef>case</span> <span style=color:#66d9ef>object</span> <span style=color:#a6e22e>CurrentTimeMillis</span> <span style=color:#66d9ef>extends</span> <span style=color:#a6e22e>Effect</span><span style=color:#f92672>[</span><span style=color:#66d9ef>Long</span><span style=color:#f92672>]</span>
<span style=color:#66d9ef>final</span> <span style=color:#66d9ef>case</span> <span style=color:#66d9ef>class</span>  <span style=color:#a6e22e>PrintLn</span><span style=color:#f92672>(</span>msg<span style=color:#66d9ef>:</span> <span style=color:#66d9ef>String</span><span style=color:#f92672>)</span> <span style=color:#66d9ef>extends</span> <span style=color:#a6e22e>Effect</span><span style=color:#f92672>[</span><span style=color:#66d9ef>Unit</span><span style=color:#f92672>]</span>
<span style=color:#66d9ef>final</span> <span style=color:#66d9ef>case</span> <span style=color:#66d9ef>class</span>  <span style=color:#a6e22e>Mesure</span><span style=color:#f92672>[</span><span style=color:#66d9ef>X</span>,<span style=color:#66d9ef>A</span><span style=color:#f92672>](</span>fun<span style=color:#66d9ef>:</span> <span style=color:#66d9ef>X</span> <span style=color:#f92672>=&gt;</span> A<span style=color:#f92672>,</span> arg<span style=color:#66d9ef>:</span> <span style=color:#66d9ef>X</span><span style=color:#f92672>)</span> <span style=color:#66d9ef>extends</span> <span style=color:#a6e22e>Effect</span><span style=color:#f92672>[</span><span style=color:#66d9ef>A</span><span style=color:#f92672>]</span>
</code></pre></div></li><li><p><strong>Question 2:</strong> Write the function <code>def run[A](effect: Effect[A]): A</code>
that mimics the implementation of <code>EffectImpl</code>
just like <code>runExampleEffect</code> mimics <code>ExampleEffectImpl</code>.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scala data-lang=scala><span style=color:#66d9ef>def</span> run<span style=color:#f92672>[</span><span style=color:#66d9ef>A</span><span style=color:#f92672>](</span>effect<span style=color:#66d9ef>:</span> <span style=color:#66d9ef>Effect</span><span style=color:#f92672>[</span><span style=color:#66d9ef>A</span><span style=color:#f92672>])</span><span style=color:#66d9ef>:</span> <span style=color:#66d9ef>A</span> <span style=color:#f92672>=</span>
  effect <span style=color:#66d9ef>match</span> <span style=color:#f92672>{</span>
    <span style=color:#66d9ef>case</span> <span style=color:#a6e22e>CurrentTimeMillis</span> <span style=color:#66d9ef>=&gt;</span>
      <span style=color:#a6e22e>System</span><span style=color:#f92672>.</span>currentTimeMillis<span style=color:#f92672>()</span>

    <span style=color:#66d9ef>case</span> <span style=color:#a6e22e>PrintLn</span><span style=color:#f92672>(</span>msg<span style=color:#f92672>)</span> <span style=color:#66d9ef>=&gt;</span>
      println<span style=color:#f92672>(</span>msg<span style=color:#f92672>)</span>

    <span style=color:#66d9ef>case</span> <span style=color:#a6e22e>Mesure</span><span style=color:#f92672>(</span>fun<span style=color:#f92672>,</span> arg<span style=color:#f92672>)</span> <span style=color:#66d9ef>=&gt;</span>
      <span style=color:#66d9ef>val</span> t0 <span style=color:#66d9ef>=</span> <span style=color:#a6e22e>System</span><span style=color:#f92672>.</span>currentTimeMillis<span style=color:#f92672>()</span>
      <span style=color:#66d9ef>val</span> r  <span style=color:#66d9ef>=</span> fun<span style=color:#f92672>(</span>arg<span style=color:#f92672>)</span>
      <span style=color:#66d9ef>val</span> t1 <span style=color:#66d9ef>=</span> <span style=color:#a6e22e>System</span><span style=color:#f92672>.</span>currentTimeMillis<span style=color:#f92672>()</span>
      println<span style=color:#f92672>(</span><span style=color:#e6db74>s&#34;Took </span><span style=color:#e6db74>${</span>t1 <span style=color:#f92672>-</span> t0<span style=color:#e6db74>}</span><span style=color:#e6db74> milli-seconds&#34;</span><span style=color:#f92672>)</span>
      r
  <span style=color:#f92672>}</span>
</code></pre></div></li></ul><p>The type <code>Effect[A]</code> declares interesting effects (<code>CurrentTimeMillis</code>,
<code>PrintLn</code> and <code>Mesure</code>) but to be really useful, we need to be able
to chain effects! To do so, we want to have these two functions:</p><ul><li><code>def pure[A](value: A): Effect[A]</code></li><li><code>def flatMap[X,A](fx: Effect[X], f: X => Effect[A]): Effect[A]</code></li></ul><p>Once again we do not care yet about the implementation. Presently all
we want is declaring these two operations, just like we declared <code>CurrentTimeMillis</code>,
<code>PrintLn</code> and <code>Mesure</code>.</p><ul><li><p><strong>Question 3:</strong> Add two <em>final case classes</em>, <code>Pure</code> and <code>FlatMap</code>,
to <code>Effect[A]</code> declaring these operations.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scala data-lang=scala><span style=color:#66d9ef>sealed</span> <span style=color:#66d9ef>trait</span> <span style=color:#a6e22e>Effect</span><span style=color:#f92672>[</span><span style=color:#66d9ef>A</span><span style=color:#f92672>]</span>
<span style=color:#a6e22e>final</span> <span style=color:#66d9ef>case</span> <span style=color:#66d9ef>object</span> <span style=color:#a6e22e>CurrentTimeMillis</span> <span style=color:#66d9ef>extends</span> <span style=color:#a6e22e>Effect</span><span style=color:#f92672>[</span><span style=color:#66d9ef>Long</span><span style=color:#f92672>]</span>
<span style=color:#66d9ef>final</span> <span style=color:#66d9ef>case</span> <span style=color:#66d9ef>class</span>  <span style=color:#a6e22e>PrintLn</span><span style=color:#f92672>(</span>msg<span style=color:#66d9ef>:</span> <span style=color:#66d9ef>String</span><span style=color:#f92672>)</span> <span style=color:#66d9ef>extends</span> <span style=color:#a6e22e>Effect</span><span style=color:#f92672>[</span><span style=color:#66d9ef>Unit</span><span style=color:#f92672>]</span>
<span style=color:#66d9ef>final</span> <span style=color:#66d9ef>case</span> <span style=color:#66d9ef>class</span>  <span style=color:#a6e22e>Mesure</span><span style=color:#f92672>[</span><span style=color:#66d9ef>X</span>,<span style=color:#66d9ef>A</span><span style=color:#f92672>](</span>fun<span style=color:#66d9ef>:</span> <span style=color:#66d9ef>X</span> <span style=color:#f92672>=&gt;</span> A<span style=color:#f92672>,</span> arg<span style=color:#66d9ef>:</span> <span style=color:#66d9ef>X</span><span style=color:#f92672>)</span> <span style=color:#66d9ef>extends</span> <span style=color:#a6e22e>Effect</span><span style=color:#f92672>[</span><span style=color:#66d9ef>A</span><span style=color:#f92672>]</span>
<span style=color:#66d9ef>final</span> <span style=color:#66d9ef>case</span> <span style=color:#66d9ef>class</span>  <span style=color:#a6e22e>Pure</span><span style=color:#f92672>[</span><span style=color:#66d9ef>A</span><span style=color:#f92672>](</span>value<span style=color:#66d9ef>:</span> <span style=color:#66d9ef>A</span><span style=color:#f92672>)</span> <span style=color:#66d9ef>extends</span> <span style=color:#a6e22e>Effect</span><span style=color:#f92672>[</span><span style=color:#66d9ef>A</span><span style=color:#f92672>]</span>
<span style=color:#66d9ef>final</span> <span style=color:#66d9ef>case</span> <span style=color:#66d9ef>class</span>  <span style=color:#a6e22e>FlatMap</span><span style=color:#f92672>[</span><span style=color:#66d9ef>X</span>,<span style=color:#66d9ef>A</span><span style=color:#f92672>](</span>fx<span style=color:#66d9ef>:</span> <span style=color:#66d9ef>Effect</span><span style=color:#f92672>[</span><span style=color:#66d9ef>X</span><span style=color:#f92672>],</span> f<span style=color:#66d9ef>:</span> <span style=color:#66d9ef>X</span> <span style=color:#f92672>=&gt;</span> <span style=color:#a6e22e>Effect</span><span style=color:#f92672>[</span><span style=color:#66d9ef>A</span><span style=color:#f92672>])</span> <span style=color:#66d9ef>extends</span> <span style=color:#a6e22e>Effect</span><span style=color:#f92672>[</span><span style=color:#66d9ef>A</span><span style=color:#f92672>]</span>
</code></pre></div></li><li><p><strong>Question 4:</strong> Adapt the function <code>run</code> to handle these two new cases.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scala data-lang=scala><span style=color:#66d9ef>def</span> run<span style=color:#f92672>[</span><span style=color:#66d9ef>A</span><span style=color:#f92672>](</span>effect<span style=color:#66d9ef>:</span> <span style=color:#66d9ef>Effect</span><span style=color:#f92672>[</span><span style=color:#66d9ef>A</span><span style=color:#f92672>])</span><span style=color:#66d9ef>:</span> <span style=color:#66d9ef>A</span> <span style=color:#f92672>=</span>
  effect <span style=color:#66d9ef>match</span> <span style=color:#f92672>{</span>
    <span style=color:#66d9ef>case</span> <span style=color:#a6e22e>CurrentTimeMillis</span> <span style=color:#66d9ef>=&gt;</span>
      <span style=color:#a6e22e>System</span><span style=color:#f92672>.</span>currentTimeMillis<span style=color:#f92672>()</span>

    <span style=color:#66d9ef>case</span> <span style=color:#a6e22e>PrintLn</span><span style=color:#f92672>(</span>msg<span style=color:#f92672>)</span> <span style=color:#66d9ef>=&gt;</span>
      println<span style=color:#f92672>(</span>msg<span style=color:#f92672>)</span>

    <span style=color:#66d9ef>case</span> <span style=color:#a6e22e>Mesure</span><span style=color:#f92672>(</span>fun<span style=color:#f92672>,</span> arg<span style=color:#f92672>)</span> <span style=color:#66d9ef>=&gt;</span>
      <span style=color:#66d9ef>val</span> t0 <span style=color:#66d9ef>=</span> <span style=color:#a6e22e>System</span><span style=color:#f92672>.</span>currentTimeMillis<span style=color:#f92672>()</span>
      <span style=color:#66d9ef>val</span> r  <span style=color:#66d9ef>=</span> fun<span style=color:#f92672>(</span>arg<span style=color:#f92672>)</span>
      <span style=color:#66d9ef>val</span> t1 <span style=color:#66d9ef>=</span> <span style=color:#a6e22e>System</span><span style=color:#f92672>.</span>currentTimeMillis<span style=color:#f92672>()</span>
      println<span style=color:#f92672>(</span><span style=color:#e6db74>s&#34;Took </span><span style=color:#e6db74>${</span>t1 <span style=color:#f92672>-</span> t0<span style=color:#e6db74>}</span><span style=color:#e6db74> milli-seconds&#34;</span><span style=color:#f92672>)</span>
      r

    <span style=color:#66d9ef>case</span> <span style=color:#a6e22e>Pure</span><span style=color:#f92672>(</span>a<span style=color:#f92672>)</span> <span style=color:#66d9ef>=&gt;</span>
      a

    <span style=color:#66d9ef>case</span> <span style=color:#a6e22e>FlatMap</span><span style=color:#f92672>(</span>fx<span style=color:#f92672>,</span> f<span style=color:#f92672>)</span> <span style=color:#66d9ef>=&gt;</span>
      <span style=color:#66d9ef>val</span> x  <span style=color:#66d9ef>=</span> run<span style=color:#f92672>(</span>fx<span style=color:#f92672>)</span>
      <span style=color:#66d9ef>val</span> fa <span style=color:#66d9ef>:</span> <span style=color:#66d9ef>Effect</span><span style=color:#f92672>[</span><span style=color:#66d9ef>A</span><span style=color:#f92672>]</span> <span style=color:#66d9ef>=</span> f<span style=color:#f92672>(</span>x<span style=color:#f92672>)</span>
      run<span style=color:#f92672>(</span>fa<span style=color:#f92672>)</span>
  <span style=color:#f92672>}</span>
</code></pre></div></li><li><p><strong>Question 5:</strong> Add the two following methods to trait <code>Effect[A]</code> to get:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scala data-lang=scala><span style=color:#66d9ef>sealed</span> <span style=color:#66d9ef>trait</span> <span style=color:#a6e22e>Effect</span><span style=color:#f92672>[</span><span style=color:#66d9ef>A</span><span style=color:#f92672>]</span> <span style=color:#f92672>{</span>
  <span style=color:#66d9ef>final</span> <span style=color:#66d9ef>def</span> flatMap<span style=color:#f92672>[</span><span style=color:#66d9ef>B</span><span style=color:#f92672>](</span>f<span style=color:#66d9ef>:</span> <span style=color:#66d9ef>A</span> <span style=color:#f92672>=&gt;</span> <span style=color:#a6e22e>Effect</span><span style=color:#f92672>[</span><span style=color:#66d9ef>B</span><span style=color:#f92672>])</span><span style=color:#66d9ef>:</span> <span style=color:#66d9ef>Effect</span><span style=color:#f92672>[</span><span style=color:#66d9ef>B</span><span style=color:#f92672>]</span> <span style=color:#66d9ef>=</span> <span style=color:#a6e22e>FlatMap</span><span style=color:#f92672>(</span><span style=color:#66d9ef>this</span><span style=color:#f92672>,</span> f<span style=color:#f92672>)</span>
  <span style=color:#66d9ef>final</span> <span style=color:#66d9ef>def</span> map<span style=color:#f92672>[</span><span style=color:#66d9ef>B</span><span style=color:#f92672>](</span>f<span style=color:#66d9ef>:</span> <span style=color:#66d9ef>A</span> <span style=color:#f92672>=&gt;</span> B<span style=color:#f92672>)</span><span style=color:#66d9ef>:</span> <span style=color:#66d9ef>Effect</span><span style=color:#f92672>[</span><span style=color:#66d9ef>B</span><span style=color:#f92672>]</span> <span style=color:#66d9ef>=</span> flatMap<span style=color:#f92672>[</span><span style=color:#66d9ef>B</span><span style=color:#f92672>]((</span>a<span style=color:#66d9ef>:</span><span style=color:#66d9ef>A</span><span style=color:#f92672>)</span> <span style=color:#66d9ef>=&gt;</span> <span style=color:#a6e22e>Pure</span><span style=color:#f92672>(</span>f<span style=color:#f92672>(</span>a<span style=color:#f92672>)))</span>
<span style=color:#f92672>}</span>
</code></pre></div><p>And run the follwing code to see if it works:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scala data-lang=scala><span style=color:#66d9ef>val</span> effect1<span style=color:#66d9ef>:</span> <span style=color:#66d9ef>Effect</span><span style=color:#f92672>[</span><span style=color:#66d9ef>Unit</span><span style=color:#f92672>]</span> <span style=color:#66d9ef>=</span>
  <span style=color:#66d9ef>for</span> <span style=color:#f92672>{</span>
    t0 <span style=color:#66d9ef>&lt;-</span> <span style=color:#a6e22e>CurrentTimeMillis</span>
    <span style=color:#66d9ef>_</span>  <span style=color:#66d9ef>&lt;-</span> <span style=color:#a6e22e>PrintLn</span><span style=color:#f92672>(</span><span style=color:#e6db74>s&#34;The current time is </span><span style=color:#e6db74>$t0</span><span style=color:#e6db74>&#34;</span><span style=color:#f92672>)</span>
  <span style=color:#f92672>}</span> <span style=color:#66d9ef>yield</span> <span style=color:#f92672>()</span>

run<span style=color:#f92672>(</span>effect1<span style=color:#f92672>)</span>
</code></pre></div><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scala data-lang=scala><span style=color:#66d9ef>sealed</span> <span style=color:#66d9ef>trait</span> <span style=color:#a6e22e>Effect</span><span style=color:#f92672>[</span><span style=color:#66d9ef>A</span><span style=color:#f92672>]</span> <span style=color:#f92672>{</span>
  <span style=color:#66d9ef>final</span> <span style=color:#66d9ef>def</span> flatMap<span style=color:#f92672>[</span><span style=color:#66d9ef>B</span><span style=color:#f92672>](</span>f<span style=color:#66d9ef>:</span> <span style=color:#66d9ef>A</span> <span style=color:#f92672>=&gt;</span> <span style=color:#a6e22e>Effect</span><span style=color:#f92672>[</span><span style=color:#66d9ef>B</span><span style=color:#f92672>])</span><span style=color:#66d9ef>:</span> <span style=color:#66d9ef>Effect</span><span style=color:#f92672>[</span><span style=color:#66d9ef>B</span><span style=color:#f92672>]</span> <span style=color:#66d9ef>=</span> <span style=color:#a6e22e>FlatMap</span><span style=color:#f92672>(</span><span style=color:#66d9ef>this</span><span style=color:#f92672>,</span> f<span style=color:#f92672>)</span>
  <span style=color:#66d9ef>final</span> <span style=color:#66d9ef>def</span> map<span style=color:#f92672>[</span><span style=color:#66d9ef>B</span><span style=color:#f92672>](</span>f<span style=color:#66d9ef>:</span> <span style=color:#66d9ef>A</span> <span style=color:#f92672>=&gt;</span> B<span style=color:#f92672>)</span><span style=color:#66d9ef>:</span> <span style=color:#66d9ef>Effect</span><span style=color:#f92672>[</span><span style=color:#66d9ef>B</span><span style=color:#f92672>]</span> <span style=color:#66d9ef>=</span> flatMap<span style=color:#f92672>[</span><span style=color:#66d9ef>B</span><span style=color:#f92672>]((</span>a<span style=color:#66d9ef>:</span><span style=color:#66d9ef>A</span><span style=color:#f92672>)</span> <span style=color:#66d9ef>=&gt;</span> <span style=color:#a6e22e>Pure</span><span style=color:#f92672>(</span>f<span style=color:#f92672>(</span>a<span style=color:#f92672>)))</span>
<span style=color:#f92672>}</span>
<span style=color:#66d9ef>final</span> <span style=color:#66d9ef>case</span> <span style=color:#66d9ef>object</span> <span style=color:#a6e22e>CurrentTimeMillis</span> <span style=color:#66d9ef>extends</span> <span style=color:#a6e22e>Effect</span><span style=color:#f92672>[</span><span style=color:#66d9ef>Long</span><span style=color:#f92672>]</span>
<span style=color:#66d9ef>final</span> <span style=color:#66d9ef>case</span> <span style=color:#66d9ef>class</span>  <span style=color:#a6e22e>PrintLn</span><span style=color:#f92672>(</span>msg<span style=color:#66d9ef>:</span> <span style=color:#66d9ef>String</span><span style=color:#f92672>)</span> <span style=color:#66d9ef>extends</span> <span style=color:#a6e22e>Effect</span><span style=color:#f92672>[</span><span style=color:#66d9ef>Unit</span><span style=color:#f92672>]</span>
<span style=color:#66d9ef>final</span> <span style=color:#66d9ef>case</span> <span style=color:#66d9ef>class</span>  <span style=color:#a6e22e>Mesure</span><span style=color:#f92672>[</span><span style=color:#66d9ef>X</span>,<span style=color:#66d9ef>A</span><span style=color:#f92672>](</span>fun<span style=color:#66d9ef>:</span> <span style=color:#66d9ef>X</span> <span style=color:#f92672>=&gt;</span> A<span style=color:#f92672>,</span> arg<span style=color:#66d9ef>:</span> <span style=color:#66d9ef>X</span><span style=color:#f92672>)</span> <span style=color:#66d9ef>extends</span> <span style=color:#a6e22e>Effect</span><span style=color:#f92672>[</span><span style=color:#66d9ef>A</span><span style=color:#f92672>]</span>
<span style=color:#66d9ef>final</span> <span style=color:#66d9ef>case</span> <span style=color:#66d9ef>class</span>  <span style=color:#a6e22e>Pure</span><span style=color:#f92672>[</span><span style=color:#66d9ef>A</span><span style=color:#f92672>](</span>value<span style=color:#66d9ef>:</span> <span style=color:#66d9ef>A</span><span style=color:#f92672>)</span> <span style=color:#66d9ef>extends</span> <span style=color:#a6e22e>Effect</span><span style=color:#f92672>[</span><span style=color:#66d9ef>A</span><span style=color:#f92672>]</span>
<span style=color:#66d9ef>final</span> <span style=color:#66d9ef>case</span> <span style=color:#66d9ef>class</span>  <span style=color:#a6e22e>FlatMap</span><span style=color:#f92672>[</span><span style=color:#66d9ef>X</span>,<span style=color:#66d9ef>A</span><span style=color:#f92672>](</span>fx<span style=color:#66d9ef>:</span> <span style=color:#66d9ef>Effect</span><span style=color:#f92672>[</span><span style=color:#66d9ef>X</span><span style=color:#f92672>],</span> f<span style=color:#66d9ef>:</span> <span style=color:#66d9ef>X</span> <span style=color:#f92672>=&gt;</span> <span style=color:#a6e22e>Effect</span><span style=color:#f92672>[</span><span style=color:#66d9ef>A</span><span style=color:#f92672>])</span> <span style=color:#66d9ef>extends</span> <span style=color:#a6e22e>Effect</span><span style=color:#f92672>[</span><span style=color:#66d9ef>A</span><span style=color:#f92672>]</span>

<span style=color:#66d9ef>def</span> run<span style=color:#f92672>[</span><span style=color:#66d9ef>A</span><span style=color:#f92672>](</span>effect<span style=color:#66d9ef>:</span> <span style=color:#66d9ef>Effect</span><span style=color:#f92672>[</span><span style=color:#66d9ef>A</span><span style=color:#f92672>])</span><span style=color:#66d9ef>:</span> <span style=color:#66d9ef>A</span> <span style=color:#f92672>=</span>
  effect <span style=color:#66d9ef>match</span> <span style=color:#f92672>{</span>
    <span style=color:#66d9ef>case</span> <span style=color:#a6e22e>CurrentTimeMillis</span> <span style=color:#66d9ef>=&gt;</span>
      <span style=color:#a6e22e>System</span><span style=color:#f92672>.</span>currentTimeMillis<span style=color:#f92672>()</span>

    <span style=color:#66d9ef>case</span> <span style=color:#a6e22e>PrintLn</span><span style=color:#f92672>(</span>msg<span style=color:#f92672>)</span> <span style=color:#66d9ef>=&gt;</span>
      println<span style=color:#f92672>(</span>msg<span style=color:#f92672>)</span>

    <span style=color:#66d9ef>case</span> <span style=color:#a6e22e>Mesure</span><span style=color:#f92672>(</span>fun<span style=color:#f92672>,</span> arg<span style=color:#f92672>)</span> <span style=color:#66d9ef>=&gt;</span>
      <span style=color:#66d9ef>val</span> t0 <span style=color:#66d9ef>=</span> <span style=color:#a6e22e>System</span><span style=color:#f92672>.</span>currentTimeMillis<span style=color:#f92672>()</span>
      <span style=color:#66d9ef>val</span> r  <span style=color:#66d9ef>=</span> fun<span style=color:#f92672>(</span>arg<span style=color:#f92672>)</span>
      <span style=color:#66d9ef>val</span> t1 <span style=color:#66d9ef>=</span> <span style=color:#a6e22e>System</span><span style=color:#f92672>.</span>currentTimeMillis<span style=color:#f92672>()</span>
      println<span style=color:#f92672>(</span><span style=color:#e6db74>s&#34;Took </span><span style=color:#e6db74>${</span>t1 <span style=color:#f92672>-</span> t0<span style=color:#e6db74>}</span><span style=color:#e6db74> milli-seconds&#34;</span><span style=color:#f92672>)</span>
      r

    <span style=color:#66d9ef>case</span> <span style=color:#a6e22e>Pure</span><span style=color:#f92672>(</span>a<span style=color:#f92672>)</span> <span style=color:#66d9ef>=&gt;</span>
      a

    <span style=color:#66d9ef>case</span> <span style=color:#a6e22e>FlatMap</span><span style=color:#f92672>(</span>fx<span style=color:#f92672>,</span> f<span style=color:#f92672>)</span> <span style=color:#66d9ef>=&gt;</span>
      <span style=color:#66d9ef>val</span> x  <span style=color:#66d9ef>=</span> run<span style=color:#f92672>(</span>fx<span style=color:#f92672>)</span>
      <span style=color:#66d9ef>val</span> fa <span style=color:#66d9ef>:</span> <span style=color:#66d9ef>Effect</span><span style=color:#f92672>[</span><span style=color:#66d9ef>A</span><span style=color:#f92672>]</span> <span style=color:#66d9ef>=</span> f<span style=color:#f92672>(</span>x<span style=color:#f92672>)</span>
      run<span style=color:#f92672>(</span>fa<span style=color:#f92672>)</span>
  <span style=color:#f92672>}</span>

<span style=color:#66d9ef>val</span> effect1<span style=color:#66d9ef>:</span> <span style=color:#66d9ef>Effect</span><span style=color:#f92672>[</span><span style=color:#66d9ef>Unit</span><span style=color:#f92672>]</span> <span style=color:#66d9ef>=</span>
  <span style=color:#66d9ef>for</span> <span style=color:#f92672>{</span>
    t0 <span style=color:#66d9ef>&lt;-</span> <span style=color:#a6e22e>CurrentTimeMillis</span>
    <span style=color:#66d9ef>_</span>  <span style=color:#66d9ef>&lt;-</span> <span style=color:#a6e22e>PrintLn</span><span style=color:#f92672>(</span><span style=color:#e6db74>s&#34;The current time is </span><span style=color:#e6db74>$t0</span><span style=color:#e6db74>&#34;</span><span style=color:#f92672>)</span>
  <span style=color:#f92672>}</span> <span style=color:#66d9ef>yield</span> <span style=color:#f92672>()</span>
</code></pre></div><p>When we run <code>run(effect1)</code>:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scala data-lang=scala>scala<span style=color:#f92672>&gt;</span> run<span style=color:#f92672>(</span>effect1<span style=color:#f92672>)</span>
<span style=color:#a6e22e>The</span> current time is <span style=color:#ae81ff>1569773175010</span>
</code></pre></div></li></ul><p>Congratulations! You just wrote your first <em>IO</em> monad! There
is a lot of scientific words to name the <code>sealed trait Effect[A]</code>:
you can call it an <em>algebraic effect</em>, a <em>free monad</em>, an <em>IO</em>, etc.
But in the end, it is just a plain simple <code>sealed trait</code> with
some <code>final case class</code> and <code>case object</code> that
represent the functions we wanted to have, without providing
their implementation (<code>CurrentTimeMillis</code>, <code>PrintLn</code>, <code>Mesure</code>,
<code>Pure</code> and <code>FlatMap</code>). You can call them <em>virtual methods</em> if you
like. <strong>What really matters is that we isolated the declaration of
the functions from their implementation.</strong> Remember that a <code>trait</code>
is just a interface after all.</p><h3 id=use-case-ensuring-types-are-supported-by-the-database>Use Case: Ensuring types are supported by the Database</h3><p>Databases are great. We can store tables, documents, key/values pairs, graphs, etc.
But for any database, there is unfortunately only a limited set of supported types.
Take a database you like, I am sure I can find some types it does not support.</p><p>In this section we consider the use case of data structures and code that do not work
for (values of) any type but only for some! This problem is not limited to databases but
concerns any <em>API</em> that only supports a limited set of types (the vast majority of <em>APIs</em>).
How to enforce this constraint? How to adapt the patterns we like to work under this constraint?
This is all this section is about.</p><p>We consider a fictional database that <strong>only</strong> supports the following types:</p><ol><li><code>String</code></li><li><code>Double</code></li><li><code>(A,B)</code> where <code>A</code> and <code>B</code> are also types supported by the database.</li></ol><p>It means that the values stored by the database (in tables, key/value pairs, etc) <strong>must</strong>
follow the rules above. It can store <code>"Hello World"</code> because it is a <code>String</code> which is
a supported type by rule <em>1</em>. Likewise, it can store <code>5.2</code> because it is a <code>Double</code>,
but it can <em>not</em> store <code>5 : Int</code> because it is an <code>Int</code>. It can store <code>("Hello World", 5.2)</code>
thanks to rule <em>3</em> and also <code>(("Hello World", 5.2) , 8.9)</code> once again by rule <em>3</em>.</p><ul><li><p><strong>Question 1:</strong> Define the type <code>DBType[A]</code> such that:</p><blockquote><p>There exists a value of type <code>DBType[A]</code> <strong>if and only if</strong> <code>A</code>
is a type supported by the database.</p></blockquote><p>Transposing the rules above in code, we get:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scala data-lang=scala><span style=color:#66d9ef>sealed</span> <span style=color:#66d9ef>trait</span> <span style=color:#a6e22e>DBType</span><span style=color:#f92672>[</span><span style=color:#66d9ef>A</span><span style=color:#f92672>]</span>
<span style=color:#a6e22e>final</span> <span style=color:#66d9ef>case</span> <span style=color:#66d9ef>object</span> <span style=color:#a6e22e>DBString</span> <span style=color:#66d9ef>extends</span> <span style=color:#a6e22e>DBType</span><span style=color:#f92672>[</span><span style=color:#66d9ef>String</span><span style=color:#f92672>]</span>
<span style=color:#66d9ef>final</span> <span style=color:#66d9ef>case</span> <span style=color:#66d9ef>object</span> <span style=color:#a6e22e>DBDouble</span> <span style=color:#66d9ef>extends</span> <span style=color:#a6e22e>DBType</span><span style=color:#f92672>[</span><span style=color:#66d9ef>Double</span><span style=color:#f92672>]</span>
<span style=color:#66d9ef>final</span> <span style=color:#66d9ef>case</span> <span style=color:#66d9ef>class</span>  <span style=color:#a6e22e>DBPair</span><span style=color:#f92672>[</span><span style=color:#66d9ef>A</span>,<span style=color:#66d9ef>B</span><span style=color:#f92672>](</span>first<span style=color:#66d9ef>:</span> <span style=color:#66d9ef>DBType</span><span style=color:#f92672>[</span><span style=color:#66d9ef>A</span><span style=color:#f92672>],</span> second<span style=color:#66d9ef>:</span> <span style=color:#66d9ef>DBType</span><span style=color:#f92672>[</span><span style=color:#66d9ef>B</span><span style=color:#f92672>])</span> <span style=color:#66d9ef>extends</span> <span style=color:#a6e22e>DBType</span><span style=color:#f92672>[(</span><span style=color:#66d9ef>A</span>,<span style=color:#66d9ef>B</span><span style=color:#f92672>)]</span>
</code></pre></div><p>Using all the nice features of <em>Scala</em>, the production-ready version of the code above is:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scala data-lang=scala><span style=color:#66d9ef>sealed</span> <span style=color:#66d9ef>trait</span> <span style=color:#a6e22e>DBType</span><span style=color:#f92672>[</span><span style=color:#66d9ef>A</span><span style=color:#f92672>]</span>
<span style=color:#a6e22e>object</span> <span style=color:#a6e22e>DBType</span> <span style=color:#f92672>{</span>
  <span style=color:#66d9ef>final</span> <span style=color:#66d9ef>case</span> <span style=color:#66d9ef>object</span> <span style=color:#a6e22e>DBString</span> <span style=color:#66d9ef>extends</span> <span style=color:#a6e22e>DBType</span><span style=color:#f92672>[</span><span style=color:#66d9ef>String</span><span style=color:#f92672>]</span>
  <span style=color:#66d9ef>final</span> <span style=color:#66d9ef>case</span> <span style=color:#66d9ef>object</span> <span style=color:#a6e22e>DBDouble</span> <span style=color:#66d9ef>extends</span> <span style=color:#a6e22e>DBType</span><span style=color:#f92672>[</span><span style=color:#66d9ef>Double</span><span style=color:#f92672>]</span>
  <span style=color:#66d9ef>final</span> <span style=color:#66d9ef>case</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>DBPair</span><span style=color:#f92672>[</span><span style=color:#66d9ef>A</span>,<span style=color:#66d9ef>B</span><span style=color:#f92672>](</span>first<span style=color:#66d9ef>:</span> <span style=color:#66d9ef>DBType</span><span style=color:#f92672>[</span><span style=color:#66d9ef>A</span><span style=color:#f92672>],</span> second<span style=color:#66d9ef>:</span> <span style=color:#66d9ef>DBType</span><span style=color:#f92672>[</span><span style=color:#66d9ef>B</span><span style=color:#f92672>])</span> <span style=color:#66d9ef>extends</span> <span style=color:#a6e22e>DBType</span><span style=color:#f92672>[(</span><span style=color:#66d9ef>A</span>,<span style=color:#66d9ef>B</span><span style=color:#f92672>)]</span>

  <span style=color:#66d9ef>implicit</span> <span style=color:#66d9ef>val</span> dbString <span style=color:#66d9ef>:</span> <span style=color:#66d9ef>DBType</span><span style=color:#f92672>[</span><span style=color:#66d9ef>String</span><span style=color:#f92672>]</span> <span style=color:#66d9ef>=</span>
    <span style=color:#a6e22e>DBString</span>

  <span style=color:#66d9ef>implicit</span> <span style=color:#66d9ef>val</span> dbDouble <span style=color:#66d9ef>:</span> <span style=color:#66d9ef>DBType</span><span style=color:#f92672>[</span><span style=color:#66d9ef>Double</span><span style=color:#f92672>]</span> <span style=color:#66d9ef>=</span>
    <span style=color:#a6e22e>DBDouble</span>

  <span style=color:#66d9ef>implicit</span> <span style=color:#66d9ef>def</span> dbPair<span style=color:#f92672>[</span><span style=color:#66d9ef>A</span>,<span style=color:#66d9ef>B</span><span style=color:#f92672>](</span><span style=color:#66d9ef>implicit</span> first<span style=color:#66d9ef>:</span> <span style=color:#66d9ef>DBType</span><span style=color:#f92672>[</span><span style=color:#66d9ef>A</span><span style=color:#f92672>],</span> second<span style=color:#66d9ef>:</span> <span style=color:#66d9ef>DBType</span><span style=color:#f92672>[</span><span style=color:#66d9ef>B</span><span style=color:#f92672>])</span><span style=color:#66d9ef>:</span> <span style=color:#66d9ef>DBType</span><span style=color:#f92672>[(</span><span style=color:#66d9ef>A</span>,<span style=color:#66d9ef>B</span><span style=color:#f92672>)]</span> <span style=color:#66d9ef>=</span>
    <span style=color:#a6e22e>DBPair</span><span style=color:#f92672>(</span>first<span style=color:#f92672>,</span> second<span style=color:#f92672>)</span>

  <span style=color:#66d9ef>def</span> apply<span style=color:#f92672>[</span><span style=color:#66d9ef>A</span><span style=color:#f92672>](</span><span style=color:#66d9ef>implicit</span> ev<span style=color:#66d9ef>:</span> <span style=color:#66d9ef>DBType</span><span style=color:#f92672>[</span><span style=color:#66d9ef>A</span><span style=color:#f92672>])</span><span style=color:#66d9ef>:</span> <span style=color:#66d9ef>ev.</span><span style=color:#66d9ef>type</span> <span style=color:#f92672>=</span> ev
<span style=color:#f92672>}</span>
</code></pre></div></li></ul><p>Using <code>DBType</code>, we can pair a value of type <code>A</code> with a value of type <code>DBType[A]</code>,
which provides an evidence that the type <code>A</code> is supported by the database:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scala data-lang=scala><span style=color:#66d9ef>final</span> <span style=color:#66d9ef>case</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>DBValue</span><span style=color:#f92672>[</span><span style=color:#66d9ef>A</span><span style=color:#f92672>](</span>value<span style=color:#66d9ef>:</span> <span style=color:#66d9ef>A</span><span style=color:#f92672>)(</span><span style=color:#66d9ef>implicit</span> <span style=color:#66d9ef>val</span> dbType<span style=color:#66d9ef>:</span> <span style=color:#66d9ef>DBType</span><span style=color:#f92672>[</span><span style=color:#66d9ef>A</span><span style=color:#f92672>])</span>
</code></pre></div><p>Note that the parameter <code>dbType</code> does not need to be implicit! All that matters is that
to create a value of type <code>DBValue[A]</code>, we need to provide a value of type <code>DBType[A]</code>
which forces <code>A</code> to be a supported type.</p><p>A functor is, approximately, a type constructor <code>F</code> like <code>List</code>, <code>Option</code>, <code>DBValue</code>, &mldr;
for which you can write an instance of the trait</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scala data-lang=scala><span style=color:#66d9ef>trait</span> <span style=color:#a6e22e>Functor</span><span style=color:#f92672>[</span><span style=color:#66d9ef>F</span><span style=color:#f92672>[</span><span style=color:#66d9ef>_</span><span style=color:#f92672>]]</span> <span style=color:#f92672>{</span>
  <span style=color:#66d9ef>def</span> map<span style=color:#f92672>[</span><span style=color:#66d9ef>A</span>,<span style=color:#66d9ef>B</span><span style=color:#f92672>](</span>fa<span style=color:#66d9ef>:</span> <span style=color:#66d9ef>F</span><span style=color:#f92672>[</span><span style=color:#66d9ef>A</span><span style=color:#f92672>])(</span>f<span style=color:#66d9ef>:</span> <span style=color:#66d9ef>A</span> <span style=color:#f92672>=&gt;</span> B<span style=color:#f92672>)</span><span style=color:#66d9ef>:</span> <span style=color:#66d9ef>F</span><span style=color:#f92672>[</span><span style=color:#66d9ef>B</span><span style=color:#f92672>]</span>
<span style=color:#f92672>}</span>
</code></pre></div><p>where <code>map(fa)(f)</code> applies the function <code>f</code> to any value of type <code>A</code> contained in <code>fa</code>.
For example:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scala data-lang=scala><span style=color:#66d9ef>implicit</span> <span style=color:#66d9ef>object</span> <span style=color:#a6e22e>OptionFunctor</span> <span style=color:#66d9ef>extends</span> <span style=color:#a6e22e>Functor</span><span style=color:#f92672>[</span><span style=color:#66d9ef>Option</span><span style=color:#f92672>]</span> <span style=color:#f92672>{</span>
  <span style=color:#66d9ef>def</span> map<span style=color:#f92672>[</span><span style=color:#66d9ef>A</span>,<span style=color:#66d9ef>B</span><span style=color:#f92672>](</span>fa<span style=color:#66d9ef>:</span> <span style=color:#66d9ef>Option</span><span style=color:#f92672>[</span><span style=color:#66d9ef>A</span><span style=color:#f92672>])(</span>f<span style=color:#66d9ef>:</span> <span style=color:#66d9ef>A</span> <span style=color:#f92672>=&gt;</span> B<span style=color:#f92672>)</span><span style=color:#66d9ef>:</span> <span style=color:#66d9ef>Option</span><span style=color:#f92672>[</span><span style=color:#66d9ef>B</span><span style=color:#f92672>]</span> <span style=color:#66d9ef>=</span>
    fa <span style=color:#66d9ef>match</span> <span style=color:#f92672>{</span>
      <span style=color:#66d9ef>case</span> <span style=color:#a6e22e>Some</span><span style=color:#f92672>(</span>a<span style=color:#f92672>)</span> <span style=color:#66d9ef>=&gt;</span> <span style=color:#a6e22e>Some</span><span style=color:#f92672>(</span>f<span style=color:#f92672>(</span>a<span style=color:#f92672>))</span>
      <span style=color:#66d9ef>case</span> <span style=color:#a6e22e>None</span> <span style=color:#66d9ef>=&gt;</span> <span style=color:#a6e22e>None</span>
    <span style=color:#f92672>}</span>
<span style=color:#f92672>}</span>
</code></pre></div><ul><li><p><strong>Question 2:</strong> Write an instance of <code>Functor[DBValue]</code>.</p><p>We actually can not! If we try to compile the following code:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scala data-lang=scala><span style=color:#66d9ef>object</span> <span style=color:#a6e22e>DBValueFunctor</span> <span style=color:#66d9ef>extends</span> <span style=color:#a6e22e>Functor</span><span style=color:#f92672>[</span><span style=color:#66d9ef>DBValue</span><span style=color:#f92672>]</span> <span style=color:#f92672>{</span>
  <span style=color:#66d9ef>def</span> map<span style=color:#f92672>[</span><span style=color:#66d9ef>A</span>,<span style=color:#66d9ef>B</span><span style=color:#f92672>](</span>fa<span style=color:#66d9ef>:</span> <span style=color:#66d9ef>DBValue</span><span style=color:#f92672>[</span><span style=color:#66d9ef>A</span><span style=color:#f92672>])(</span>f<span style=color:#66d9ef>:</span> <span style=color:#66d9ef>A</span> <span style=color:#f92672>=&gt;</span> B<span style=color:#f92672>)</span><span style=color:#66d9ef>:</span> <span style=color:#66d9ef>DBValue</span><span style=color:#f92672>[</span><span style=color:#66d9ef>B</span><span style=color:#f92672>]</span> <span style=color:#66d9ef>=</span>
    <span style=color:#a6e22e>DBValue</span><span style=color:#f92672>[</span><span style=color:#66d9ef>B</span><span style=color:#f92672>](</span>f<span style=color:#f92672>(</span>fa<span style=color:#f92672>.</span>value<span style=color:#f92672>))</span>
<span style=color:#f92672>}</span>
</code></pre></div><p><em>Scala</em> complains: <code>could not find implicit value for parameter dbType: DBType[B]</code>.
Indeed, booleans are not a supported type by the database: they are neither strings,
nor doubles, not pairs.
But if we could write a <code>Functor</code> instance for <code>DBValue</code>
(i.e. if we could write a <code>map</code> function for <code>DBValue</code>),
then we could write:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scala data-lang=scala><span style=color:#66d9ef>val</span> dbValueString  <span style=color:#66d9ef>:</span> <span style=color:#66d9ef>DBValue</span><span style=color:#f92672>[</span><span style=color:#66d9ef>String</span><span style=color:#f92672>]</span>  <span style=color:#66d9ef>=</span> <span style=color:#a6e22e>DBValue</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;A&#34;</span><span style=color:#f92672>)(</span><span style=color:#a6e22e>DBString</span><span style=color:#f92672>)</span>
<span style=color:#66d9ef>val</span> dbValueBoolean <span style=color:#66d9ef>:</span> <span style=color:#66d9ef>DBValue</span><span style=color:#f92672>[</span><span style=color:#66d9ef>Boolean</span><span style=color:#f92672>]</span> <span style=color:#66d9ef>=</span> dbValueString<span style=color:#f92672>.</span>map<span style=color:#f92672>(</span><span style=color:#66d9ef>_</span> <span style=color:#66d9ef>=&gt;</span> <span style=color:#66d9ef>true</span><span style=color:#f92672>)</span>
<span style=color:#66d9ef>val</span> dbTypeBoolean  <span style=color:#66d9ef>:</span> <span style=color:#66d9ef>DBType</span><span style=color:#f92672>[</span><span style=color:#66d9ef>Boolean</span><span style=color:#f92672>]</span>  <span style=color:#66d9ef>=</span> dbValueBoolean<span style=color:#f92672>.</span>dbType
</code></pre></div><p>We would get a value (<code>dbTypeBoolean</code>) of type <code>DBType[Boolean]</code>,
which would mean that the type <code>Boolean</code> is supported by the database.
But it is not! Furthermore, by definition:</p><blockquote><p>There exists a value of type <code>DBType[A]</code> <strong>if and only if</strong>
<code>A</code> is a type supported by the database.</p></blockquote><p>So it is impossible to have a value of type <code>DBType[Boolean]</code>
and thus it is impossible to write a function <code>map</code> for <code>DBValue</code>.
So there is no way to write a <code>Functor</code> instance for <code>DBValue</code>.</p></li></ul><p>A <em>Generalized Functor</em> is very much like a regular <code>Functor</code>.
But whereas the <code>map</code> function of functors have to work for <strong>every</strong>
types <code>A</code> and <code>B</code>, the <code>map</code> function of <em>generalized functor</em>
can be narrowed to only operate on a limited set of types <code>A</code> and <code>B</code>:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scala data-lang=scala><span style=color:#66d9ef>trait</span> <span style=color:#a6e22e>GenFunctor</span><span style=color:#f92672>[</span><span style=color:#66d9ef>P</span><span style=color:#f92672>[</span><span style=color:#66d9ef>_</span><span style=color:#f92672>]</span>,<span style=color:#66d9ef>F</span><span style=color:#f92672>[</span><span style=color:#66d9ef>_</span><span style=color:#f92672>]]</span> <span style=color:#f92672>{</span>
  <span style=color:#66d9ef>def</span> map<span style=color:#f92672>[</span><span style=color:#66d9ef>A</span>,<span style=color:#66d9ef>B</span><span style=color:#f92672>](</span>fa<span style=color:#66d9ef>:</span> <span style=color:#66d9ef>F</span><span style=color:#f92672>[</span><span style=color:#66d9ef>A</span><span style=color:#f92672>])(</span>f<span style=color:#66d9ef>:</span> <span style=color:#66d9ef>A</span> <span style=color:#f92672>=&gt;</span> B<span style=color:#f92672>)(</span><span style=color:#66d9ef>implicit</span> evA<span style=color:#66d9ef>:</span> <span style=color:#66d9ef>P</span><span style=color:#f92672>[</span><span style=color:#66d9ef>A</span><span style=color:#f92672>],</span> evB<span style=color:#66d9ef>:</span> <span style=color:#66d9ef>P</span><span style=color:#f92672>[</span><span style=color:#66d9ef>B</span><span style=color:#f92672>])</span><span style=color:#66d9ef>:</span> <span style=color:#66d9ef>F</span><span style=color:#f92672>[</span><span style=color:#66d9ef>B</span><span style=color:#f92672>]</span>
<span style=color:#f92672>}</span>
</code></pre></div><p>For example <code>Set</code> (more precisely <code>TreeSet</code>) is not a functor!
Indeed there is no way to write a function <code>map</code> that works for
any type <code>B</code> (because <code>B</code> need to have an ordering). But if we narrow
<code>map</code> to the only types <code>B</code> having an ordering, we can write it.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scala data-lang=scala><span style=color:#66d9ef>import</span> scala.collection.immutable._
<span style=color:#66d9ef>object</span> <span style=color:#a6e22e>TreeSetFunctor</span> <span style=color:#66d9ef>extends</span> <span style=color:#a6e22e>GenFunctor</span><span style=color:#f92672>[</span><span style=color:#66d9ef>Ordering</span>, <span style=color:#66d9ef>TreeSet</span><span style=color:#f92672>]</span> <span style=color:#f92672>{</span>
  <span style=color:#66d9ef>def</span> map<span style=color:#f92672>[</span><span style=color:#66d9ef>A</span>,<span style=color:#66d9ef>B</span><span style=color:#f92672>](</span>fa<span style=color:#66d9ef>:</span> <span style=color:#66d9ef>TreeSet</span><span style=color:#f92672>[</span><span style=color:#66d9ef>A</span><span style=color:#f92672>])(</span>f<span style=color:#66d9ef>:</span> <span style=color:#66d9ef>A</span> <span style=color:#f92672>=&gt;</span> B<span style=color:#f92672>)(</span><span style=color:#66d9ef>implicit</span> evA<span style=color:#66d9ef>:</span> <span style=color:#66d9ef>Ordering</span><span style=color:#f92672>[</span><span style=color:#66d9ef>A</span><span style=color:#f92672>],</span> evB<span style=color:#66d9ef>:</span> <span style=color:#66d9ef>Ordering</span><span style=color:#f92672>[</span><span style=color:#66d9ef>B</span><span style=color:#f92672>])</span><span style=color:#66d9ef>:</span> <span style=color:#66d9ef>TreeSet</span><span style=color:#f92672>[</span><span style=color:#66d9ef>B</span><span style=color:#f92672>]</span> <span style=color:#66d9ef>=</span>
    <span style=color:#a6e22e>TreeSet</span><span style=color:#f92672>.</span>empty<span style=color:#f92672>[</span><span style=color:#66d9ef>B</span><span style=color:#f92672>](</span>evB<span style=color:#f92672>)</span> <span style=color:#f92672>++</span> fa<span style=color:#f92672>.</span>toSeq<span style=color:#f92672>.</span>map<span style=color:#f92672>(</span>f<span style=color:#f92672>)</span>
<span style=color:#f92672>}</span>
</code></pre></div><ul><li><p><strong>Question 3:</strong> Write an instance of <code>GenFunctor[DBType, DBValue]</code>.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scala data-lang=scala><span style=color:#66d9ef>object</span> <span style=color:#a6e22e>DBValueGenFunctor</span> <span style=color:#66d9ef>extends</span> <span style=color:#a6e22e>GenFunctor</span><span style=color:#f92672>[</span><span style=color:#66d9ef>DBType</span>, <span style=color:#66d9ef>DBValue</span><span style=color:#f92672>]</span> <span style=color:#f92672>{</span>
  <span style=color:#66d9ef>def</span> map<span style=color:#f92672>[</span><span style=color:#66d9ef>A</span>,<span style=color:#66d9ef>B</span><span style=color:#f92672>](</span>fa<span style=color:#66d9ef>:</span> <span style=color:#66d9ef>DBValue</span><span style=color:#f92672>[</span><span style=color:#66d9ef>A</span><span style=color:#f92672>])(</span>f<span style=color:#66d9ef>:</span> <span style=color:#66d9ef>A</span> <span style=color:#f92672>=&gt;</span> B<span style=color:#f92672>)(</span><span style=color:#66d9ef>implicit</span> evA<span style=color:#66d9ef>:</span> <span style=color:#66d9ef>DBType</span><span style=color:#f92672>[</span><span style=color:#66d9ef>A</span><span style=color:#f92672>],</span> evB<span style=color:#66d9ef>:</span> <span style=color:#66d9ef>DBType</span><span style=color:#f92672>[</span><span style=color:#66d9ef>B</span><span style=color:#f92672>])</span><span style=color:#66d9ef>:</span> <span style=color:#66d9ef>DBValue</span><span style=color:#f92672>[</span><span style=color:#66d9ef>B</span><span style=color:#f92672>]</span> <span style=color:#66d9ef>=</span>
    <span style=color:#a6e22e>DBValue</span><span style=color:#f92672>[</span><span style=color:#66d9ef>B</span><span style=color:#f92672>](</span>f<span style=color:#f92672>(</span>fa<span style=color:#f92672>.</span>value<span style=color:#f92672>))(</span>evB<span style=color:#f92672>)</span>
<span style=color:#f92672>}</span>
</code></pre></div></li></ul><p>What we have done to <code>Functor</code> can be done for many data-structures and patterns.
We can often limit the types on which a data-structure or a type-class can operate
by adding an extra parameter like <code>ev : DBType[A]</code> to constructors and methods.</p><h3 id=use-case-simplifying-implicits>Use Case: Simplifying Implicits</h3><p>This use case is one the most interesting but unfortunately, not one of the easiest. It
illustrates how it is possible to use <em>GADTs</em> to simplify the creation of implicit values.
In this example we consider lists of values whose items can be of different types. Theses
lists are called <em>heterogeneous lists</em>. They are usually defined in <em>Scala</em> almost like
normal lists:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scala data-lang=scala><span style=color:#66d9ef>final</span> <span style=color:#66d9ef>case</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>HNil</span><span style=color:#f92672>()</span> <span style=color:#75715e>// The empty list
</span><span style=color:#75715e></span><span style=color:#66d9ef>final</span> <span style=color:#66d9ef>case</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>HCons</span><span style=color:#f92672>[</span><span style=color:#66d9ef>Head</span>,<span style=color:#66d9ef>Tail</span><span style=color:#f92672>](</span>head<span style=color:#66d9ef>:</span> <span style=color:#66d9ef>Head</span><span style=color:#f92672>,</span> tail<span style=color:#66d9ef>:</span> <span style=color:#66d9ef>Tail</span><span style=color:#f92672>)</span> <span style=color:#75715e>// The `head :: tail` operation
</span><span style=color:#75715e></span>
<span style=color:#66d9ef>val</span> empty <span style=color:#66d9ef>:</span> <span style=color:#66d9ef>HNil</span> <span style=color:#f92672>=</span>
  <span style=color:#a6e22e>HNil</span><span style=color:#f92672>()</span>

<span style=color:#66d9ef>val</span> oneTrueToto <span style=color:#66d9ef>:</span> <span style=color:#66d9ef>HCons</span><span style=color:#f92672>[</span><span style=color:#66d9ef>Int</span>, <span style=color:#66d9ef>HCons</span><span style=color:#f92672>[</span><span style=color:#66d9ef>Boolean</span>, <span style=color:#66d9ef>HCons</span><span style=color:#f92672>[</span><span style=color:#66d9ef>String</span>, <span style=color:#66d9ef>HNil</span><span style=color:#f92672>]]]</span> <span style=color:#66d9ef>=</span>
  <span style=color:#a6e22e>HCons</span><span style=color:#f92672>(</span><span style=color:#ae81ff>1</span><span style=color:#f92672>,</span> <span style=color:#a6e22e>HCons</span><span style=color:#f92672>(</span><span style=color:#66d9ef>true</span><span style=color:#f92672>,</span> <span style=color:#a6e22e>HCons</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;toto&#34;</span><span style=color:#f92672>,</span> <span style=color:#a6e22e>HNil</span><span style=color:#f92672>())))</span>

<span style=color:#66d9ef>val</span> falseTrueFive<span style=color:#66d9ef>:</span> <span style=color:#66d9ef>HCons</span><span style=color:#f92672>[</span><span style=color:#66d9ef>Boolean</span>, <span style=color:#66d9ef>HCons</span><span style=color:#f92672>[</span><span style=color:#66d9ef>Boolean</span>, <span style=color:#66d9ef>HCons</span><span style=color:#f92672>[</span><span style=color:#66d9ef>Int</span>, <span style=color:#66d9ef>HNil</span><span style=color:#f92672>]]]</span> <span style=color:#66d9ef>=</span>
  <span style=color:#a6e22e>HCons</span><span style=color:#f92672>(</span><span style=color:#66d9ef>false</span><span style=color:#f92672>,</span> <span style=color:#a6e22e>HCons</span><span style=color:#f92672>(</span><span style=color:#66d9ef>true</span><span style=color:#f92672>,</span> <span style=color:#a6e22e>HCons</span><span style=color:#f92672>(</span><span style=color:#ae81ff>5</span><span style=color:#f92672>,</span> <span style=color:#a6e22e>HNil</span><span style=color:#f92672>())))</span>
</code></pre></div><p>As you can see, there is nothing special about it. We want to define
orderings on heterogeneous lists. An ordering is a way to compare two
values (<strong>of the same type!</strong>): they can be equal or one may be lesser
than the other. In <em>Scala</em> we can define the trait <code>Order</code>:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scala data-lang=scala><span style=color:#66d9ef>trait</span> <span style=color:#a6e22e>Order</span><span style=color:#f92672>[</span><span style=color:#66d9ef>A</span><span style=color:#f92672>]</span> <span style=color:#f92672>{</span>
  <span style=color:#75715e>// true if and only if a1 &lt; a2
</span><span style=color:#75715e></span>  <span style=color:#66d9ef>def</span> lesserThan<span style=color:#f92672>(</span>a1<span style=color:#66d9ef>:</span> <span style=color:#66d9ef>A</span><span style=color:#f92672>,</span> a2<span style=color:#66d9ef>:</span> <span style=color:#66d9ef>A</span><span style=color:#f92672>)</span><span style=color:#66d9ef>:</span> <span style=color:#66d9ef>Boolean</span>

  <span style=color:#75715e>// a1 and a2 are equal if and only if none of them is lesser than the other.
</span><span style=color:#75715e></span>  <span style=color:#66d9ef>final</span> <span style=color:#66d9ef>def</span> areEqual<span style=color:#f92672>(</span>a1<span style=color:#66d9ef>:</span> <span style=color:#66d9ef>A</span><span style=color:#f92672>,</span> a2<span style=color:#66d9ef>:</span> <span style=color:#66d9ef>A</span><span style=color:#f92672>)</span><span style=color:#66d9ef>:</span> <span style=color:#66d9ef>Boolean</span> <span style=color:#f92672>=</span> <span style=color:#f92672>!</span>lesserThan<span style=color:#f92672>(</span>a1<span style=color:#f92672>,</span> a2<span style=color:#f92672>)</span> <span style=color:#f92672>&amp;&amp;</span> <span style=color:#f92672>!</span>lesserThan<span style=color:#f92672>(</span>a2<span style=color:#f92672>,</span> a1<span style=color:#f92672>)</span>

  <span style=color:#75715e>// a1 &gt; a2 if and only if a2 &lt; a1
</span><span style=color:#75715e></span>  <span style=color:#66d9ef>final</span> <span style=color:#66d9ef>def</span> greaterThan<span style=color:#f92672>(</span>a1<span style=color:#66d9ef>:</span> <span style=color:#66d9ef>A</span><span style=color:#f92672>,</span> a2<span style=color:#66d9ef>:</span> <span style=color:#66d9ef>A</span><span style=color:#f92672>)</span><span style=color:#66d9ef>:</span> <span style=color:#66d9ef>Boolean</span> <span style=color:#f92672>=</span> lesserThan<span style=color:#f92672>(</span>a2<span style=color:#f92672>,</span> a1<span style=color:#f92672>)</span>

  <span style=color:#66d9ef>final</span> <span style=color:#66d9ef>def</span> lesserThanOrEqual<span style=color:#f92672>(</span>a1<span style=color:#66d9ef>:</span> <span style=color:#66d9ef>A</span><span style=color:#f92672>,</span> a2<span style=color:#66d9ef>:</span> <span style=color:#66d9ef>A</span><span style=color:#f92672>)</span><span style=color:#66d9ef>:</span> <span style=color:#66d9ef>Boolean</span> <span style=color:#f92672>=</span> <span style=color:#f92672>!</span>lesserThan<span style=color:#f92672>(</span>a2<span style=color:#f92672>,</span> a1<span style=color:#f92672>)</span>

  <span style=color:#66d9ef>final</span> <span style=color:#66d9ef>def</span> greaterThanOrEqual<span style=color:#f92672>(</span>a1<span style=color:#66d9ef>:</span> <span style=color:#66d9ef>A</span><span style=color:#f92672>,</span> a2<span style=color:#66d9ef>:</span> <span style=color:#66d9ef>A</span><span style=color:#f92672>)</span><span style=color:#66d9ef>:</span> <span style=color:#66d9ef>Boolean</span> <span style=color:#f92672>=</span> <span style=color:#f92672>!</span>lesserThan<span style=color:#f92672>(</span>a1<span style=color:#f92672>,</span> a2<span style=color:#f92672>)</span>
<span style=color:#f92672>}</span>

<span style=color:#66d9ef>object</span> <span style=color:#a6e22e>Order</span> <span style=color:#f92672>{</span>
  <span style=color:#66d9ef>def</span> apply<span style=color:#f92672>[</span><span style=color:#66d9ef>A</span><span style=color:#f92672>](</span><span style=color:#66d9ef>implicit</span> ev<span style=color:#66d9ef>:</span> <span style=color:#66d9ef>Order</span><span style=color:#f92672>[</span><span style=color:#66d9ef>A</span><span style=color:#f92672>])</span><span style=color:#66d9ef>:</span> <span style=color:#66d9ef>ev.</span><span style=color:#66d9ef>type</span> <span style=color:#f92672>=</span> ev

  <span style=color:#66d9ef>def</span> make<span style=color:#f92672>[</span><span style=color:#66d9ef>A</span><span style=color:#f92672>](</span>lg_ <span style=color:#66d9ef>:</span> <span style=color:#f92672>(</span><span style=color:#66d9ef>A</span><span style=color:#f92672>,</span><span style=color:#66d9ef>A</span><span style=color:#f92672>)</span> <span style=color:#66d9ef>=&gt;</span> <span style=color:#a6e22e>Boolean</span><span style=color:#f92672>)</span><span style=color:#66d9ef>:</span> <span style=color:#66d9ef>Order</span><span style=color:#f92672>[</span><span style=color:#66d9ef>A</span><span style=color:#f92672>]</span> <span style=color:#66d9ef>=</span>
    <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>Order</span><span style=color:#f92672>[</span><span style=color:#66d9ef>A</span><span style=color:#f92672>]</span> <span style=color:#f92672>{</span>
      <span style=color:#66d9ef>def</span> lesserThan<span style=color:#f92672>(</span>a1<span style=color:#66d9ef>:</span> <span style=color:#66d9ef>A</span><span style=color:#f92672>,</span> a2<span style=color:#66d9ef>:</span> <span style=color:#66d9ef>A</span><span style=color:#f92672>)</span><span style=color:#66d9ef>:</span> <span style=color:#66d9ef>Boolean</span> <span style=color:#f92672>=</span> lg_<span style=color:#f92672>(</span>a1<span style=color:#f92672>,</span>a2<span style=color:#f92672>)</span>
    <span style=color:#f92672>}</span>
<span style=color:#f92672>}</span>

<span style=color:#66d9ef>implicit</span> <span style=color:#66d9ef>val</span> orderInt    <span style=color:#66d9ef>=</span> <span style=color:#a6e22e>Order</span><span style=color:#f92672>.</span>make<span style=color:#f92672>[</span><span style=color:#66d9ef>Int</span><span style=color:#f92672>](</span><span style=color:#66d9ef>_</span> <span style=color:#f92672>&lt;</span> <span style=color:#66d9ef>_</span><span style=color:#f92672>)</span>
<span style=color:#66d9ef>implicit</span> <span style=color:#66d9ef>val</span> orderString <span style=color:#66d9ef>=</span> <span style=color:#a6e22e>Order</span><span style=color:#f92672>.</span>make<span style=color:#f92672>[</span><span style=color:#66d9ef>String</span><span style=color:#f92672>](</span><span style=color:#66d9ef>_</span> <span style=color:#f92672>&lt;</span> <span style=color:#66d9ef>_</span><span style=color:#f92672>)</span>
</code></pre></div><p>Remember that we will only compare lists of the <em>same type</em>:</p><ul><li>Lists of type <code>HNil</code> will only be compared to lists of type <code>HNil</code>.</li><li>Lists of type <code>HCons[H,T]</code> will only be compared to lists of type <code>HCons[H,T]</code>.</li></ul><p>Comparing lists of type <code>HNil</code> is trivial because there is only one value
of type <code>HNil</code> (the empty list <code>HNil()</code>).
But there are many ways of comparing lists of type <code>HCons[H,T]</code>.
Here are two possible orderings (there exists many more!):</p><ul><li><p>The <em>lexicographic ordering</em> (i.e. dictionary order: from left to right)</p><blockquote><p><code>HCons(h1,t1) &lt; HCons(h2,t2)</code> <strong>if and only if</strong>
<code>h1 &lt; h2</code> <em>or</em> (<code>h1 == h2</code> <em>and</em> <code>t1 &lt; t2</code> <em>by lexicographic ordering</em>).</p></blockquote><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scala data-lang=scala><span style=color:#66d9ef>sealed</span> <span style=color:#66d9ef>trait</span> <span style=color:#a6e22e>Lex</span><span style=color:#f92672>[</span><span style=color:#66d9ef>A</span><span style=color:#f92672>]</span> <span style=color:#f92672>{</span>
  <span style=color:#66d9ef>val</span> order <span style=color:#66d9ef>:</span> <span style=color:#66d9ef>Order</span><span style=color:#f92672>[</span><span style=color:#66d9ef>A</span><span style=color:#f92672>]</span>
<span style=color:#f92672>}</span>

<span style=color:#66d9ef>object</span> <span style=color:#a6e22e>Lex</span> <span style=color:#f92672>{</span>
  <span style=color:#66d9ef>def</span> apply<span style=color:#f92672>[</span><span style=color:#66d9ef>A</span><span style=color:#f92672>](</span><span style=color:#66d9ef>implicit</span> ev<span style=color:#66d9ef>:</span> <span style=color:#66d9ef>Lex</span><span style=color:#f92672>[</span><span style=color:#66d9ef>A</span><span style=color:#f92672>])</span><span style=color:#66d9ef>:</span> <span style=color:#66d9ef>ev.</span><span style=color:#66d9ef>type</span> <span style=color:#f92672>=</span> ev

  <span style=color:#66d9ef>implicit</span> <span style=color:#66d9ef>val</span> lexHNil<span style=color:#66d9ef>:</span> <span style=color:#66d9ef>Lex</span><span style=color:#f92672>[</span><span style=color:#66d9ef>HNil</span><span style=color:#f92672>]</span> <span style=color:#66d9ef>=</span>
    <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>Lex</span><span style=color:#f92672>[</span><span style=color:#66d9ef>HNil</span><span style=color:#f92672>]</span> <span style=color:#f92672>{</span>
      <span style=color:#66d9ef>val</span> order <span style=color:#66d9ef>=</span> <span style=color:#a6e22e>Order</span><span style=color:#f92672>.</span>make<span style=color:#f92672>[</span><span style=color:#66d9ef>HNil</span><span style=color:#f92672>]((</span><span style=color:#66d9ef>_</span><span style=color:#f92672>,</span><span style=color:#66d9ef>_</span><span style=color:#f92672>)</span> <span style=color:#66d9ef>=&gt;</span> <span style=color:#66d9ef>false</span><span style=color:#f92672>)</span>
    <span style=color:#f92672>}</span>

  <span style=color:#66d9ef>implicit</span> <span style=color:#66d9ef>def</span> lexHCons<span style=color:#f92672>[</span><span style=color:#66d9ef>Head</span>,<span style=color:#66d9ef>Tail</span><span style=color:#f92672>](</span><span style=color:#66d9ef>implicit</span>
      orderHead<span style=color:#66d9ef>:</span> <span style=color:#66d9ef>Order</span><span style=color:#f92672>[</span><span style=color:#66d9ef>Head</span><span style=color:#f92672>],</span>
      lexTail<span style=color:#66d9ef>:</span> <span style=color:#66d9ef>Lex</span><span style=color:#f92672>[</span><span style=color:#66d9ef>Tail</span><span style=color:#f92672>]</span>
    <span style=color:#f92672>)</span><span style=color:#66d9ef>:</span> <span style=color:#66d9ef>Lex</span><span style=color:#f92672>[</span><span style=color:#66d9ef>HCons</span><span style=color:#f92672>[</span><span style=color:#66d9ef>Head</span>, <span style=color:#66d9ef>Tail</span><span style=color:#f92672>]]</span> <span style=color:#66d9ef>=</span>
    <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>Lex</span><span style=color:#f92672>[</span><span style=color:#66d9ef>HCons</span><span style=color:#f92672>[</span><span style=color:#66d9ef>Head</span>, <span style=color:#66d9ef>Tail</span><span style=color:#f92672>]]</span> <span style=color:#f92672>{</span>
      <span style=color:#66d9ef>val</span> orderTail<span style=color:#66d9ef>:</span> <span style=color:#66d9ef>Order</span><span style=color:#f92672>[</span><span style=color:#66d9ef>Tail</span><span style=color:#f92672>]</span> <span style=color:#66d9ef>=</span> lexTail<span style=color:#f92672>.</span>order

      <span style=color:#66d9ef>val</span> order <span style=color:#66d9ef>=</span> <span style=color:#a6e22e>Order</span><span style=color:#f92672>.</span>make<span style=color:#f92672>[</span><span style=color:#66d9ef>HCons</span><span style=color:#f92672>[</span><span style=color:#66d9ef>Head</span>, <span style=color:#66d9ef>Tail</span><span style=color:#f92672>]]</span> <span style=color:#f92672>{</span>
        <span style=color:#66d9ef>case</span> <span style=color:#f92672>(</span><span style=color:#a6e22e>HCons</span><span style=color:#f92672>(</span>h1<span style=color:#f92672>,</span>t1<span style=color:#f92672>),</span> <span style=color:#a6e22e>HCons</span><span style=color:#f92672>(</span>h2<span style=color:#f92672>,</span>t2<span style=color:#f92672>))</span> <span style=color:#66d9ef>=&gt;</span>
          orderHead<span style=color:#f92672>.</span>lesserThan<span style=color:#f92672>(</span>h1<span style=color:#f92672>,</span>h2<span style=color:#f92672>)</span> <span style=color:#f92672>||</span> <span style=color:#f92672>(</span>orderHead<span style=color:#f92672>.</span>areEqual<span style=color:#f92672>(</span>h1<span style=color:#f92672>,</span>h2<span style=color:#f92672>)</span> <span style=color:#f92672>&amp;&amp;</span> orderTail<span style=color:#f92672>.</span>lesserThan<span style=color:#f92672>(</span>t1<span style=color:#f92672>,</span>t2<span style=color:#f92672>))</span>
      <span style=color:#f92672>}</span>
    <span style=color:#f92672>}</span>
<span style=color:#f92672>}</span>
</code></pre></div></li><li><p>The <em>reverse-lexicographic</em> ordering, which is the reverse version
of the lexicographic ordering, (i.e. from right to left)</p><blockquote><p><code>HCons(h1,t1) &lt; HCons(h2,t2)</code> <strong>if and only if</strong>
<code>t1 &lt; t2</code> <em>by reverse-lexicographic ordering or</em> (<code>t1 == t2</code> <em>and</em> <code>h1 &lt; h2</code>).</p></blockquote><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scala data-lang=scala><span style=color:#66d9ef>sealed</span> <span style=color:#66d9ef>trait</span> <span style=color:#a6e22e>RevLex</span><span style=color:#f92672>[</span><span style=color:#66d9ef>A</span><span style=color:#f92672>]</span> <span style=color:#f92672>{</span>
  <span style=color:#66d9ef>val</span> order <span style=color:#66d9ef>:</span> <span style=color:#66d9ef>Order</span><span style=color:#f92672>[</span><span style=color:#66d9ef>A</span><span style=color:#f92672>]</span>
<span style=color:#f92672>}</span>

<span style=color:#66d9ef>object</span> <span style=color:#a6e22e>RevLex</span> <span style=color:#f92672>{</span>
  <span style=color:#66d9ef>def</span> apply<span style=color:#f92672>[</span><span style=color:#66d9ef>A</span><span style=color:#f92672>](</span><span style=color:#66d9ef>implicit</span> ev<span style=color:#66d9ef>:</span> <span style=color:#66d9ef>RevLex</span><span style=color:#f92672>[</span><span style=color:#66d9ef>A</span><span style=color:#f92672>])</span><span style=color:#66d9ef>:</span> <span style=color:#66d9ef>ev.</span><span style=color:#66d9ef>type</span> <span style=color:#f92672>=</span> ev

  <span style=color:#66d9ef>implicit</span> <span style=color:#66d9ef>val</span> revLexHNil<span style=color:#66d9ef>:</span> <span style=color:#66d9ef>RevLex</span><span style=color:#f92672>[</span><span style=color:#66d9ef>HNil</span><span style=color:#f92672>]</span> <span style=color:#66d9ef>=</span>
    <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>RevLex</span><span style=color:#f92672>[</span><span style=color:#66d9ef>HNil</span><span style=color:#f92672>]</span> <span style=color:#f92672>{</span>
      <span style=color:#66d9ef>val</span> order <span style=color:#66d9ef>=</span> <span style=color:#a6e22e>Order</span><span style=color:#f92672>.</span>make<span style=color:#f92672>[</span><span style=color:#66d9ef>HNil</span><span style=color:#f92672>]((</span><span style=color:#66d9ef>_</span><span style=color:#f92672>,</span><span style=color:#66d9ef>_</span><span style=color:#f92672>)</span> <span style=color:#66d9ef>=&gt;</span> <span style=color:#66d9ef>false</span><span style=color:#f92672>)</span>
    <span style=color:#f92672>}</span>

  <span style=color:#66d9ef>implicit</span> <span style=color:#66d9ef>def</span> revLexHCons<span style=color:#f92672>[</span><span style=color:#66d9ef>Head</span>,<span style=color:#66d9ef>Tail</span><span style=color:#f92672>](</span><span style=color:#66d9ef>implicit</span>
      orderHead<span style=color:#66d9ef>:</span> <span style=color:#66d9ef>Order</span><span style=color:#f92672>[</span><span style=color:#66d9ef>Head</span><span style=color:#f92672>],</span>
      revLexTail<span style=color:#66d9ef>:</span> <span style=color:#66d9ef>RevLex</span><span style=color:#f92672>[</span><span style=color:#66d9ef>Tail</span><span style=color:#f92672>]</span>
    <span style=color:#f92672>)</span><span style=color:#66d9ef>:</span> <span style=color:#66d9ef>RevLex</span><span style=color:#f92672>[</span><span style=color:#66d9ef>HCons</span><span style=color:#f92672>[</span><span style=color:#66d9ef>Head</span>, <span style=color:#66d9ef>Tail</span><span style=color:#f92672>]]</span> <span style=color:#66d9ef>=</span>
    <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>RevLex</span><span style=color:#f92672>[</span><span style=color:#66d9ef>HCons</span><span style=color:#f92672>[</span><span style=color:#66d9ef>Head</span>, <span style=color:#66d9ef>Tail</span><span style=color:#f92672>]]</span> <span style=color:#f92672>{</span>
      <span style=color:#66d9ef>val</span> orderTail<span style=color:#66d9ef>:</span> <span style=color:#66d9ef>Order</span><span style=color:#f92672>[</span><span style=color:#66d9ef>Tail</span><span style=color:#f92672>]</span> <span style=color:#66d9ef>=</span> revLexTail<span style=color:#f92672>.</span>order

      <span style=color:#66d9ef>val</span> order <span style=color:#66d9ef>=</span> <span style=color:#a6e22e>Order</span><span style=color:#f92672>.</span>make<span style=color:#f92672>[</span><span style=color:#66d9ef>HCons</span><span style=color:#f92672>[</span><span style=color:#66d9ef>Head</span>, <span style=color:#66d9ef>Tail</span><span style=color:#f92672>]]</span> <span style=color:#f92672>{</span>
        <span style=color:#66d9ef>case</span> <span style=color:#f92672>(</span><span style=color:#a6e22e>HCons</span><span style=color:#f92672>(</span>h1<span style=color:#f92672>,</span>t1<span style=color:#f92672>),</span> <span style=color:#a6e22e>HCons</span><span style=color:#f92672>(</span>h2<span style=color:#f92672>,</span>t2<span style=color:#f92672>))</span> <span style=color:#66d9ef>=&gt;</span>
          orderTail<span style=color:#f92672>.</span>lesserThan<span style=color:#f92672>(</span>t1<span style=color:#f92672>,</span>t2<span style=color:#f92672>)</span> <span style=color:#f92672>||</span> <span style=color:#f92672>(</span>orderTail<span style=color:#f92672>.</span>areEqual<span style=color:#f92672>(</span>t1<span style=color:#f92672>,</span>t2<span style=color:#f92672>)</span> <span style=color:#f92672>&amp;&amp;</span> orderHead<span style=color:#f92672>.</span>lesserThan<span style=color:#f92672>(</span>h1<span style=color:#f92672>,</span>h2<span style=color:#f92672>))</span>
      <span style=color:#f92672>}</span>
    <span style=color:#f92672>}</span>
<span style=color:#f92672>}</span>
</code></pre></div></li></ul><p>As said above, it is possible to define more orderings:</p><ul><li><p><strong>Question 1:</strong> The <code>Alternate</code> ordering is defined by:</p><blockquote><p><code>HCons(h1,t1) &lt; HCons(h2,t2)</code> <strong>if and only if</strong>
<code>h1 &lt; h2</code> <em>or</em> (<code>h1 == h2</code> <em>and</em> <code>t1 > t2</code> <em>by alternate ordering</em>).</p></blockquote><p>Just like what was done for <code>Lex</code> and <code>RevLex</code>,
implement the <code>Alternate</code> ordering.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scala data-lang=scala><span style=color:#66d9ef>sealed</span> <span style=color:#66d9ef>trait</span> <span style=color:#a6e22e>Alternate</span><span style=color:#f92672>[</span><span style=color:#66d9ef>A</span><span style=color:#f92672>]</span> <span style=color:#f92672>{</span>
  <span style=color:#66d9ef>val</span> order <span style=color:#66d9ef>:</span> <span style=color:#66d9ef>Order</span><span style=color:#f92672>[</span><span style=color:#66d9ef>A</span><span style=color:#f92672>]</span>
<span style=color:#f92672>}</span>

<span style=color:#66d9ef>object</span> <span style=color:#a6e22e>Alternate</span> <span style=color:#f92672>{</span>
  <span style=color:#66d9ef>def</span> apply<span style=color:#f92672>[</span><span style=color:#66d9ef>A</span><span style=color:#f92672>](</span><span style=color:#66d9ef>implicit</span> ev<span style=color:#66d9ef>:</span> <span style=color:#66d9ef>Alternate</span><span style=color:#f92672>[</span><span style=color:#66d9ef>A</span><span style=color:#f92672>])</span><span style=color:#66d9ef>:</span> <span style=color:#66d9ef>ev.</span><span style=color:#66d9ef>type</span> <span style=color:#f92672>=</span> ev

  <span style=color:#66d9ef>implicit</span> <span style=color:#66d9ef>val</span> alternateHNil<span style=color:#66d9ef>:</span> <span style=color:#66d9ef>Alternate</span><span style=color:#f92672>[</span><span style=color:#66d9ef>HNil</span><span style=color:#f92672>]</span> <span style=color:#66d9ef>=</span>
    <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>Alternate</span><span style=color:#f92672>[</span><span style=color:#66d9ef>HNil</span><span style=color:#f92672>]</span> <span style=color:#f92672>{</span>
      <span style=color:#66d9ef>val</span> order <span style=color:#66d9ef>=</span> <span style=color:#a6e22e>Order</span><span style=color:#f92672>.</span>make<span style=color:#f92672>[</span><span style=color:#66d9ef>HNil</span><span style=color:#f92672>]((</span><span style=color:#66d9ef>_</span><span style=color:#f92672>,</span><span style=color:#66d9ef>_</span><span style=color:#f92672>)</span> <span style=color:#66d9ef>=&gt;</span> <span style=color:#66d9ef>false</span><span style=color:#f92672>)</span>
    <span style=color:#f92672>}</span>

  <span style=color:#66d9ef>implicit</span> <span style=color:#66d9ef>def</span> alternateHCons<span style=color:#f92672>[</span><span style=color:#66d9ef>Head</span>,<span style=color:#66d9ef>Tail</span><span style=color:#f92672>](</span><span style=color:#66d9ef>implicit</span>
      orderHead<span style=color:#66d9ef>:</span> <span style=color:#66d9ef>Order</span><span style=color:#f92672>[</span><span style=color:#66d9ef>Head</span><span style=color:#f92672>],</span>
      alternateTail<span style=color:#66d9ef>:</span> <span style=color:#66d9ef>Alternate</span><span style=color:#f92672>[</span><span style=color:#66d9ef>Tail</span><span style=color:#f92672>]</span>
    <span style=color:#f92672>)</span><span style=color:#66d9ef>:</span> <span style=color:#66d9ef>Alternate</span><span style=color:#f92672>[</span><span style=color:#66d9ef>HCons</span><span style=color:#f92672>[</span><span style=color:#66d9ef>Head</span>, <span style=color:#66d9ef>Tail</span><span style=color:#f92672>]]</span> <span style=color:#66d9ef>=</span>
    <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>Alternate</span><span style=color:#f92672>[</span><span style=color:#66d9ef>HCons</span><span style=color:#f92672>[</span><span style=color:#66d9ef>Head</span>, <span style=color:#66d9ef>Tail</span><span style=color:#f92672>]]</span> <span style=color:#f92672>{</span>
      <span style=color:#66d9ef>val</span> orderTail<span style=color:#66d9ef>:</span> <span style=color:#66d9ef>Order</span><span style=color:#f92672>[</span><span style=color:#66d9ef>Tail</span><span style=color:#f92672>]</span> <span style=color:#66d9ef>=</span> alternateTail<span style=color:#f92672>.</span>order

      <span style=color:#66d9ef>val</span> order <span style=color:#66d9ef>=</span> <span style=color:#a6e22e>Order</span><span style=color:#f92672>.</span>make<span style=color:#f92672>[</span><span style=color:#66d9ef>HCons</span><span style=color:#f92672>[</span><span style=color:#66d9ef>Head</span>, <span style=color:#66d9ef>Tail</span><span style=color:#f92672>]]</span> <span style=color:#f92672>{</span>
        <span style=color:#66d9ef>case</span> <span style=color:#f92672>(</span><span style=color:#a6e22e>HCons</span><span style=color:#f92672>(</span>h1<span style=color:#f92672>,</span>t1<span style=color:#f92672>),</span> <span style=color:#a6e22e>HCons</span><span style=color:#f92672>(</span>h2<span style=color:#f92672>,</span>t2<span style=color:#f92672>))</span> <span style=color:#66d9ef>=&gt;</span>
          orderHead<span style=color:#f92672>.</span>lesserThan<span style=color:#f92672>(</span>h1<span style=color:#f92672>,</span>h2<span style=color:#f92672>)</span> <span style=color:#f92672>||</span> <span style=color:#f92672>(</span>orderHead<span style=color:#f92672>.</span>areEqual<span style=color:#f92672>(</span>h1<span style=color:#f92672>,</span>h2<span style=color:#f92672>)</span> <span style=color:#f92672>&amp;&amp;</span> orderTail<span style=color:#f92672>.</span>greaterThan<span style=color:#f92672>(</span>t1<span style=color:#f92672>,</span>t2<span style=color:#f92672>))</span>
      <span style=color:#f92672>}</span>
    <span style=color:#f92672>}</span>
<span style=color:#f92672>}</span>
</code></pre></div></li></ul><p>There are lots of ways to define a valid ordering on heterogeneous lists!
Defining type classes like <code>Lex</code>, <code>RevLex</code> and <code>Alternate</code> for every ordering
we want to implement is clunky and messy. We can do much better than that &mldr;
with a <em>GADT</em> 😉</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scala data-lang=scala><span style=color:#66d9ef>sealed</span> <span style=color:#66d9ef>trait</span> <span style=color:#a6e22e>HListOrder</span><span style=color:#f92672>[</span><span style=color:#66d9ef>A</span><span style=color:#f92672>]</span>
<span style=color:#a6e22e>object</span> <span style=color:#a6e22e>HListOrder</span> <span style=color:#f92672>{</span>
  <span style=color:#66d9ef>final</span> <span style=color:#66d9ef>case</span> <span style=color:#66d9ef>object</span> <span style=color:#a6e22e>HNilOrder</span> <span style=color:#66d9ef>extends</span> <span style=color:#a6e22e>HListOrder</span><span style=color:#f92672>[</span><span style=color:#66d9ef>HNil</span><span style=color:#f92672>]</span>

  <span style=color:#66d9ef>final</span> <span style=color:#66d9ef>case</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>HConsOrder</span><span style=color:#f92672>[</span><span style=color:#66d9ef>Head</span>,<span style=color:#66d9ef>Tail</span><span style=color:#f92672>](</span>
      orderHead<span style=color:#66d9ef>:</span> <span style=color:#66d9ef>Order</span><span style=color:#f92672>[</span><span style=color:#66d9ef>Head</span><span style=color:#f92672>],</span>
      hlistOrderTail<span style=color:#66d9ef>:</span> <span style=color:#66d9ef>HListOrder</span><span style=color:#f92672>[</span><span style=color:#66d9ef>Tail</span><span style=color:#f92672>]</span>
    <span style=color:#f92672>)</span> <span style=color:#66d9ef>extends</span> <span style=color:#a6e22e>HListOrder</span><span style=color:#f92672>[</span><span style=color:#66d9ef>HCons</span><span style=color:#f92672>[</span><span style=color:#66d9ef>Head</span>,<span style=color:#66d9ef>Tail</span><span style=color:#f92672>]]</span>

  <span style=color:#75715e>// Implicit definitions
</span><span style=color:#75715e></span>
  <span style=color:#66d9ef>implicit</span> <span style=color:#66d9ef>val</span> hnilOrder <span style=color:#66d9ef>:</span> <span style=color:#66d9ef>HListOrder</span><span style=color:#f92672>[</span><span style=color:#66d9ef>HNil</span><span style=color:#f92672>]</span> <span style=color:#66d9ef>=</span>
    <span style=color:#a6e22e>HNilOrder</span>

  <span style=color:#66d9ef>implicit</span> <span style=color:#66d9ef>def</span> hconsOrder<span style=color:#f92672>[</span><span style=color:#66d9ef>Head</span>,<span style=color:#66d9ef>Tail</span><span style=color:#f92672>](</span><span style=color:#66d9ef>implicit</span>
      orderHead<span style=color:#66d9ef>:</span> <span style=color:#66d9ef>Order</span><span style=color:#f92672>[</span><span style=color:#66d9ef>Head</span><span style=color:#f92672>],</span>
      hlistOrderTail<span style=color:#66d9ef>:</span> <span style=color:#66d9ef>HListOrder</span><span style=color:#f92672>[</span><span style=color:#66d9ef>Tail</span><span style=color:#f92672>]</span>
    <span style=color:#f92672>)</span><span style=color:#66d9ef>:</span> <span style=color:#66d9ef>HListOrder</span><span style=color:#f92672>[</span><span style=color:#66d9ef>HCons</span><span style=color:#f92672>[</span><span style=color:#66d9ef>Head</span>,<span style=color:#66d9ef>Tail</span><span style=color:#f92672>]]</span> <span style=color:#66d9ef>=</span>
    <span style=color:#a6e22e>HConsOrder</span><span style=color:#f92672>(</span>orderHead<span style=color:#f92672>,</span> hlistOrderTail<span style=color:#f92672>)</span>

  <span style=color:#66d9ef>def</span> apply<span style=color:#f92672>[</span><span style=color:#66d9ef>A</span><span style=color:#f92672>](</span><span style=color:#66d9ef>implicit</span> ev<span style=color:#66d9ef>:</span> <span style=color:#66d9ef>HListOrder</span><span style=color:#f92672>[</span><span style=color:#66d9ef>A</span><span style=color:#f92672>])</span><span style=color:#66d9ef>:</span> <span style=color:#66d9ef>ev.</span><span style=color:#66d9ef>type</span> <span style=color:#f92672>=</span> ev
<span style=color:#f92672>}</span>
</code></pre></div><p>Note that these implicit definitions are boilerplate. Their only purpose
is passing arguments to their corresponding constructor (i.e. <code>final case class</code>
or <code>case object</code>): <code>hnilOrder</code> to <code>HNilOrder</code> (O arguments) and <code>hconsOrder</code>
to <code>HConsOrder</code> (2 arguments).</p><ul><li><p><strong>Question 2:</strong> Write the function <code>def lex[A](implicit v : HListOrder[A]): Order[A]</code>
that computes the lexicographic ordering from a value of type <code>HListOrder[A]</code>.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scala data-lang=scala><span style=color:#66d9ef>def</span> lex<span style=color:#f92672>[</span><span style=color:#66d9ef>A</span><span style=color:#f92672>](</span><span style=color:#66d9ef>implicit</span> v <span style=color:#66d9ef>:</span> <span style=color:#66d9ef>HListOrder</span><span style=color:#f92672>[</span><span style=color:#66d9ef>A</span><span style=color:#f92672>])</span><span style=color:#66d9ef>:</span> <span style=color:#66d9ef>Order</span><span style=color:#f92672>[</span><span style=color:#66d9ef>A</span><span style=color:#f92672>]</span> <span style=color:#66d9ef>=</span>
  v <span style=color:#66d9ef>match</span> <span style=color:#f92672>{</span>
    <span style=color:#66d9ef>case</span> <span style=color:#a6e22e>HListOrder</span><span style=color:#f92672>.</span><span style=color:#a6e22e>HNilOrder</span> <span style=color:#66d9ef>=&gt;</span>
      <span style=color:#a6e22e>Order</span><span style=color:#f92672>.</span>make<span style=color:#f92672>[</span><span style=color:#66d9ef>HNil</span><span style=color:#f92672>]((</span><span style=color:#66d9ef>_</span><span style=color:#f92672>,</span><span style=color:#66d9ef>_</span><span style=color:#f92672>)</span> <span style=color:#66d9ef>=&gt;</span> <span style=color:#66d9ef>false</span><span style=color:#f92672>)</span>

    <span style=color:#66d9ef>case</span> hc <span style=color:#66d9ef>:</span> <span style=color:#66d9ef>HListOrder.HConsOrder</span><span style=color:#f92672>[</span><span style=color:#66d9ef>head</span>,<span style=color:#66d9ef>tail</span><span style=color:#f92672>]</span> <span style=color:#66d9ef>=&gt;</span>
      <span style=color:#66d9ef>val</span> orderHead<span style=color:#66d9ef>:</span> <span style=color:#66d9ef>Order</span><span style=color:#f92672>[</span><span style=color:#66d9ef>head</span><span style=color:#f92672>]</span> <span style=color:#66d9ef>=</span> hc<span style=color:#f92672>.</span>orderHead
      <span style=color:#66d9ef>val</span> orderTail<span style=color:#66d9ef>:</span> <span style=color:#66d9ef>Order</span><span style=color:#f92672>[</span><span style=color:#66d9ef>tail</span><span style=color:#f92672>]</span> <span style=color:#66d9ef>=</span> lex<span style=color:#f92672>(</span>hc<span style=color:#f92672>.</span>hlistOrderTail<span style=color:#f92672>)</span>

      <span style=color:#a6e22e>Order</span><span style=color:#f92672>.</span>make<span style=color:#f92672>[</span><span style=color:#66d9ef>HCons</span><span style=color:#f92672>[</span><span style=color:#66d9ef>head</span>, <span style=color:#66d9ef>tail</span><span style=color:#f92672>]]</span> <span style=color:#f92672>{</span>
        <span style=color:#66d9ef>case</span> <span style=color:#f92672>(</span><span style=color:#a6e22e>HCons</span><span style=color:#f92672>(</span>h1<span style=color:#f92672>,</span>t1<span style=color:#f92672>),</span> <span style=color:#a6e22e>HCons</span><span style=color:#f92672>(</span>h2<span style=color:#f92672>,</span>t2<span style=color:#f92672>))</span> <span style=color:#66d9ef>=&gt;</span>
          orderHead<span style=color:#f92672>.</span>lesserThan<span style=color:#f92672>(</span>h1<span style=color:#f92672>,</span>h2<span style=color:#f92672>)</span> <span style=color:#f92672>||</span> <span style=color:#f92672>(</span>orderHead<span style=color:#f92672>.</span>areEqual<span style=color:#f92672>(</span>h1<span style=color:#f92672>,</span>h2<span style=color:#f92672>)</span> <span style=color:#f92672>&amp;&amp;</span> orderTail<span style=color:#f92672>.</span>lesserThan<span style=color:#f92672>(</span>t1<span style=color:#f92672>,</span>t2<span style=color:#f92672>))</span>
      <span style=color:#f92672>}</span>
  <span style=color:#f92672>}</span>
</code></pre></div></li><li><p><strong>Question 3:</strong> Write the function <code>def revLex[A](implicit v : HListOrder[A]): Order[A]</code>
that computes the reverse-lexicographic ordering from a value of type <code>HListOrder[A]</code>.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scala data-lang=scala><span style=color:#66d9ef>def</span> revLex<span style=color:#f92672>[</span><span style=color:#66d9ef>A</span><span style=color:#f92672>](</span><span style=color:#66d9ef>implicit</span> v <span style=color:#66d9ef>:</span> <span style=color:#66d9ef>HListOrder</span><span style=color:#f92672>[</span><span style=color:#66d9ef>A</span><span style=color:#f92672>])</span><span style=color:#66d9ef>:</span> <span style=color:#66d9ef>Order</span><span style=color:#f92672>[</span><span style=color:#66d9ef>A</span><span style=color:#f92672>]</span> <span style=color:#66d9ef>=</span>
  v <span style=color:#66d9ef>match</span> <span style=color:#f92672>{</span>
    <span style=color:#66d9ef>case</span> <span style=color:#a6e22e>HListOrder</span><span style=color:#f92672>.</span><span style=color:#a6e22e>HNilOrder</span> <span style=color:#66d9ef>=&gt;</span>
      <span style=color:#a6e22e>Order</span><span style=color:#f92672>.</span>make<span style=color:#f92672>[</span><span style=color:#66d9ef>HNil</span><span style=color:#f92672>]((</span><span style=color:#66d9ef>_</span><span style=color:#f92672>,</span><span style=color:#66d9ef>_</span><span style=color:#f92672>)</span> <span style=color:#66d9ef>=&gt;</span> <span style=color:#66d9ef>false</span><span style=color:#f92672>)</span>

    <span style=color:#66d9ef>case</span> hc <span style=color:#66d9ef>:</span> <span style=color:#66d9ef>HListOrder.HConsOrder</span><span style=color:#f92672>[</span><span style=color:#66d9ef>head</span>,<span style=color:#66d9ef>tail</span><span style=color:#f92672>]</span> <span style=color:#66d9ef>=&gt;</span>
      <span style=color:#66d9ef>val</span> orderHead<span style=color:#66d9ef>:</span> <span style=color:#66d9ef>Order</span><span style=color:#f92672>[</span><span style=color:#66d9ef>head</span><span style=color:#f92672>]</span> <span style=color:#66d9ef>=</span> hc<span style=color:#f92672>.</span>orderHead
      <span style=color:#66d9ef>val</span> orderTail<span style=color:#66d9ef>:</span> <span style=color:#66d9ef>Order</span><span style=color:#f92672>[</span><span style=color:#66d9ef>tail</span><span style=color:#f92672>]</span> <span style=color:#66d9ef>=</span> revLex<span style=color:#f92672>(</span>hc<span style=color:#f92672>.</span>hlistOrderTail<span style=color:#f92672>)</span>

      <span style=color:#a6e22e>Order</span><span style=color:#f92672>.</span>make<span style=color:#f92672>[</span><span style=color:#66d9ef>HCons</span><span style=color:#f92672>[</span><span style=color:#66d9ef>head</span>, <span style=color:#66d9ef>tail</span><span style=color:#f92672>]]</span> <span style=color:#f92672>{</span>
        <span style=color:#66d9ef>case</span> <span style=color:#f92672>(</span><span style=color:#a6e22e>HCons</span><span style=color:#f92672>(</span>h1<span style=color:#f92672>,</span>t1<span style=color:#f92672>),</span> <span style=color:#a6e22e>HCons</span><span style=color:#f92672>(</span>h2<span style=color:#f92672>,</span>t2<span style=color:#f92672>))</span> <span style=color:#66d9ef>=&gt;</span>
          orderTail<span style=color:#f92672>.</span>lesserThan<span style=color:#f92672>(</span>t1<span style=color:#f92672>,</span>t2<span style=color:#f92672>)</span> <span style=color:#f92672>||</span> <span style=color:#f92672>(</span>orderTail<span style=color:#f92672>.</span>areEqual<span style=color:#f92672>(</span>t1<span style=color:#f92672>,</span>t2<span style=color:#f92672>)</span> <span style=color:#f92672>&amp;&amp;</span> orderHead<span style=color:#f92672>.</span>lesserThan<span style=color:#f92672>(</span>h1<span style=color:#f92672>,</span>h2<span style=color:#f92672>))</span>
      <span style=color:#f92672>}</span>
  <span style=color:#f92672>}</span>
</code></pre></div></li></ul><p>This approach has several benefits. Whereas the initial approach had to find
one implicit by ordering, the <em>GADT</em> approach only have to find one! Considering
implicit resolution is a costly operation, reducing it means faster compilation times.
Reading the code of functions <code>lex</code> and <code>revLex</code> is easier than understanding how
implicit resolution works for traits <code>Lex</code> and <code>RevLex</code>. Furthermore, they are just
functions, you can use all you can code in building the instance <code>Order[A]</code>.</p><h2 id=conclusion>Conclusion</h2><p>Not so trivial, isn&rsquo;t it? 😉 Actually a fair amount
of the complexity you may have experienced comes to
the fact that reasoning about values and types is almost
never taught in programming courses.
What you consider simple now (web APIs, Streaming, Databases, etc)
would probably terrifies your younger self when you
were introduced for the first time to &ldquo;Hello World!&rdquo;.
You probably did not learn all you know in programming
in three hours so do not expect reasoning about programs
to be magically easier.</p><p>This workshop aimed at inspiring you, opening your mind
to this all new set of possibilities. If you found the use case
interesting, then take the time to understand the techniques.</p><p>Have fun and take care ❤️</p></div><div class=pagination><div class=pagination__title><span class=pagination__title-h>Read other posts</span><hr></div><div class=pagination__buttons><span class="button next"><a href=https://stankoua.github.io/posts/en/hello-world-post/><span class=button__text>Hello Word Post</span>
<span class=button__icon>→</span></a></span></div></div></div></div><footer class=footer><div class=footer__inner><div class=copyright><span>© 2024 Powered by <a href=http://gohugo.io>Hugo</a></span>
<span>:: Theme made by <a href=https://twitter.com/panr>panr</a></span></div></div></footer><script src=https://stankoua.github.io/assets/main.js></script><script src=https://stankoua.github.io/assets/prism.js></script></div></body></html>