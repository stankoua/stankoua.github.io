<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>5-td-monades</title>
  <style>
    html {
      color: #1a1a1a;
      background-color: #fdfdfd;
    }
    body {
      margin: 0 auto;
      max-width: 36em;
      padding-left: 50px;
      padding-right: 50px;
      padding-top: 50px;
      padding-bottom: 50px;
      hyphens: auto;
      overflow-wrap: break-word;
      text-rendering: optimizeLegibility;
      font-kerning: normal;
    }
    @media (max-width: 600px) {
      body {
        font-size: 0.9em;
        padding: 12px;
      }
      h1 {
        font-size: 1.8em;
      }
    }
    @media print {
      html {
        background-color: white;
      }
      body {
        background-color: transparent;
        color: black;
        font-size: 12pt;
      }
      p, h2, h3 {
        orphans: 3;
        widows: 3;
      }
      h2, h3, h4 {
        page-break-after: avoid;
      }
    }
    p {
      margin: 1em 0;
    }
    a {
      color: #1a1a1a;
    }
    a:visited {
      color: #1a1a1a;
    }
    img {
      max-width: 100%;
    }
    svg {
      height: auto;
      max-width: 100%;
    }
    h1, h2, h3, h4, h5, h6 {
      margin-top: 1.4em;
    }
    h5, h6 {
      font-size: 1em;
      font-style: italic;
    }
    h6 {
      font-weight: normal;
    }
    ol, ul {
      padding-left: 1.7em;
      margin-top: 1em;
    }
    li > ol, li > ul {
      margin-top: 0;
    }
    blockquote {
      margin: 1em 0 1em 1.7em;
      padding-left: 1em;
      border-left: 2px solid #e6e6e6;
      color: #606060;
    }
    code {
      font-family: Menlo, Monaco, Consolas, 'Lucida Console', monospace;
      font-size: 85%;
      margin: 0;
      hyphens: manual;
    }
    pre {
      margin: 1em 0;
      overflow: auto;
    }
    pre code {
      padding: 0;
      overflow: visible;
      overflow-wrap: normal;
    }
    .sourceCode {
     background-color: transparent;
     overflow: visible;
    }
    hr {
      background-color: #1a1a1a;
      border: none;
      height: 1px;
      margin: 1em 0;
    }
    table {
      margin: 1em 0;
      border-collapse: collapse;
      width: 100%;
      overflow-x: auto;
      display: block;
      font-variant-numeric: lining-nums tabular-nums;
    }
    table caption {
      margin-bottom: 0.75em;
    }
    tbody {
      margin-top: 0.5em;
      border-top: 1px solid #1a1a1a;
      border-bottom: 1px solid #1a1a1a;
    }
    th {
      border-top: 1px solid #1a1a1a;
      padding: 0.25em 0.5em 0.25em 0.5em;
    }
    td {
      padding: 0.125em 0.5em 0.25em 0.5em;
    }
    header {
      margin-bottom: 4em;
      text-align: center;
    }
    #TOC li {
      list-style: none;
    }
    #TOC ul {
      padding-left: 1.3em;
    }
    #TOC > ul {
      padding-left: 0;
    }
    #TOC a:not(:hover) {
      text-decoration: none;
    }
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    div.columns{display: flex; gap: min(4vw, 1.5em);}
    div.column{flex: auto; overflow-x: auto;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    /* The extra [class] is a hack that increases specificity enough to
       override a similar rule in reveal.js */
    ul.task-list[class]{list-style: none;}
    ul.task-list li input[type="checkbox"] {
      font-size: inherit;
      width: 0.8em;
      margin: 0 0.8em 0.2em -1.6em;
      vertical-align: middle;
    }
    .display.math{display: block; text-align: center; margin: 0.5rem auto;}
    /* CSS for syntax highlighting */
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    .sourceCode { overflow: visible; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
        color: #aaaaaa;
      }
    pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
    div.sourceCode
      {   }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span.al { color: #ff0000; font-weight: bold; } /* Alert */
    code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
    code span.at { color: #7d9029; } /* Attribute */
    code span.bn { color: #40a070; } /* BaseN */
    code span.bu { color: #008000; } /* BuiltIn */
    code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
    code span.ch { color: #4070a0; } /* Char */
    code span.cn { color: #880000; } /* Constant */
    code span.co { color: #60a0b0; font-style: italic; } /* Comment */
    code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
    code span.do { color: #ba2121; font-style: italic; } /* Documentation */
    code span.dt { color: #902000; } /* DataType */
    code span.dv { color: #40a070; } /* DecVal */
    code span.er { color: #ff0000; font-weight: bold; } /* Error */
    code span.ex { } /* Extension */
    code span.fl { color: #40a070; } /* Float */
    code span.fu { color: #06287e; } /* Function */
    code span.im { color: #008000; font-weight: bold; } /* Import */
    code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
    code span.kw { color: #007020; font-weight: bold; } /* Keyword */
    code span.op { color: #666666; } /* Operator */
    code span.ot { color: #007020; } /* Other */
    code span.pp { color: #bc7a00; } /* Preprocessor */
    code span.sc { color: #4070a0; } /* SpecialChar */
    code span.ss { color: #bb6688; } /* SpecialString */
    code span.st { color: #4070a0; } /* String */
    code span.va { color: #19177c; } /* Variable */
    code span.vs { color: #4070a0; } /* VerbatimString */
    code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
  </style>
</head>
<body>
<h1 id="td-6-monades">TD 6: Monades</h1>
<!-- pandoc -s ./v3/td/src/5-td-monades.md -o ./v3/td/out/5-td-monades.html -->
<!-- pandoc -s ./v3/td/src/5-td-monades.md -o ./v3/td/out/5-td-monades.pdf -->
<h2 id="dans-le-future">Dans le future</h2>
<h3 id="exercice-1">Exercice 1:</h3>
<p>Dans cet exercice, vous disposez d’une méthode qui accède à un
service Web pour obtenir le prix actuel d’une action. Comme il s’agit
d’un service Web, son retour peut être lent, voire échouer. En
conséquence, vous créez une méthode à exécuter en tant que Future. Il
prend un symbole boursier comme paramètre d’entrée et renvoie le cours
de l’action sous la forme d’un double dans un futur, donc sa signature
ressemble à ceci:</p>
<div class="sourceCode" id="cb1"><pre
class="sourceCode scala"><code class="sourceCode scala"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> <span class="fu">getStockPrice</span><span class="op">(</span>stockSymbol<span class="op">:</span> <span class="ex">String</span><span class="op">):</span> <span class="ex">Future</span><span class="op">[</span><span class="ex">Double</span><span class="op">]</span> <span class="op">=</span> <span class="op">???</span></span></code></pre></div>
<p>Nous ne voulons pas écrire une méthode qui accède à un service Web
dans cet exercice, nous allons donc créer une méthode qui a une durée
d’exécution variable comme celle-ci:</p>
<div class="sourceCode" id="cb2"><pre
class="sourceCode scala"><code class="sourceCode scala"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> <span class="fu">getStockPrice</span><span class="op">(</span>stockSymbol<span class="op">:</span> <span class="ex">String</span><span class="op">):</span> <span class="ex">Future</span><span class="op">[</span><span class="ex">Double</span><span class="op">]</span> <span class="op">=</span> <span class="ex">Future</span> <span class="op">{</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">val</span> r <span class="op">=</span> scala<span class="op">.</span>util<span class="op">.</span><span class="ex">Random</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">val</span> randomSleepTime <span class="op">=</span> r<span class="op">.</span><span class="fu">nextInt</span><span class="op">(</span><span class="dv">3000</span><span class="op">)</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">val</span> randomPrice <span class="op">=</span> r<span class="op">.</span>nextDouble <span class="op">*</span> <span class="dv">1000</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">sleep</span><span class="op">(</span>randomSleepTime<span class="op">)</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>    randomPrice</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<h4 id="question-1">Question 1:</h4>
<p>Nous souhaitons récupérer en parallèle les cours pour les actions
suivantes: “AAPL”, “AMZN”, “GOOG”, “FCBK” et nous souhaitons les stocker
dans la classe <code>GafaStockPrices</code> ci-après:</p>
<div class="sourceCode" id="cb3"><pre
class="sourceCode scala"><code class="sourceCode scala"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="cf">case</span> <span class="kw">class</span> <span class="fu">GafaStockPrices</span><span class="op">(</span>apple<span class="op">:</span> <span class="ex">Double</span><span class="op">,</span> amazon<span class="op">:</span> <span class="ex">Double</span><span class="op">,</span> google<span class="op">:</span> <span class="ex">Double</span><span class="op">,</span> facebook<span class="op">:</span> <span class="ex">Double</span><span class="op">)</span></span></code></pre></div>
<p>Implémenter le code pour construire le <code>GafaStockPrices</code>
et le stocke dans la variable <code>gafaStockPrices</code>:</p>
<div class="sourceCode" id="cb4"><pre
class="sourceCode scala"><code class="sourceCode scala"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="kw">val</span> gafaStockPrices<span class="op">:</span> <span class="ex">Future</span><span class="op">[</span>GafaStockPrices<span class="op">]</span> <span class="op">=</span> <span class="op">???</span></span></code></pre></div>
<h4 id="question-2">Question 2:</h4>
<p>Nous souhaitons définir un portefeuille de la façon suivante (avec la
quantité des actions détenus):</p>
<div class="sourceCode" id="cb5"><pre
class="sourceCode scala"><code class="sourceCode scala"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="cf">case</span> <span class="kw">class</span> <span class="fu">GafaPortofolio</span><span class="op">(</span>apple<span class="op">:</span> <span class="bu">Int</span><span class="op">,</span> amazon<span class="op">:</span> <span class="bu">Int</span><span class="op">,</span> google<span class="op">:</span> <span class="bu">Int</span><span class="op">,</span> facebook<span class="op">:</span> <span class="bu">Int</span><span class="op">)</span></span></code></pre></div>
<p>Ecrire la fonction <code>portofolioAmount</code> dont la signature
est la suivante:</p>
<div class="sourceCode" id="cb6"><pre
class="sourceCode scala"><code class="sourceCode scala"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> <span class="fu">portofolioAmount</span><span class="op">(</span>portofolio<span class="op">:</span> GafaPortofolio<span class="op">):</span> <span class="ex">Future</span><span class="op">[</span>Amount<span class="op">]</span> <span class="op">=</span> <span class="op">???</span></span></code></pre></div>
<h4 id="question-3">Question 3:</h4>
<p>Quel est le montant du portefueille suivant:</p>
<div class="sourceCode" id="cb7"><pre
class="sourceCode scala"><code class="sourceCode scala"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">GafaPortofolio</span><span class="op">(</span>apple<span class="op">:</span> <span class="dv">4</span><span class="op">,</span> amazon<span class="op">:</span> <span class="dv">9</span><span class="op">,</span> google<span class="op">:</span> <span class="dv">6</span><span class="op">,</span> facebook<span class="op">:</span> <span class="dv">8</span><span class="op">)</span></span></code></pre></div>
<h4 id="question-4">Question 4:</h4>
<p>Nous avons la liste de portefeuilles suivantes:</p>
<div class="sourceCode" id="cb8"><pre
class="sourceCode scala"><code class="sourceCode scala"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="ex">List</span><span class="op">(</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>   <span class="fu">GafaPortofolio</span><span class="op">(</span>apple<span class="op">:</span> <span class="dv">4</span><span class="op">,</span> amazon<span class="op">:</span> <span class="dv">9</span><span class="op">,</span> google<span class="op">:</span> <span class="dv">6</span><span class="op">,</span> facebook<span class="op">:</span> <span class="dv">8</span><span class="op">),</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>   <span class="fu">GafaPortofolio</span><span class="op">(</span>apple<span class="op">:</span> <span class="dv">2</span><span class="op">,</span> amazon<span class="op">:</span> <span class="dv">5</span><span class="op">,</span> google<span class="op">:</span> <span class="dv">3</span><span class="op">,</span> facebook<span class="op">:</span> <span class="dv">7</span><span class="op">),</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>   <span class="fu">GafaPortofolio</span><span class="op">(</span>apple<span class="op">:</span> <span class="dv">8</span><span class="op">,</span> amazon<span class="op">:</span> <span class="dv">2</span><span class="op">,</span> google<span class="op">:</span> <span class="dv">3</span><span class="op">,</span> facebook<span class="op">:</span> <span class="dv">5</span><span class="op">)</span></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a><span class="op">)</span></span></code></pre></div>
<p>Quel est le montant total de la liste de portefeuilles ci-dessus
?</p>
<p>NB: Vous pourrez utiliser la méthode
<code>Future.sequence</code>.</p>
<h2 id="avec-quelques-dépendances">Avec quelques dépendances</h2>
<h3 id="exercice-1-1">Exercice 1:</h3>
<p>Dans cet exercice nous allons essayer d’implémenter une classe
<code>Reader</code>. La classe <code>Reader</code> permet de passer en
argument d’une fonction. Nous souhaitons définir notre classe
<code>Reader</code> comme une classe ayant en attribut une fonction
prenant un argument (la dépendance dont nous aurons besoin, de type
<code>A</code>). La réprésentation de la classe <code>Reader</code> sera
la suivante:</p>
<div class="sourceCode" id="cb9"><pre
class="sourceCode scala"><code class="sourceCode scala"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="cf">case</span> <span class="kw">class</span> <span class="ex">Reader</span><span class="op">[-</span>A<span class="op">,</span> <span class="op">+</span>B<span class="op">](</span>run<span class="op">:</span> A <span class="op">=&gt;</span> B<span class="op">)</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a><span class="kw">object</span> <span class="ex">Reader</span> <span class="op">{</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>   <span class="kw">def</span> ask<span class="op">[</span>A<span class="op">]:</span> <span class="ex">Reader</span><span class="op">[</span>A<span class="op">,</span> A<span class="op">]</span> <span class="op">=</span> <span class="ex">Reader</span><span class="op">(</span>a <span class="op">=&gt;</span> a<span class="op">)</span></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>   <span class="kw">def</span> pure<span class="op">[</span>A<span class="op">,</span> B<span class="op">](</span>value<span class="op">:</span> B<span class="op">):</span> <span class="ex">Reader</span><span class="op">[</span>A<span class="op">,</span> B<span class="op">]</span> <span class="op">=</span> <span class="ex">Reader</span><span class="op">(</span>_ <span class="op">=&gt;</span> value<span class="op">)</span></span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<h4 id="question-1-1">Question 1:</h4>
<p>Implémenter la méthode <code>map</code> dont la signature est la
suivante:</p>
<div class="sourceCode" id="cb10"><pre
class="sourceCode scala"><code class="sourceCode scala"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="cf">case</span> <span class="kw">class</span> <span class="ex">Reader</span><span class="op">[-</span>A<span class="op">,</span> <span class="op">+</span>B<span class="op">](</span>run<span class="op">:</span> A <span class="op">=&gt;</span> B<span class="op">)</span> <span class="op">{</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>   <span class="kw">def</span> map<span class="op">[</span>C<span class="op">](</span>g<span class="op">:</span> B <span class="op">=&gt;</span> C<span class="op">):</span> <span class="ex">Reader</span><span class="op">[</span>A<span class="op">,</span> C<span class="op">]</span> <span class="op">=</span> <span class="op">???</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<h4 id="question-2-1">Question 2:</h4>
<p>Implémenter la méthode <code>flatMap</code> dont la signature est la
suivante:</p>
<div class="sourceCode" id="cb11"><pre
class="sourceCode scala"><code class="sourceCode scala"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="cf">case</span> <span class="kw">class</span> <span class="ex">Reader</span><span class="op">[-</span>A<span class="op">,</span> <span class="op">+</span>B<span class="op">](</span>run<span class="op">:</span> A <span class="op">=&gt;</span> B<span class="op">)</span> <span class="op">{</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>   <span class="kw">def</span> flatMap<span class="op">[</span>C<span class="op">](</span>g<span class="op">:</span> B <span class="op">=&gt;</span> <span class="ex">Reader</span><span class="op">[</span>A<span class="op">,</span> C<span class="op">]):</span> <span class="ex">Reader</span><span class="op">[</span>A<span class="op">,</span> C<span class="op">]</span> <span class="op">=</span> <span class="op">???</span></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<h4 id="question-3-1">Question 3:</h4>
<p>Nous définissons pour la suite de l’exercice la classe
<code>DbReader</code> représentant une configuration. Notre
configuration sera composée de deux bases de données: une liste
d’utilisateurs valides et une liste de leurs mots de passe:</p>
<div class="sourceCode" id="cb12"><pre
class="sourceCode scala"><code class="sourceCode scala"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="kw">final</span> <span class="cf">case</span> <span class="kw">class</span> <span class="fu">Db</span><span class="op">(</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>  usernames<span class="op">:</span> <span class="ex">Map</span><span class="op">[</span><span class="bu">Int</span><span class="op">,</span> <span class="ex">String</span><span class="op">],</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>  passwords<span class="op">:</span> <span class="ex">Map</span><span class="op">[</span><span class="ex">String</span><span class="op">,</span> <span class="ex">String</span><span class="op">]</span></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a><span class="op">)</span></span></code></pre></div>
<p>Définissons les méthodes suivantes (on peut utiliser les méthodes
<code>get</code> sur <code>Map</code>):</p>
<div class="sourceCode" id="cb13"><pre
class="sourceCode scala"><code class="sourceCode scala"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> <span class="fu">findUsername</span><span class="op">(</span>userId<span class="op">:</span> <span class="bu">Int</span><span class="op">):</span> DbReader<span class="op">[</span><span class="ex">Option</span><span class="op">[</span><span class="ex">String</span><span class="op">]]</span> <span class="op">=</span> <span class="op">???</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> <span class="fu">checkPassword</span><span class="op">(</span>username<span class="op">:</span> <span class="ex">String</span><span class="op">,</span> password<span class="op">:</span> <span class="ex">String</span><span class="op">):</span> DbReader<span class="op">[</span><span class="ex">Boolean</span><span class="op">]</span> <span class="op">=</span> <span class="op">???</span></span></code></pre></div>
<h4 id="question-4-1">Question 4:</h4>
<p>Définissez la méthode <code>checkLogin</code> qui vérifie qu’il
existe un mot de passe pour un username et dont la signaturte est la
suivante:</p>
<div class="sourceCode" id="cb14"><pre
class="sourceCode scala"><code class="sourceCode scala"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> <span class="fu">checkLogin</span><span class="op">(</span>userId<span class="op">:</span> <span class="bu">Int</span><span class="op">,</span> password<span class="op">:</span> <span class="ex">String</span><span class="op">):</span> DbReader<span class="op">[</span><span class="ex">Boolean</span><span class="op">]</span> <span class="op">=</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>  <span class="op">???</span></span></code></pre></div>
<h4 id="question-5">Question 5:</h4>
<p>Quel est le résultat du code suivant:</p>
<div class="sourceCode" id="cb15"><pre
class="sourceCode scala"><code class="sourceCode scala"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="kw">val</span> users <span class="op">=</span> <span class="ex">Map</span><span class="op">(</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>  <span class="dv">1</span> <span class="op">-&gt;</span> <span class="st">&quot;dade&quot;</span><span class="op">,</span></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>  <span class="dv">2</span> <span class="op">-&gt;</span> <span class="st">&quot;kate&quot;</span><span class="op">,</span></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>  <span class="dv">3</span> <span class="op">-&gt;</span> <span class="st">&quot;margo&quot;</span></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a><span class="op">)</span></span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a><span class="kw">val</span> passwords <span class="op">=</span> <span class="ex">Map</span><span class="op">(</span></span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;dade&quot;</span>  <span class="op">-&gt;</span> <span class="st">&quot;zerocool&quot;</span><span class="op">,</span></span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;kate&quot;</span>  <span class="op">-&gt;</span> <span class="st">&quot;acidburn&quot;</span><span class="op">,</span></span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;margo&quot;</span> <span class="op">-&gt;</span> <span class="st">&quot;secret&quot;</span></span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a><span class="op">)</span></span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-13"><a href="#cb15-13" aria-hidden="true" tabindex="-1"></a><span class="kw">val</span> db <span class="op">=</span> <span class="fu">Db</span><span class="op">(</span>users<span class="op">,</span> passwords<span class="op">)</span></span>
<span id="cb15-14"><a href="#cb15-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-15"><a href="#cb15-15" aria-hidden="true" tabindex="-1"></a><span class="fu">checkLogin</span><span class="op">(</span><span class="dv">1</span><span class="op">,</span> <span class="st">&quot;zerocool&quot;</span><span class="op">).</span><span class="fu">run</span><span class="op">(</span>db<span class="op">)</span></span>
<span id="cb15-16"><a href="#cb15-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-17"><a href="#cb15-17" aria-hidden="true" tabindex="-1"></a><span class="fu">checkLogin</span><span class="op">(</span><span class="dv">4</span><span class="op">,</span> <span class="st">&quot;davinci&quot;</span><span class="op">).</span><span class="fu">run</span><span class="op">(</span>db<span class="op">)</span></span></code></pre></div>
<h2 id="problèmes-détat">Problèmes d’état</h2>
<h3 id="exercice-1-2">Exercice 1:</h3>
<p>Dans cet exercice nous allons essayer d’implémenter la classe
<code>State</code>. La classe <code>State</code> permet de réprésenter
une expression effectuant une modification d’un état global. La
réprésentation de la classe <code>State</code> sera la suivante:</p>
<div class="sourceCode" id="cb16"><pre
class="sourceCode scala"><code class="sourceCode scala"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="cf">case</span> <span class="kw">class</span> <span class="ex">State</span><span class="op">[-</span>A<span class="op">,</span> <span class="op">+</span>B<span class="op">](</span>run<span class="op">:</span> A <span class="op">=&gt;</span> <span class="op">(</span>A<span class="op">,</span> B<span class="op">))</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a><span class="kw">object</span> <span class="ex">State</span> <span class="op">{</span></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>   <span class="kw">def</span> pure<span class="op">[</span>A<span class="op">,</span> B<span class="op">](</span>value<span class="op">:</span> B<span class="op">):</span> <span class="ex">State</span><span class="op">[</span>A<span class="op">,</span> B<span class="op">]</span> <span class="op">=</span> <span class="fu">Sate</span><span class="op">(</span>a <span class="op">=&gt;</span> <span class="op">(</span>a<span class="op">,</span> value<span class="op">))</span></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<h4 id="question-1-2">Question 1:</h4>
<p>Implémenter la méthode <code>map</code> dont la signature est la
suivante:</p>
<div class="sourceCode" id="cb17"><pre
class="sourceCode scala"><code class="sourceCode scala"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="cf">case</span> <span class="kw">class</span> <span class="ex">State</span><span class="op">[-</span>A<span class="op">,</span> <span class="op">+</span>B<span class="op">](</span>run<span class="op">:</span> A <span class="op">=&gt;</span> <span class="op">(</span>A<span class="op">,</span> B<span class="op">))</span> <span class="op">{</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>   <span class="kw">def</span> map<span class="op">[</span>C<span class="op">](</span>g<span class="op">:</span> B <span class="op">=&gt;</span> C<span class="op">):</span> <span class="ex">State</span><span class="op">[</span>A<span class="op">,</span> C<span class="op">]</span> <span class="op">=</span> <span class="op">???</span></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<h4 id="question-2-2">Question 2:</h4>
<p>Implémenter la méthode <code>flatMap</code> dont la signature est la
suivante:</p>
<div class="sourceCode" id="cb18"><pre
class="sourceCode scala"><code class="sourceCode scala"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="cf">case</span> <span class="kw">class</span> <span class="ex">State</span><span class="op">[-</span>A<span class="op">,</span> <span class="op">+</span>B<span class="op">](</span>run<span class="op">:</span> A <span class="op">=&gt;</span> <span class="op">(</span>A<span class="op">,</span> B<span class="op">))</span> <span class="op">{</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>   <span class="kw">def</span> flatMap<span class="op">[</span>C<span class="op">](</span>g<span class="op">:</span> B <span class="op">=&gt;</span> <span class="ex">State</span><span class="op">[</span>A<span class="op">,</span> C<span class="op">]):</span> <span class="ex">State</span><span class="op">[</span>A<span class="op">,</span> C<span class="op">]</span> <span class="op">=</span> <span class="op">???</span></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<h4 id="question-3-2">Question 3:</h4>
<p>Implémenter la méthode <code>flatMap</code> dont la signature est la
suivante:</p>
<div class="sourceCode" id="cb19"><pre
class="sourceCode scala"><code class="sourceCode scala"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="cf">case</span> <span class="kw">class</span> <span class="ex">State</span><span class="op">[-</span>A<span class="op">,</span> <span class="op">+</span>B<span class="op">](</span>run<span class="op">:</span> A <span class="op">=&gt;</span> <span class="op">(</span>A<span class="op">,</span> B<span class="op">))</span> <span class="op">{</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>   <span class="kw">def</span> flatMap<span class="op">[</span>C<span class="op">](</span>g<span class="op">:</span> B <span class="op">=&gt;</span> <span class="ex">State</span><span class="op">[</span>A<span class="op">,</span> C<span class="op">]):</span> <span class="ex">State</span><span class="op">[</span>A<span class="op">,</span> C<span class="op">]</span> <span class="op">=</span> <span class="op">???</span></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<h4 id="question-4-2">Question 4:</h4>
<p>Quel est le résultat du code suivant:</p>
<div class="sourceCode" id="cb20"><pre
class="sourceCode scala"><code class="sourceCode scala"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="kw">final</span> <span class="cf">case</span> <span class="kw">class</span> <span class="fu">Article</span><span class="op">(</span>id<span class="op">:</span> <span class="ex">String</span><span class="op">,</span> name<span class="op">:</span> <span class="ex">String</span><span class="op">,</span> price<span class="op">:</span> <span class="ex">Double</span><span class="op">)</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a><span class="kw">type</span> Cart <span class="op">=</span> <span class="ex">List</span><span class="op">[</span>Article<span class="op">]</span></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> <span class="fu">addArticle</span><span class="op">(</span>newArticle<span class="op">:</span> Article<span class="op">):</span> <span class="ex">State</span><span class="op">[</span>Cart<span class="op">,</span> <span class="ex">Double</span><span class="op">]</span> <span class="op">=</span> <span class="ex">State</span> <span class="op">{</span> cart <span class="op">=&gt;</span></span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>  <span class="kw">val</span> newCart <span class="op">=</span> newArticle <span class="op">+:</span> cart</span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>  <span class="kw">val</span> cartAmount <span class="op">=</span> newCart<span class="op">.</span><span class="fu">map</span><span class="op">(</span>article <span class="op">=&gt;</span> article<span class="op">.</span>price<span class="op">).</span>sum</span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a>  <span class="op">(</span>newCart<span class="op">,</span> cartAmount<span class="op">)</span></span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> resetCart<span class="op">:</span> <span class="ex">State</span><span class="op">[</span>Cart<span class="op">,</span> <span class="ex">Double</span><span class="op">]</span> <span class="op">=</span> <span class="ex">State</span><span class="op">(</span>_ <span class="op">=&gt;</span> <span class="op">(</span>Nil<span class="op">,</span> <span class="dv">0</span><span class="op">))</span></span>
<span id="cb20-11"><a href="#cb20-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-12"><a href="#cb20-12" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> userCommand<span class="op">:</span> <span class="ex">State</span><span class="op">[</span>Cart<span class="op">,</span> <span class="ex">List</span><span class="op">[</span><span class="ex">Double</span><span class="op">]]</span> <span class="op">=</span> <span class="cf">for</span> <span class="op">{</span></span>
<span id="cb20-13"><a href="#cb20-13" aria-hidden="true" tabindex="-1"></a>  price1 <span class="op">&lt;-</span> <span class="fu">addArticle</span><span class="op">(</span><span class="fu">Article</span><span class="op">(</span><span class="st">&quot;1&quot;</span><span class="op">,</span> <span class="st">&quot;Dark Chocolate&quot;</span><span class="op">,</span> <span class="fl">10.94</span><span class="op">))</span></span>
<span id="cb20-14"><a href="#cb20-14" aria-hidden="true" tabindex="-1"></a>  _ <span class="op">&lt;-</span> resetCart</span>
<span id="cb20-15"><a href="#cb20-15" aria-hidden="true" tabindex="-1"></a>  price2 <span class="op">&lt;-</span> <span class="fu">addArticle</span><span class="op">(</span><span class="fu">Article</span><span class="op">(</span><span class="st">&quot;1&quot;</span><span class="op">,</span> <span class="st">&quot;Nintendo DS&quot;</span><span class="op">,</span> <span class="fl">160.40</span><span class="op">))</span></span>
<span id="cb20-16"><a href="#cb20-16" aria-hidden="true" tabindex="-1"></a>  price3 <span class="op">&lt;-</span> <span class="fu">addArticle</span><span class="op">(</span><span class="fu">Article</span><span class="op">(</span><span class="st">&quot;2&quot;</span><span class="op">,</span> <span class="st">&quot;PS4&quot;</span><span class="op">,</span> <span class="fl">360.40</span><span class="op">))</span></span>
<span id="cb20-17"><a href="#cb20-17" aria-hidden="true" tabindex="-1"></a><span class="op">}</span> <span class="cf">yield</span> <span class="ex">List</span><span class="op">(</span>price1<span class="op">,</span> price2<span class="op">,</span> price3<span class="op">)</span></span>
<span id="cb20-18"><a href="#cb20-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-19"><a href="#cb20-19" aria-hidden="true" tabindex="-1"></a><span class="kw">val</span> cartAndAmount<span class="op">:</span> <span class="op">(</span>Cart<span class="op">,</span> <span class="ex">List</span><span class="op">[</span><span class="ex">Double</span><span class="op">])</span> <span class="op">=</span> userCommand<span class="op">.</span><span class="fu">run</span><span class="op">(</span><span class="ex">List</span><span class="op">(</span><span class="fu">Article</span><span class="op">(</span><span class="st">&quot;11&quot;</span><span class="op">,</span> <span class="st">&quot;Soap&quot;</span><span class="op">,</span> <span class="fl">2.36</span><span class="op">)))</span></span></code></pre></div>
</body>
</html>
